/*! @license pzprv3-ui.js v0.0.1 (c) 2009-2019 robx, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */

!function(){function a(a){return d.getElementById(a)}function b(a,b){var c="";if(void 0!==a.dataset)c=a.dataset[b];else{for(var d="data-",e=0;e<b.length;e++){var f=b[e]||b.charAt(e);d+=f>="A"&&f<="Z"?"-"+f.toLowerCase():f}c=a[d]||a.getAttribute(d)||""}return c}var c={doclang:pzpr.lang,complete:!1,testdoc:!1,captions:[],extend:function(a){for(var b in a)this[b]=a[b]}},d=document,e=c;e.doclang=JSON.parse(localStorage["pzprv3_config:ui"]||"{}").language||pzpr.lang,"?en"!==location.search&&"?ja"!==location.search||(e.doclang=location.search.substr(1,2)),location.href.match(/\/tests\/index/)&&(e.doclang="ja",e.testdoc=!0),c.extend({onload_func:function(){if(!window.pzprfaq&&!e.input_init()){var b=a("puzmenu_input");b&&(b.parentNode.removeChild(b),a("table_input").style.display="none")}Array.prototype.slice.call(d.querySelectorAll("#puztypes > li")).forEach(function(a){if(a.id.match(/puzmenu_(.+)$/)){var b=RegExp.$1;a.addEventListener("click",function(a){return function(b){e.click_tab(a)}}(b),!1)}}),a("puztypes")&&(a("puztypes").style.display="block"),e.setRecentPuzzle(),e.disp_tab(),e.setTranslation(),e.translate()},input_init:function(){var a=0;return e.urlif.init()&&a++,e.fileif.init()&&a++,e.dbif.init()&&a++,a>0},click_tab:function(a){Array.prototype.slice.call(d.querySelectorAll("#puztypes > li")).forEach(function(b){b.className=b.id==="puzmenu_"+a?"puzmenusel":"puzmenu"}),e.disp_tab(),"all"===b(d.querySelector("li.puzmenusel"),"table")&&e.set_puzzle_filter(a),"input"===a&&e.dbif.display()},disp_tab:function(){var a={};Array.prototype.slice.call(d.querySelectorAll("#puztypes > li")).forEach(function(c){if(c.id.match(/puzmenu_(.+)$/)){var d="table_"+b(c,"table");void 0===a[d]&&(a[d]=!1),!1===a[d]&&"puzmenusel"===c.className&&(a[d]=!0)}}),Array.prototype.slice.call(d.querySelectorAll("div.puztable")).forEach(function(b){b.style.display=a[b.id||"1"]?"block":"none"})},set_puzzle_filter:function(a){Array.prototype.slice.call(d.querySelectorAll(".lists ul > li")).forEach(function(c){var d=pzpr.variety.toPID(b(c,"pid"));if(d){var f="all"===a||a===(e.variety[d]?e.variety[d].tab:"extra");c.style.display=f?"":"none"}}),Array.prototype.slice.call(d.querySelectorAll(".lists ul")).forEach(function(a){var b=0;Array.prototype.slice.call(a.querySelectorAll("li")).forEach(function(a){"none"!==a.style.display&&b++}),a.parentNode.style.display=b>0?"":"none"})},setRecentPuzzle:function(){function b(a){var b=pzpr.variety(a);if(b.valid){var f=d.createElement("li");f.innerHTML='<a href="p?'+a+'"></a>',c.appendChild(f),e.captions.push({anode:f.firstChild,str_jp:b.ja,str_en:b.en})}}var c;if(c=a("recentpuzzle")){c.innerHTML="",(JSON.parse(localStorage["pzprv3_index:ranking"]||"{}").recent||[]).forEach(b),c=a("frequentpuzzle"),c.innerHTML="";var f=JSON.parse(localStorage["pzprv3_index:ranking"]||"{}").count||{},g=[];for(var h in f)g.push({pid:h,count:f[h]});g.sort(function(a,b){return b.count-a.count}).slice(0,10).forEach(function(a){b(a.pid)})}},setlang:function(a){e.doclang=a,e.translate();var b=JSON.parse(localStorage["pzprv3_config:ui"]||"{}");b.language=a,localStorage["pzprv3_config:ui"]=JSON.stringify(b)},setTranslation:function(){Array.prototype.slice.call(d.querySelectorAll(".lists li")).forEach(function(a){var c=pzpr.variety(b(a,"pid")),d=c.pid;c.valid&&(0===a.childNodes.length&&(a.className=e.variety[d]?e.variety[d].state:"omopa",a.innerHTML='<a href="p?'+d+(e.testdoc?"_test":"")+'"></a>'),e.captions.push({anode:a.firstChild,str_jp:c.ja,str_en:c.en}))})},translate:function(){for(var a=0;a<this.captions.length;a++){var b=this.captions[a];if(b.anode){var c="ja"===e.doclang?b.str_jp:b.str_en;b.anode.innerHTML=c.replace(/(\(.+\))/g,"<small>$1</small>")}}Array.prototype.slice.call(d.body.querySelectorAll('[lang="ja"]')).forEach(function(a){a.style.display="ja"===e.doclang?"":"none"}),Array.prototype.slice.call(d.body.querySelectorAll('[lang="en"]')).forEach(function(a){a.style.display="en"===e.doclang?"":"none"})}}),window.addEventListener("load",e.onload_func,!1),window.v3index=c}(),function(){function a(a){return d.getElementById(a)}var b=window.v3index;b.urlif={extend:function(a){for(var b in a)this[b]=a[b]}};var c,d=document,e=b.urlif;b.urlif.extend({init:function(){if(c=d.urlinput)return a("urlinput_btn").addEventListener("click",e.urlinput,!1),!0},urlinput:function(b){var c=a("urlinput_text").value;c&&(localStorage.pzprv3_urldata=c,window.open("./p",""))}})}(),function(){var a=window.v3index;a.fileif={extend:function(a){for(var b in a)this[b]=a[b]}};var b,c=document,d=a.fileif;a.fileif.extend({init:function(){if(b=c.fileform)return b.filebox.addEventListener("change",d.fileinput,!1),!0},fileinput:function(a){var b=c.fileform.filebox;if("undefined"!=typeof FileReader){var e=new FileReader;e.onload=function(a){d.fileonload.call(d,a.target.result)},e.readAsText(b.files[0])}else if("undefined"!=typeof FileList&&void 0!==File.prototype.getAsText){if(!b.files[0])return;this.fileonload(b.files[0].getAsText(""))}c.fileform.reset()},fileonload:function(a){if(a){for(var b=a.replace(/[\t\r]*\n/g,"\n").split(/\n/),c="",d=0;d<b.length&&!b[d].match(/^http\:\/\//);d++)c+=b[d]+"\n";localStorage.pzprv3_filedata=c,window.open("./p","")}}})}(),function(){var a=window.v3index;a.dbif={list:[],extend:function(a){for(var b in a)this[b]=a[b]}};var b,c=document,d=a.dbif,e=d.list,f="";a.dbif.extend({init:function(){if(b=c.database)return b.sorts_ja.addEventListener("change",d.display,!1),b.sorts_en.addEventListener("change",d.display,!1),b.datalist.addEventListener("change",d.select,!1),b.open_ja.addEventListener("click",d.open,!1),b.open_en.addEventListener("click",d.open,!1),f="pzprv3_storage:data:",d.importlist(d.display),!0},importlist:function(a){e=d.list=[];for(var b=1;!0;b++){var c=localStorage[f+b];if(!c)break;var g=JSON.parse(c);if(null==g.id)break;var h=pzpr.parser(g.pdata);g.pid=h.pid,g.col=h.cols,g.row=h.rows,e.push(g)}a&&a()},display:function(){var f=("ja"===a.doclang?b.sorts_ja:b.sorts_en).value;switch(f){case"idlist":e=e.sort(function(a,b){return a.id-b.id});break;case"newsave":e=e.sort(function(a,b){return b.time-a.time||a.id-b.id});break;case"oldsave":e=e.sort(function(a,b){return a.time-b.time||a.id-b.id});break;case"size":e=e.sort(function(a,b){return a.col-b.col||a.row-b.row||a.id-b.id})}d.list=e,("ja"===a.doclang?b.sorts_en:b.sorts_ja).value=f,b.datalist.innerHTML="";for(var g=0;g<e.length;g++){var h=e[g];if(h){var i=c.createElement("option");i.setAttribute("value",h.id),i.innerHTML=d.getcaption(h),b.datalist.appendChild(i)}}if(e.length>=1){b.datalist.firstChild.setAttribute("selected","selected");var j=pzpr.parser(e[0].pdata).metadata;b.comtext.value=j.comment,b.author.value=j.author,b.source.value=j.source}else b.comtext.value="",b.datalist.style.width="180px"},getcaption:function(b){var c=function(){var a=function(a){return(a<10?"0":"")+a},c="",d=new Date;return d.setTime(1e3*b.time),c+=a(d.getFullYear()%100)+"/"+a(d.getMonth()+1)+"/"+a(d.getDate())+" ",c+=a(d.getHours())+":"+a(d.getMinutes())}(),d="";return d+=(b.id<10?"&nbsp;":"")+b.id+" :&nbsp;",d+=pzpr.variety(b.pid)[a.doclang]+"&nbsp;",d+=b.col+"Ã—"+b.row+" &nbsp;",d+=pzpr.parser(b.pdata).metadata.hard+"&nbsp;",d+="("+c+")"},select:function(){var a=d.getvalue(),c=a>=0?pzpr.parser(e[a].pdata).metadata:{};b.comtext.value=c.comment,b.author.value=c.author,b.source.value=c.source},open:function(){var a=d.getvalue();if(a>=0){var b=e[a].pdata;b&&(localStorage.pzprv3_filedata=b,window.open("./p",""))}},getvalue:function(){var a=b.datalist.value;if(""!==a)for(var c=0;c<e.length;c++)if(e[c].id==a)return c;return-1}})}(),function(){var a=window.v3index,b={lunch:["nurikabe","tilepaint","norinori","nurimaze","heyawake","hitori","slither","mashu","yajilin","slalom","numlin","hashikake","herugolf","shikaku","tentaisho","kakuro","sudoku","fillomino","ripple","akari","shakashaka"],testa:["nagare","dosufuwa","usoone","moonsun"],trial:["stostone","armyants"],lunch2:["box","lits","kurodoko","goishi"],lunch3:["minarism","factors"],nigun:["creek","mochikoro","tasquare","kurotto","shimaguni","yajikazu","bag","country","reflect","icebarn","firefly","kaero","yosenabe","bdblock","fivecells","sashigane","tatamibari","sukoro","gokigen","tateyoko","kinkonkan","hebi","makaro","juosan"],omopa:["nuribou","tawa","lookair","paintarea","chocona","kurochute","mejilink","pipelink","loopsp","nagenawa","kouchoku","ringring","pipelinkr","barns","icelom","icelom2","wblink","kusabi","ichimaga","ichimagam","ichimagax","amibo","bonsan","heyabon","rectslider","nawabari","triplace","fourcells","kramma","kramman","shwolf","loute","fillmat","usotatami","yajitatami","kakuru","view","bosanowa","nanro","cojun","renban","sukororoom","hanare","kazunori","wagiri","shugaku","hakoiri","roma","toichika","cbblock","nondango","onsen"],orig:["mochinyoro","ayeheya","aho"],genre:["tapa","arukone","yinyang","building","kropki","starbattle","easyasabc","walllogic"],add:["angleloop","doubleback","heyawacky","nurimisaki","meander","satogaeri","scrin","heteromino","yajilin-regions","dbchoco"]},c={lunch:"lunch",lunch2:"lunch",lunch3:"nigun",testa:"nigun",nigun:"nigun",trial:"omopa",omopa:"omopa",orig:"extra",genre:"extra",add:"add"},d={};for(var e in b)b[e].forEach(function(a){d[pzpr.variety.toPID(a)]={state:e,tab:c[e]}});a.extend({variety:d})}();
//# sourceMappingURL=v3index.js.map