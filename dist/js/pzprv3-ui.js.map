{"version":3,"sources":["../../src/js/common/intro.js","../../src/js/ui/UI.js","../../src/js/ui/Misc.js","../../src/js/ui/Boot.js","../../src/js/ui/Event.js","../../src/js/ui/Listener.js","../../src/js/ui/MenuConfig.js","../../src/js/ui/MenuArea.js","../../src/js/ui/PopupMenu.js","../../src/js/ui/ToolArea.js","../../src/js/ui/Notify.js","../../src/js/ui/KeyPopup.js","../../src/js/ui/DataBase.js","../../src/js/ui/Timer.js","../../src/js/ui/Debug.js"],"names":["getEL","id","_doc","getElementById","createEL","tagName","createElement","toBGimage","pid","data","aho","amibo","ayeheya","bag","barns","bdblock","bonsan","box","cbblock","chocona","cojun","country","creek","factors","fillmat","fillomino","firefly","fivecells","fourcells","goishi","gokigen","hakoiri","hanare","hashikake","hebi","herugolf","heyabon","heyawake","hitori","icebarn","icelom","icelom2","ichimaga","ichimagam","ichimagax","juosan","kaero","kazunori","kakuro","kakuru","kinkonkan","kouchoku","kramma","kramman","kurochute","kurodoko","kurotto","kusabi","lightup","lits","lookair","loopsp","loute","makaro","mashu","mejilink","minarism","mochikoro","mochinyoro","nagare","nagenawa","nanro","nawabari","norinori","numlin","nuribou","nurikabe","nurimaze","paintarea","pipelink","pipelinkr","rectslider","reflect","renban","ringring","ripple","roma","sashigane","shakashaka","shikaku","shimaguni","shugaku","shwolf","slalom","slither","sudoku","sukoro","tapa","tasquare","tatamibari","tateyoko","tawa","tentaisho","tilepaint","toichika","triplace","usotatami","wagiri","yajikazu","yajirin","yajitatami","yosenabe","bosanowa","dosufuwa","sukororoom","view","wblink","length","importData","onload_pzl","importFileData","importURL","failOpen","ui","puzzle","title2","document","innerHTML","includeDebugFile","result","debugmode","debug","urls","includeDebugScript","startPuzzle","pzl","onload_option","mode","ua","match","navigator","userAgent","graphic","element","pzpr","Puzzle","connectKeyEvents","event","onload_func","callback","once","menuconfig","set","accesslog","require_accesslog","type","countpid","open","qdata","search","getStorageData","location","charAt","substr","RegExp","$1","$2","$3","startmode","replace","parser","parseURL","body","fstr","parseFile","key","key2","str","localStorage","sessionStorage","counts","JSON","parse","count","cnt","recent","indexOf","splice","unshift","pop","stringify","playeronly","domain","refer","referrer","xmlhttp","ActiveXObject","e","XMLHttpRequest","join","onreadystatechange","setRequestHeader","send","on","boot","setTimeout","window","version","currentpid","menuarea","toolarea","popupmgr","keypopup","timer","enableGetText","enableReadText","reader","enableSaveImage","enableImageType","enableSaveBlob","callbackComplete","displayAll","display","translate","misc","displayDesign","setdisplay","idname","customAttr","el","name","value","dataset","lowername","i","ch","toLowerCase","getAttribute","windowWidth","innerHeight","innerWidth","clientWidth","adjustcellsize","mwidth","cellsize","pc","painter","cols","getCanvasCols","getBoardPadding","wwidth","uiconf","cellsizeval","get","cr","base","limit","ws","ci","outputImage","style","width","setCanvasSizeByCellSize","padding","selectStr","strJP","strEN","lang","getCurrentConfigList","getList","initFileReadMethod","FileReader","this","onload","target","FileList","File","prototype","getAsText","initImageSaveMethod","Candle","enable","canvas","toDataURL","png","height","gif","jpeg","webp","svg","btoa","saveBlob","resizetimer","removers","addEvent","self","capt","push","util","removeAllEvents","forEach","remover","setWindowEvents","DDhandler","readAsText","dataTransfer","files","preventDefault","stopPropagation","onblur_func","evname","env","OS","iOS","onresize_func","onbeforeunload_func","onunload_func","errclear","restore","listener","setListeners","Android","modifyCSS","body, .btn","fontFamily","save","clearTimeout","keyreset","mouse","mousereset","ismodified","msg","returnValue","onFirstReady","onReady","onKeyInput","onMouseInput","onHistoryChange","onTrialModeChange","onModeChange","onAdjust","onResize","create","reset","notify","sync","c","kc","ut","undotimer","keydown","startKeyUndo","startKeyRedo","editmode","MODE_PLAYER","playmode","MODE_EDITOR","keyup","stopKeyUndo","stopKeyRedo","isCTRL","isMETA","isZ","isY","cancelEvent","mv","mousestart","btn","cell","getcell","isnull","isStone","anum","startAnswerRedo","startAnswerUndo","mouseend","stop","trialstage","list","val","inputMode","Math","min","cw","valTop","parentNode","paddingTop","resizepanel","Config","init","add","volatile","option","config","item","extoption","defval","defvalue","call","getConfig","inversion","getCurrentName","getNormalizedName","argname","newval","names","setMode","setInputMode","setproper","setConfig","configevent","json_puzzle","json_menu","setAll","saveConfig","getAll","getexec","validConfig","setting","autocheck_once","autocheck","valid","paneltype","getInputModeList","menuitem","setInversion","pinfo","variety","title","ja","en","backgroundImage","bgimage","input","sheet","styleSheets","rules","cssRules","modifyCSS_sub","sel","insertRule","modified","len","rule","selectorText","pps","p","walker","parent","func","els","firstChild","nextSibling","nodeType","childNodes","displayByPid","disppid","checkpid","autocmp","captions","nohover","createMenu","modifySelector","walkElement","stopHovering","menufactory","role","addmenuevent","nodeName","setevent","className","children","roles","split","querySelector","showHovering","link","setAttribute","label","menu","str_jp","str_en","textnode","mobile","classList","cssText","deleteRule","el0","toggle","contains","remove","board","disable_subclear","EDITOR","obj","opemgr","enableUndo","enableRedo","validval","child","selected","cname","disabled","checkclick","childclick","anscheck","answercheck","undo","startButtonUndo","undostop","stopButtonUndo","undoall","redo","startButtonRedo","redostop","stopButtonRedo","redoall","ansclear","ACconfirm","subclear","ASconfirm","dropblocks","operate","raiseblocks","resetblocks","showgatenum","hidegatenum","enterTrial","enterFurtherTrial","acceptTrial","rejectTrial","rejectCurrentTrial","duplicate","duplicate_board","repaint","redraw","disppopup","currentTime","parseInt","alert","rect","getRect","bottom","pos","getPagePos","px","py","dispdebug","filestr","getFileData","FILE_PZPR","history","url","browser","Presto","old","check","complete","texts","text","confirm","popup","popups","movingpop","offset","setEvents","titlebarmove","titlebarup","addpopup","proto","NewPopup","template","multipopup","close","show","titlebardown","popel","left","top","enableMouse","formname","form","titlebar","unselectable","walkCaption","walkEvent","button","eventfactory","API","touchevent","enableKey","_div","_img","src","clip","setsize_sudoku","setsize_tawa","setsize","bd","col","row","rows","getsize","checked","getsize_sudoku","shape","setshape","getsize_tawa","getshape","isNaN","setshapeidx","idx","getshapeidx","clickshape","backgroundColor","execute","urlinput","ta","exists","kanpen","heyaapp","urloutput","getURL","URL_PZPRV3","URL_KANPEN","URL_HEYAAPP","openurl","fileopen","fileEL","filebox","fitem","anchor","anchor_download","ispencilbox","pencilbox","filetype","options","filename","changefilename","filesaveurl","URL","revokeObjectURL","ext","urlid","kanpenid","filesave","prohibit","FILE_PBOX","FILE_PBOX_XML","blob","filedata","Blob","createObjectURL","href","download","click","ques","operation","submit","saved","showsize","removeChild","estimatesize","saveimageurl","setCanvasSize","getCanvasRows","replaceChild","createTextNode","saveimage","transparent","bgcolor","toBlob","bind","urlstr","openimage","writeContent","cdoc","writeln","dataurl","defaultView","IEkei","toBuffer","adjust","turnl","turnr","meta","metadata","author","source","hard","comment","colorElement","addEventListener","setcolor","clearcolor","refresh","getdefaultcolor","color","getnamedcolor","rgbcolor","changesize","csize","debugalltest","all_test","items","btnfactory","addbtnevent","checkbox","mandisp","irowake","irowakeblk","toolitem","toolclick","encolorall","toggledisp","current","onconfirm","setVerticalPosition","elbg","rectbg","closealert","confirmtrue","confirmfalse","1","3","tdcolor","imgCR","imgs","basepanel","clearflag","satogaeri","building","kropki","createtable","bar","fontAnscolor","generate","gentable4","gentable10","gentable51","gentable3","gentable5","gentable6","gentable8","generate_slalom","generate_reflect","generate_pipelink","generate_tatamibari","generate_hakoiri","generate_kusabi","itemlist","cap","hideHatena","mbcolor","generate_main","klass","Cell","numberWithMB","image","inputcol","insertrow","ca","disp","_child","onclick","keyevent","x","y","clear","appendChild","dsize","tsize","img","div.kpcell","lineHeight","span.kpnum","fontSize","shitappa","ProblemData","pdata","time","arguments","updatePuzzleData","updateMetaData","MetaData","database","comtext","update","toString","openDialog","closeDialog","database_handler","clickHandler","dbh","DBsid","DBlist","updateDialog","DataBaseHandler_LS","convert","importDBlist","displayDataTableList","selectDataTable","upDataTable","downDataTable","openDataTable","saveDataTable","updateInfo","deleteDataTable","getDataID","datalist","updateManageData","sorts","sort","a","b","appendNewOption","getRowString","opt","dateString","ni","num","date","Date","setTime","getFullYear","getMonth","getDate","getHours","getMinutes","sid","sortbyid","tableup","tabledn","updateinfo","del","overwrite","convertDataTable","tid","saveItem","dbm","sID","max","deleteItem","pheader","currentVersion","createManageDataTable","createDataBase","args","removeItem","convertfrom1","convertfrom2","hardstr","keys","countall","puzzles","info","mheader","ptime","TID","bseconds","timerEL","worstACtime","nextACtime","clearInterval","start","setInterval","updatetime","alltimer","ACcheck","seconds","getTime","hours","minutes","checker","inCheck","inUNDO","inREDO","startUndo","startRedo","stopUndo","stopRedo","bit","proc","handler","inithandler","exec","checknextprop","isenable","nextopes","ope","position","property","starttest","loadperf","inputcheck_popup","extend","disppoptest","setTA","filesave_pencilbox","filesave_pencilbox_xml","getTA","erasetext","perfeval","ans","timeeval","resetCache","checkAns","painteval","resizeeval","searcheval","graph","linegraph","rebuild","nodes","components","concat","modifyNodes","searchGraph","rebuildeval","addTA","dispdatabase","console","log","includedScript","_script","getpath","getElementsByTagName"],"mappings":"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","file":"pzprv3-ui.js","sourcesContent":["// intro.js\n\n(function(){\n","// UI.js v3.4.0\n/* global pzpr:false, ui:false, File:false */\n/* exported ui, _doc, getEL, createEL */\n\n/* ui.js Locals */\nvar _doc = document;\nfunction getEL(id){ return _doc.getElementById(id);}\nfunction createEL(tagName){ return _doc.createElement(tagName);}\n\n//---------------------------------------------------------------------------\n// ★uiオブジェクト UserInterface側のオブジェクト\n//---------------------------------------------------------------------------\n/* extern */\nwindow.ui = {\n\tversion : '0.0.1',\n\n\t/* このサイトで使用するパズルのオブジェクト */\n\tpuzzle    : null,\n\t\n\t/* どの種類のパズルのメニューを表示しているか */\n\tcurrentpid : '',\n\t\n\t/* メンバオブジェクト */\n\tevent     : null,\n\tmenuconfig: null,\n\tmenuarea  : null,\n\ttoolarea  : null,\n\tpopupmgr  : null,\n\tkeypopup  : null,\n\ttimer     : null,\n\t\n\tdebugmode : false,\n\t\n\tenableGetText   : false,\t// FileReader APIの旧仕様でファイルが読めるか\n\tenableReadText  : false,\t// HTML5 FileReader APIでファイルが読めるか\n\treader : null,\t\t\t\t// FileReaderオブジェクト\n\t\n\tenableSaveImage : false,\t// 画像保存が可能か\n\tenableImageType : {},\t\t// 保存可能な画像形式\n\t\n\tenableSaveBlob  : false,\t// saveBlobが使用できるか\n\n\tcallbackComplete : null,\n\n\t//---------------------------------------------------------------------------\n\t// ui.displayAll()     全てのメニュー、ボタン、ラベルに対して文字列を設定する\n\t// ui.setdisplay()     個別のメニュー、ボタン、ラベルに対して文字列を設定する\n\t//---------------------------------------------------------------------------\n\tdisplayAll : function(){\n\t\tui.menuarea.display();\n\t\tui.toolarea.display();\n\t\tui.popupmgr.translate();\n\t\tui.misc.displayDesign();\n\t},\n\tsetdisplay : function(idname){\n\t\tui.menuarea.setdisplay(idname);\n\t\tui.toolarea.setdisplay(idname);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// ui.customAttr()   エレメントのカスタムattributeの値を返す\n\t//---------------------------------------------------------------------------\n\tcustomAttr : function(el, name){\n\t\tvar value = \"\";\n\t\tif(el.dataset!==void 0){ value = el.dataset[name];}\n\t\t/* IE10, Firefox5, Chrome7, Safari5.1以下のフォールバック */\n\t\telse{\n\t\t\tvar lowername = \"data-\";\n\t\t\tfor(var i=0;i<name.length;i++){\n\t\t\t\tvar ch = name[i] || name.charAt(i);\n\t\t\t\tlowername += ((ch>=\"A\" && ch<=\"Z\") ? (\"-\" + ch.toLowerCase()) : ch);\n\t\t\t}\n\t\t\tvalue = el[lowername] || el.getAttribute(lowername) || \"\";\n\t\t}\n\t\treturn value;\n\t},\n\n\t//----------------------------------------------------------------------\n\t// ui.windowWidth()   ウィンドウの幅を返す\n\t//----------------------------------------------------------------------\n\twindowWidth : function(){\n\t\treturn ((window.innerHeight!==void 0) ? window.innerWidth : _doc.body.clientWidth);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// ui.adjustcellsize()  resizeイベント時に、pc.cw, pc.chのサイズを(自動)調節する\n\t// ui.getBoardPadding() Canvasと境界線の周りの間にあるpaddingのサイズを求めます\n\t//---------------------------------------------------------------------------\n\tadjustcellsize : function(){\n\t\tvar puzzle = ui.puzzle, pc = puzzle.painter;\n\t\tvar cols = pc.getCanvasCols() + ui.getBoardPadding()*2;\n\t\tvar wwidth = ui.windowWidth()-6, mwidth;\t//  margin/borderがあるので、適当に引いておく\n\t\tvar uiconf = ui.menuconfig;\n\n\t\tvar cellsize, cellsizeval = uiconf.get('cellsizeval');\n\t\tvar cr = {base:1.0,limit:0.40}, ws = {base:0.80,limit:0.96}, ci=[];\n\t\tci[0] = (wwidth*ws.base )/(cellsizeval*cr.base );\n\t\tci[1] = (wwidth*ws.limit)/(cellsizeval*cr.base );\n\t\tci[2] = (wwidth*ws.limit)/(cellsizeval*cr.limit);\n\n\t\t// 横幅いっぱいに広げたい場合\n\t\tif(uiconf.get('fullwidth')){\n\t\t\tmwidth = wwidth*0.98;\n\t\t\tcellsize = (mwidth*0.92)/cols;\n\t\t}\n\t\t// 縮小が必要ない場合\n\t\telse if(!uiconf.get('adjsize') || cols < ci[0]){\n\t\t\tmwidth = wwidth*ws.base-4;\n\t\t\tcellsize = cellsizeval*cr.base;\n\t\t}\n\t\t// ひとまずセルのサイズを変えずにmainの幅を調節する場合\n\t\telse if(cols < ci[1]){\n\t\t\tcellsize = cellsizeval*cr.base;\n\t\t\tmwidth = cellsize*cols;\n\t\t}\n\t\t// base～limit間でサイズを自動調節する場合\n\t\telse if(cols < ci[2]){\n\t\t\tmwidth = wwidth*ws.limit-4;\n\t\t\tcellsize = mwidth/cols; // 外枠ぎりぎりにする\n\t\t}\n\t\t// 自動調整の下限値を超える場合\n\t\telse{\n\t\t\tcellsize = cellsizeval*cr.limit;\n\t\t\tmwidth = cellsize*cols;\n\t\t}\n\n\t\t// mainのサイズ変更\n\t\tif(!pc.outputImage){\n\t\t\tgetEL('main').style.width = ''+(mwidth|0)+'px';\n\t\t}\n\n\t\tpuzzle.setCanvasSizeByCellSize(cellsize);\n\t},\n\tgetBoardPadding : function(){\n\t\tvar puzzle = ui.puzzle, padding = 0;\n\t\tswitch(puzzle.pid){\n\t\t\tcase 'firefly': case 'hashikake': case 'wblink':\n\t\t\tcase 'ichimaga': case 'ichimagam': case 'ichimagax':\n\t\t\t\tpadding = 0.30; break;\n\t\t\t\n\t\t\tcase 'kouchoku': case 'gokigen': case 'wagiri': case 'creek':\n\t\t\t\tpadding = 0.20; break;\n\t\t\t\n\t\t\tcase 'slither': case 'bag': case 'mejilink':\n\t\t\t\tpadding = 0.15; break;\n\t\t\t\n\t\t\tcase 'kinkonkan': case 'building': case 'easyasabc': case 'box':\n\t\t\t\tpadding = 0.05; break;\n\t\t\t\n\t\t\tcase 'bosanowa':\n\t\t\t\tpadding = (ui.menuconfig.get('disptype_bosanowa')!==2?0.50:0.05); break;\n\t\t\t\n\t\t\tdefault: padding = 0.50; break;\n\t\t}\n\t\tif(ui.menuconfig.get('fullwidth')){ padding = 0;}\n\t\treturn padding;\n\t},\n\n\t//--------------------------------------------------------------------------------\n\t// ui.selectStr()  現在の言語に応じた文字列を返す\n\t//--------------------------------------------------------------------------------\n\tselectStr : function(strJP, strEN){\n\t\tif(!strEN){ return strJP;}\n\t\treturn (pzpr.lang==='ja' ? strJP : strEN);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// ui.getCurrentConfigList() 現在のパズルで有効な設定と設定値を返す\n\t//---------------------------------------------------------------------------\n\tgetCurrentConfigList : function(){\n\t\treturn ui.menuconfig.getList();\n\t},\n\n\t//----------------------------------------------------------------------\n\t// ui.initFileReadMethod() ファイルアクセス関連の処理の初期化を行う\n\t//----------------------------------------------------------------------\n\tinitFileReadMethod : function(){\n\t\t// File Reader (あれば)の初期化処理\n\t\tif(typeof FileReader !== 'undefined'){\n\t\t\tthis.reader = new FileReader();\n\t\t\tthis.reader.onload = function(e){ ui.puzzle.open(e.target.result);};\n\t\t\tthis.enableReadText = true;\n\t\t}\n\t\telse{\n\t\t\tthis.reader = null;\n\t\t\tthis.enableGetText = (typeof FileList !== 'undefined' && typeof File.prototype.getAsText !== 'undefined');\n\t\t}\n\t},\n\n\t//----------------------------------------------------------------------\n\t// ui.initImageSaveMethod() 画像保存関連の処理の初期化を行う\n\t//----------------------------------------------------------------------\n\tinitImageSaveMethod : function(puzzle){\n\t\tif(!!pzpr.Candle.enable.canvas && !!_doc.createElement('canvas').toDataURL){\n\t\t\tthis.enableImageType.png = true;\n\t\t\t\n\t\t\tvar canvas = _doc.createElement('canvas');\n\t\t\tcanvas.width = canvas.height = 1;\n\t\t\tif(canvas.toDataURL('image/gif').match('image/gif'))  { this.enableImageType.gif = true;}\n\t\t\tif(canvas.toDataURL('image/jpeg').match('image/jpeg')){ this.enableImageType.jpeg = true;}\n\t\t\tif(canvas.toDataURL('image/webp').match('image/webp')){ this.enableImageType.webp = true;}\n\t\t}\n\t\tif(!!pzpr.Candle.enable.svg && !!window.btoa){\n\t\t\tthis.enableImageType.svg = true;\n\t\t}\n\t\tif(!!this.enableImageType.png || !!this.enableImageType.svg){\n\t\t\tthis.enableSaveImage = true;\n\t\t}\n\t\t\n\t\tthis.enableSaveBlob = (!!window.navigator.saveBlob);\n\t}\n};\n","// Misc.js v3.4.1\n/* jshint latedef:false */\n/* global ui:false, _doc:false */\n\n//---------------------------------------------------------------------------\n// ★Miscクラス html表示系 (Menu, Button以外)の制御を行う\n//---------------------------------------------------------------------------\nui.misc = {\n\t//---------------------------------------------------------------------------\n\t// misc.displayDesign()  背景画像とかtitle・背景画像・html表示の設定\n\t// misc.bgimage()        背景画像を返す\n\t//---------------------------------------------------------------------------\n\tdisplayDesign : function(){\n\t\tvar pid = ui.puzzle.pid;\n\t\tvar pinfo = pzpr.variety(pid);\n\t\tvar title = ui.selectStr(pinfo.ja, pinfo.en);\n\t\ttitle += (ui.puzzle.playeronly ? \" player\" : ui.selectStr(\" エディタ\",\" editor\"));\n\t\ttitle += ui.selectStr(\" - ぱずぷれv3\",\" - PUZ-PRE v3\");\n\n\t\t_doc.title = title;\n\t\tvar titleEL = _doc.getElementById('title2');\n\t\ttitleEL.innerHTML = title;\n\n\t\t_doc.body.style.backgroundImage = \"url(\"+this.bgimage(pid)+\")\";\n\t},\n\tbgimage : function(pid){\n\t\treturn toBGimage(pid);\n\t},\n\n\t//--------------------------------------------------------------------------------\n\t// misc.modifyCSS()   スタイルシートの中身を変更する\n\t//--------------------------------------------------------------------------------\n\tmodifyCSS : function(input){\n\t\tvar sheet = _doc.styleSheets[0];\n\t\tvar rules = sheet.cssRules;\n\t\tif(rules===null){} // Chromeでローカルファイルを開くとおかしくなるので、とりあえず何もしないようにします\n\t\telse if(!this.modifyCSS_sub(rules, input)){\n\t\t\tvar sel = ''; for(sel in input){ break;}\n\t\t\tsheet.insertRule(\"\"+sel+\" {}\", rules.length);\n\t\t\trules = sheet.cssRules;\n\t\t\tthis.modifyCSS_sub(rules, input);\n\t\t}\n\t},\n\tmodifyCSS_sub : function(rules, input){\n\t\tvar modified = false;\n\t\tfor(var i=0,len=rules.length;i<len;i++){\n\t\t\tvar rule = rules[i];\n\t\t\tif(!rule.selectorText){ continue;}\n\t\t\tvar pps = input[rule.selectorText];\n\t\t\tif(!!pps){\n\t\t\t\tfor(var p in pps){ if(!!pps[p]){ rule.style[p]=pps[p];}}\n\t\t\t\tmodified = true;\n\t\t\t}\n\t\t}\n\t\treturn modified;\n\t},\n\n\t//--------------------------------------------------------------------------------\n\t// misc.walker()        DOMツリーをたどる\n\t// misc.displayByPid()  要素のdata-pid, autocmp-typeカスタム属性によって表示するしないを切り替える\n\t//--------------------------------------------------------------------------------\n\twalker : function(parent, func){\n\t\tvar els = [parent.firstChild];\n\t\twhile(els.length>0){\n\t\t\tvar el = els.pop();\n\t\t\tfunc(el);\n\t\t\tif(!!el.nextSibling){ els.push(el.nextSibling);}\n\t\t\tif(el.nodeType===1 && el.childNodes.length>0){ els.push(el.firstChild);}\n\t\t}\n\t},\n\tdisplayByPid : function(parent){\n\t\tui.misc.walker(parent, function(el){\n\t\t\tif(el.nodeType===1){\n\t\t\t\tvar disppid = ui.customAttr(el,\"dispPid\");\n\t\t\t\tif(!!disppid){ el.style.display = (pzpr.util.checkpid(disppid, ui.puzzle.pid) ? \"\" : \"none\");}\n\t\t\t\tvar autocmp = ui.customAttr(el,\"autocmpType\");\n\t\t\t\tif(!!autocmp){ el.style.display = (ui.puzzle.painter.autocmp===autocmp ? \"\" : \"none\");}\n\t\t\t}\n\t\t});\n\t}\n};\n\nfunction toBGimage(pid){\n\tvar header;\n\tvar data = {\n\t/* カラーパレットが2色時のHeader(途中まで), 16×16サイズのData Block(途中から) */\n\taho       :['ICAgKCgoC','I4Qdp3vJDxwMtNorV85sQ6RwWhhiZPNF57Q+3udgcjWmLVMAADs='],\n\tamibo     :['P/AwP///y','HoRjqQvI36AKtNrrolx5Hz+BXjeKX4KlVWmSmyt1BQA7'],\n\tayeheya   :['P/ow////y','F4SPGJEN66KctNoGaZ5b9guGIsdoZVUAADs='],\n\tbag       :['P+vg///wC','JYRjl4DbmlqYtNr3mFs67g+FYiZd5uSlYjdyJNim56mytv3CeQEAOw=='],\n\tbarns     :['MDAwID//y','JQyCqZa369hTDtg7cYxT+r51zUVyWSMiYbqKJZl65tOCqDHjZQEAOw=='],\n\tbdblock   :['Dn/pP///y','IoyPqQHb+lJE81RzmdsMeI994EKWJsVJKQqtlouFovydSgEAOw=='],\n\tbonsan    :['P//wMD/wC','JoSPicGqcWCSgBpbJWa81zlR4hNizomeHMh+1wZ2MtssrTmmmVQAADs='],\n\tbox       :['ICAgKCgoC','IgyOCaadxpyKEkHqKH5tLxmEondg5MeBU2WyKziGakfPRwEAOw=='],\n\tcbblock   :['P/QQf///y','H4wDp3vJj+BzUlEIst784rp4lSiRH9igKdNpk2qYRwEAOw=='],\n\tchocona   :['P/AwP///y','IIyPGcDtD1BUM1WpVr6HG69R2yiWFnmamNqh0Ntk8iwXADs='],\n\tcojun     :['MD//////y','I4wfgMvKD+Jrcp6IrcF18ux9DiWOSNldaJqspgu28AZndVYAADs='],\n\tcountry   :['P/Gif///y','IISPGZFtDKB7SDZL78RYna6BjhhO1WdG3siubWZC5FkAADs='],\n\tcreek     :['AD//8H+/y','JIQfGces2tyD8RkrU16XboBVExd1YTmSjXWa5NlirTsjU/k1BQA7'],\n\tfactors   :['AD//////y','IISPqcsWHxp4iKq4cGXayd5dWwN+SXigqHeBawpJ8pwUADs='],\n\tfillmat   :['P//wLP/gS','JoSDAam2yh6SM9pbE4UaT3d0HrWRmDOiXMZ+oLfG5cjIMAnOIlsAADs='],\n\tfillomino :['ODg4P///y','I4QPgcvKn4KU0DhbE7qP3wl608FtDVRq3bkuYZillYxmLlQAADs='],\n\tfirefly   :['ID/gP//wC','JISDpqvRzNySME2EMaAHzuddXEiWlVVSYxRl7riCsqeaG2orBQA7'],\n\tfivecells :['MD/wP///y','IwyOmWbqDaCLCgY7T5NT8vV02fdpYpVRSAmqZ4S145rS7FMAADs='],\n\tfourcells :['MD/wP///y','JoSPELeZrdxjoUJbmTYQ3T1xoEdh1gh+jhqtaZlxGOqK0nvL5o4VADs='],\n\tgoishi    :['P/zwf///y','JoSPiRHK2UA0cU5JVz5V79stFzUq5oly5eOBG8a9sAu/4QetZXoUADs='],\n\tgokigen   :['OD/g////y','HYQPgafbvlKUMD42r9HbZg9W4oh9IdmZaLpSLZcUADs='],\n\thakoiri   :['MD//////y','KISPicEa+UyUYE5KLcSVY81FVyc1JYMq6oKm6zgu2zur8Eoesd6aSgEAOw=='],\n\thanare    :['AD//////y','FYSPqcvtDyMMdNLqLm46WC+F4kgmBQA7'],\n\thashikake :['P///8DAwC','JoQflse829qLMlhLVYQuw8s5F+JtpTJSIKm2UgaAGBxrdI3TU1MAADs='],\n\thebi      :['ID/gMD/wC','FISPqcvtD1WYtM6Is96825pcHVQAADs='],\n\therugolf  :['MD//+H//y','I4SPiRHqwJ6KcrV6KIbXdqNlITeNo3Q+zMo67Ou+ayx/G1IAADs='],\n\theyabon   :['P//wMD/wC','LYyPacDtH9p5LgJ7IYt4V559Clh9Idad0kJ57caimmex7nqNUN2lti8JvSaAAgA7'],\n\theyawake  :['MD/wP///y','F4SPGJEN66KctNoGaZ5b9guGIsdoZVUAADs='],\n\thitori    :['P//QP///y','H4SPFhvpwNpDcVJ2lz11Q+x1HgduonVOZ/qwjpvASAEAOw=='],\n\ticebarn   :['EH9/////y','F4SPqcvt3wJEcpp6g95cW/yAjmiV5nkWADs='],\n\ticelom    :['EH9/////y','GYSPqcvdAYOblMl1UU7b9PN9XkWSkVimaQEAOw=='],\n\ticelom2   :['H///////y','G4SPqcvNEQxsMVX71MWue7SBWjZyywSg38o2BQA7'],\n\tichimaga  :['ODg4P///y','IIyPGcDtfZ4EUdmLzWRxQ+1kovh0HgVO42qhy+nCHBsUADs='],\n\tichimagam :['ODg4P///y','F4yPGcDtD6NTtFojs3639w1m3kiW5lUAADs='],\n\tichimagax :['ODg4P///y','HkSOicDtDyNUtNHKltzcXXsloNKVm2aEqHqYbsQuBQA7'],\n\tjuosan    :['Pjzu9/bqC','H4SPEMm43R5MUoWLZZ1mcz+BIDRGHHU6ToYdJfOiZwEAOw=='],\n\tkaero     :['P/A/////y','KIyPecDtbUB4dE5JIbtSxa1VISaC5sOlmXo6LImOnCt77BxjuPhlbgEAOw=='],\n\tkazunori  :['KD/wND/4C', 'IwyOqaaN7BqMKdiL86xU9vVx4bEtFklBRglcj4a1T0qe9AgUADs='],\n\tkakuro    :['ICAgP///y','F4SPqcut4V5McJ5qAbZ79vg5YTNmZlYAADs='],\n\tkakuru    :['MD/wP///y','HYSPqcut4QA8c1Vq2ZWu7vxpERYmXmeKz6oaJVUAADs='],\n\tkinkonkan :['P//gP///y','JoSDAanmrKBbsDaL7ctoUuwdjBhSWxdyHod+bObCZyetiVuOo1MAADs='],\n\tkouchoku  :['ODg4P///y','IIwDp3vJbxxccqraMKK6xX4BYDh+0SRSTLparevBsVwVADs='],\n\tkramma    :['ID/gMD/wC','IISPGJFt6xqMitEzL8hv+Q+G4idZGkehkeqwpdbBj7wVADs='],\n\tkramman   :['ID/gMD/wC','GYSPqcvtj4IMb85mbcy8+7xxGOho0ImmaQEAOw=='],\n\tkurochute :['PDw8ODg4C','IYSPFpGty9yBUD5qb9QVrER1GTaSUvWdadqILCKW2UzTBQA7'],\n\tkurodoko  :['ICAgMDAwC','H4SPiRHqDaAzMk66Lraa1g6GIhNCn1Kd2aGubUKKSAEAOw=='],\n\tkurotto   :['MDAwODg4C','KYxvoKuIzNKSD8gWMM2T12t5h+ZAncOZaoiu6LZFYtyRmGyHuPqmUF8AADs='],\n\tkusabi    :['MD/wP///y','I4SPqZvh/06QaxoLMMK80uuBYvaRY3eWW6mxqjuuJwQx9r0UADs='],\n\tlightup   :['MD//////y','IIRvgcvKDxycNAY5r6a6I99t2xdijVeN1bqYHJvA0VMAADs='],\n\tlits      :['ICAgKCgoC','IYQRqXmNq9yBUT7alr1wU2Z9gfeRWFiip6RNKfs6otkdBQA7'],\n\tlookair   :['AD//6D//y','GoSPqcsa/5qBUdIgwc07+w92jciQi+lQYFYAADs='],\n\tloopsp    :['P+AgP/Pgy','KYwPeLtpzoCcVDb1Mg7QQb55T9VVGrOBaPqhHomY6iyG2EfCa7dep1EAADs='],\n\tloute     :['IH/gf///y','IYyPaaDB+lJE89TVrssZ+Ph5zUiWG8ShqpSyK9V9Vmg2BQA7'],\n\tmakaro    :['NnZ2e3t7S','I0xgmYDqytpzUa6K7cl1wuh9lnZ93siEompwoOhSHTuz26kUADs='],\n\tmashu     :['P/AwP///y','JoR/kRntvYxCFExb6b0ZS/Y4kdeRXLaVViqFJ1vCndw+oziP+QcUADs='],\n\tmejilink  :['NDQ0P///y','JoxheZrI4VhUE9iLc5ztQc8tz9ZBpPiN4Kq2hwZbpcTS7lk1zlYAADs='],\n\tminarism  :['AD//4H+/y','HYyPqcutAKN8DNBlU75oa/6FoOF141EG0po67vsWADs='],\n\tmochikoro :['AAAAICAgC','IYwDqXmNq9yBUT7alr1wU2Z9gPeRWFiip6RNKfs6otkdBQA7'],\n\tmochinyoro:['MDAwKCgoC','FoSPqct9AaOctNqLs4au+29s4kiWUwEAOw=='],\n\tnagare    :['N/Z/+7r/y','H4SPEJtt7FqItFo678t3ceWF4iGWIWim6sqirbtubQEAOw=='],\n\tnagenawa  :['ACAgACeoC','JYSPacHdCgKUiiaL8NFrO7eF3RiJJWml5geS2QRX8TWxDITnegEAOw=='],\n\tnanro     :['MD//+H//y','IIQfGcet2+KLUlFnL8rs+Q+G4khOWKJtaAqYqavBlwwUADs='],\n\tnawabari  :['MD//////y','IwRihsnK2xI88dnqJM68zhl9G6V5wYmmagc24vZisavWKYsVADs='],\n\tnorinori  :['P/d1MDAwC','I4QfGcet2+KLUlFn8USvJ+Z5YLgZogZdZqYCpfpeMTVXX1MAADs='],\n\tnumlin    :['MDAwP///y','JYyBaJG6Cx6UhzIbacuszaphYkhKG+SVD7eOJpZ2yXepdGuDRgEAOw=='],\n\tnuribou   :['KCgoICAgC','JYQRGYfKug58TlYzbaJbR3w1HTiKn8mdGamGK+ql6Uu7dlnjYQEAOw=='],\n\tnurikabe  :['P+hof/R0S','FoSPqcvtD1eY1NHa7rSaX49F4kiWTAEAOw=='],\n\tnurimaze  :['MD/wP/0/y','I4Qfp4u8aYKcs0WnINBYc+dRlIVtZHeCiMh6JfO9MSitbTwbBQA7'],\n\tpaintarea :['P//wMD/wC','JowDCYfKug58TlYzbaJbR3w1HTiKn8lBZ5oxpOp6rTurIXvL+TsXADs='],\n\tpipelink  :['ID/gM//gy','Kkxgqae4bYCcjs6YaoaY9a99BxWRz4mmi1VeW+d44Px6cWXhrHzG/OMoAAA7'],\n\tpipelinkr :['ID//8D//y','Kkxgqae4bYCcjs6YaoaY9a99BxWRz4mmi1VeW+d44Px6cWXhrHzG/OMoAAA7'],\n\trectslider:['MDAwODg4C','IIxvoKuIzNyBa1Jqb5RB8359mseRkumMG6gCGSSGpSwVADs='],\n\treflect   :['MDAwP///y','HoyPqcvtCMAzMb5aWw5YbfpxVtKJEoONWrhO7gsnBQA7'],\n\trenban    :['ID/gP//wC','JoRjeZrI4FhUM9h7F4yzPfh1mkRp2MmF6iOCLIVaZvrWpF16bnwVADs='],\n\tringring  :['KCgoMDAwC','JwRiqae4bYKctDr3Isw63dp1VsgcYCmeWDmirLpx6/p81n1xJL04BQA7'],\n\tripple    :['AD//////y','IIyBYJG6jRg8sNqLs97RyvZMnxNGo3liKce2XkuBVVAAADs='],\n\troma      :['P/wwf///y','IoSPqXvBGtxrcZpYJ85sc+hJYLiE2Ggm5oas7OWeQMzSWwEAOw=='],\n\tsashigane :['IH/gf///y','HYyPqcsBrcBrskp4LjZz+79p2NQxZRkhaOp4IhgUADs='],\n\tshakashaka:['AAAAICAgC','IoSPqRe7AR2CVAKKHd5q++l9VxgaJMecTXJqoltZ4ypfSwEAOw=='],\n\tshikaku   :['ICAgMDAwC','HoSPGcm43YKctMoIcVab9/N8QPiRjoVe4riyq7kFBQA7'],\n\tshimaguni :['P//wMD/wC','G4yPqavgDx2KFMwKL5as+w+GBqVtJXZWqcgeBQA7'],\n\tshugaku   :['AAAQAAAgC','JoRvoauIzNyBSyYaXp37Nv55GTiKGnWWQESmbguLrISp6ezUFlAAADs='],\n\tshwolf    :['ID/gMD/wC','IQyOiQas6RqcytlXsY569RaE4vhx5Zedx5WulKuamNwFBQA7'],\n\tslalom    :['ID//////y','IIwPecsJDIOLcNJlr3FP76yBF+d9SkmipydSbbWOsVEAADs='],\n\tslither   :['AAAAP///y','F4yPqcutAF5MULqLs978Vjohnxh2ZlYAADs='],\n\tsudoku    :['P//wP///y','HoRvgcvKDxxccp5qY0bY9hiE4khCn7ldabJq6/l8BQA7'],\n\tsukoro    :['MDAwODg4C','JYyPoMin39KDMUwa76p2crd9HGaQF0hpQHeqrOe671p6KEOKSAEAOw=='],\n\ttapa      :['P+hof/R0S','IISPqRAdm9yDR9LqrjY2ZvYhXSd+JNZs2gmxi6vAqlEAADs='],\n\ttasquare  :['ICAgGBgYC','IYxvoKuIzNyBSyYKbMDZcv15HPaMzWR2l1mmFcrCYzsfBQA7'],\n\ttatamibari:['LP/gf///y','HYSPqaHA2x6SM9pETzbbwY9dFTiG5lmmzcq2rlIAADs='],\n\ttateyoko  :['P/AwP///y','H4RjqQvI3+BzJ9hLqUx6R8+BXreRkoZhofiJJvROSgEAOw=='],\n\ttawa      :['MDAwODg4C','GIR/gcud3hRccj57Mai6+8lZIeiNkOlwBQA7'],\n\ttentaisho :['IWL/X23/y','KASCYcum+5qDUx6mYtPZ3u19VZhooVWeBzJK5WNCr7jNsfOyXq6mQAEAOw=='],\n\ttilepaint :['KCgoICAgC','JowDCYfKug58TlYzbaJbR3w1HTiKn8lBZ5oxpOp6rTurIXvL+TsXADs='],\n\ttoichika  :['ID/gP///y','IoSPqRvsGlqSJlp6adXAwreE4nhwooeYWWlW6ZpObfeRYQEAOw=='],\n\ttriplace  :['MD/wP///y','JgyOCXas6dxrKNiLb51xv0593lJhI6ig0jlCZQabEzuHZH0v8V4AADs='],\n\tusotatami :['MD/wP//wC','KIQTppqcvc6BMKIKsIuZN10hjDdZnkguKNeV2ri+pQquKi2l9nulQAEAOw=='],\n\twagiri    :['P/rw////y','IIQPEci42dgzs1Ua77na7ShBoNR1YpilKmqtrOd+MVUAADs='],\n\tyajikazu  :['P/B/f///y','HoSPEMm5DZ8JtNoKmcyTo+1loBh25YVSX3mMnMsyBQA7'],\n\tyajirin   :['MD/wP///y','HISDicas2tpL0c1Qs968nwuGl0eWHqihmVqxRgEAOw=='],\n\tyajitatami:['MD/wP//wC','J4wPeRvpj9SbwLhG4WV8aZkpWBVWFkh1HHSSZTuGY7ypXYnSE/y2BQA7'],\n\tyosenabe  :['ODg/////y','JIwDd6nGjdqD0VFZr5qg+4ltGgiKJkWO4bJ8nVhCT8yeq20dBQA7'],\n\n\t/* カラーパレットが3-4色時のHeader(途中まで), 16×16サイズのData Block(途中から) */\n\tbosanowa  :['P/AwP/hw////////y','LowtAst5l1gTL6Q4r968e5VR0CUBToVJ55NOlQWqIhsvGv3l+j22/FgyzYAlRwEAOw=='],\n\tdosufuwa  :['JmZmbKysszMzP///y','KUyAYMuW3lhCMJ6plMXZXu59TyiSpIAKZmqoXoq2L6y6EV3PeLifbFAAADs='],\n\tsukororoom:['NDQ0ODg4PDw8P///y','NIwfgqebBqJpS8X7nL0g18B1FNJgHukkwsqu6ZiioISYmzljN51LewfhZHBBICw2aSmXggIAOw=='],\n\tview      :['MD/wP//wP///////y','LoQtEst5l1gTDykZXNq8+99hThWJFHlJ41OqJ5tOFdDKaAbmOnebc71YQWJBSgEAOw=='],\n\twblink    :['NDQ0ODg4Pj4+P///y','LoQdIct5l1gLDykpXNq8+99hThWJFHlJ41OqJ5tOFdDKaAbmOnebc71YQWJBSgEAOw==']\n\t}[pid];\n\n\t/* 無い場合はimage.gifを返します */\n\tif(!data){ data=['MD/wPD/8C','KYQTpogKnFxbMDpa7W18yjhp1yGO1OidW5mSKFuaTyy585t0ctZ+EFAAADs='];}\n\n\tif(data[0].length<=10){ header='R0lGODdhEAAQAIAAA';}\n\telse                  { header='R0lGODdhEAAQAKEAA';}\n\n\treturn \"data:image/gif;base64,\"+header+data[0]+'wAAAAAEAAQAAAC'+data[1];\n}\n","// Boot.js v3.4.0\n/* jshint latedef:false */\n/* global ui:false, ActiveXObject:false */\n\n(function(){\n/********************************/\n/* 初期化時のみ使用するルーチン */\n/********************************/\n\nvar require_accesslog = true;\nvar onload_pzl = null;\nvar onload_option = {};\n\n//---------------------------------------------------------------------------\n// ★boot() window.onload直後の処理\n//---------------------------------------------------------------------------\npzpr.on('load', function boot(){\n\tif(importData() && includeDebugFile()){ startPuzzle();}\n\telse{ setTimeout(boot,0);}\n});\n\nfunction importData(){\n\tif(!onload_pzl){\n\t\t/* 1) 盤面複製・index.htmlからのファイル入力/Database入力か */\n\t\t/* 2) URL(?以降)をチェック */\n\t\tonload_pzl = (importFileData() || importURL());\n\t\t\n\t\t/* 指定されたパズルがない場合はさようなら～ */\n\t\tif(!onload_pzl || !onload_pzl.pid){ failOpen();}\n\t}\n\t\n\treturn true;\n}\n\nfunction failOpen(){\n\tif(!!ui.puzzle && !!ui.puzzle.pid){ return;}\n\tvar title2 = document.getElementById('title2');\n\tif(!!title2){ title2.innerHTML = \"Fail to import puzzle data or URL.\";}\n\tdocument.getElementById('menupanel').innerHTML = '';\n\t//throw new Error(\"No Include Puzzle Data Exception\");\n}\n\nfunction includeDebugFile(){\n\tvar pid = onload_pzl.pid, result = true;\n\t\n\t/* 必要な場合、テスト用ファイルのinclude         */\n\t/* importURL()後でないと必要かどうか判定できない */\n\tif(ui.debugmode){\n\t\tif(!ui.debug){\n\t\t\tresult = false;\n\t\t}\n\t\telse if(!ui.debug.urls){\n\t\t\tui.debug.includeDebugScript(\"for_test.js\");\n\t\t\tresult = false;\n\t\t}\n\t\telse if(!ui.debug.urls[pid]){\n\t\t\tui.debug.includeDebugScript(\"test_\"+pid+\".js\");\n\t\t\tresult = false;\n\t\t}\n\t}\n\t\n\treturn result;\n}\n\nfunction startPuzzle(){\n\tvar pzl = onload_pzl, pid = pzl.pid;\n\tif(ui.debugmode){ onload_option.mode = 'play';}\n\t\n\t/* IE SVGのtextLengthがうまく指定できていないので回避策を追加 */\n\tif((function(ua){ return ua.match(/MSIE/) || (ua.match(/AppleWebKit/) && ua.match(/Edge/));})(navigator.userAgent)){\n\t\tonload_option.graphic = 'canvas';\n\t}\n\t\n\t/* パズルオブジェクトの作成 */\n\tvar element = document.getElementById('divques');\n\tvar puzzle = ui.puzzle = new pzpr.Puzzle(element, onload_option);\n\tpzpr.connectKeyEvents(puzzle);\n\t\n\t/* パズルオブジェクト作成〜open()間に呼ぶ */\n\tui.event.onload_func();\n\t\n\t// 単体初期化処理のルーチンへ\n\tvar callback = null;\n\tif(!ui.debugmode){ callback = accesslog;}\n\telse{ puzzle.once('ready', function(puzzle){ ui.menuconfig.set('autocheck', true);});}\n\tif(!ui.debugmode && require_accesslog && onload_option.type!=='player'){ puzzle.once('ready', countpid);}\n\tpuzzle.once('fail-open', failOpen);\n\tpuzzle.open((!ui.debugmode || !!pzl.qdata) ? pzl : pid+\"/\"+ui.debug.urls[pid], callback);\n\t\n\treturn true;\n}\n\n//---------------------------------------------------------------------------\n// ★importURL() 初期化時にURLを解析し、パズルの種類・エディタ/player判定を行う\n//---------------------------------------------------------------------------\nfunction importURL(){\n\t/* index.htmlからURLが入力されたかチェック */\n\tvar search = getStorageData('pzprv3_urldata', 'urldata');\n\tif(!!search){ require_accesslog = false;}  /* index.htmlからのURL読み込み時はアクセスログをとらない */\n\t\n\t/* index.htmlからURLが入力されていない場合は現在のURLの?以降をとってくる */\n\tsearch = search || location.search;\n\tif(!search){ return null;}\n\t\n\t/* 一旦先頭の?記号を取り除く */\n\tif(search.charAt(0)===\"?\"){ search = search.substr(1);}\n\t\n\twhile(search.match(/^(\\w+)\\=(\\w+)\\&(.*)/)){\n\t\tonload_option[RegExp.$1] = RegExp.$2;\n\t\tsearch = RegExp.$3;\n\t}\n\t\n\t// エディタモードかplayerモードか、等を判定する\n\tif(search===\"test\"){ search = 'country_test';}\n\t\n\tvar startmode = '';\n\tif     (search.match(/_test/)){ startmode = 'EDITOR'; ui.debugmode = true;}\n\telse if(search.match(/^m\\+/)) { startmode = 'EDITOR';}\n\telse if(search.match(/_edit/)){ startmode = 'EDITOR';}\n\telse if(search.match(/_play/)){ startmode = 'PLAYER';}\n\tif(!require_accesslog){ startmode = 'EDITOR';}  /* index.htmlからの読み込み時はEDITORにする */\n\n\tsearch=search.replace(/^m\\+/,'');\n\tsearch=search.replace(/(_test|_edit|_play)/,'');\n\n\tvar pzl = pzpr.parser.parseURL(search);\n\n\tstartmode = startmode || (!pzl.body ? 'EDITOR' : 'PLAYER');\n\tif(startmode==='PLAYER'){ onload_option.type = 'player';}\n\n\treturn pzl;\n}\n\n//---------------------------------------------------------------------------\n// ★importFileData() 初期化時にファイルデータの読み込みを行う\n//---------------------------------------------------------------------------\nfunction importFileData(){\n\t/* index.htmlや盤面の複製等でファイルorブラウザ保存データが入力されたかチェック */\n\tvar fstr = getStorageData('pzprv3_filedata', 'filedata');\n\tif(!fstr){ return null;}\n\n\tvar pzl = pzpr.parser.parseFile(fstr, '');\n\tif(!pzl){ return null;}\n\n\trequire_accesslog = false;\n\t\n\treturn pzl;\n}\n\n//---------------------------------------------------------------------------\n// ★getStorageData() localStorageやsesseionStorageのデータを読み込む\n//---------------------------------------------------------------------------\nfunction getStorageData(key, key2){\n\t// 移し変える処理\n\tvar str = localStorage[key];\n\tif(typeof str===\"string\"){\n\t\tdelete localStorage[key];\n\t\tsessionStorage[key2] = str;\n\t}\n\n\tstr = sessionStorage[key2];\n\treturn (typeof str===\"string\" ? str : null);\n}\n\n//---------------------------------------------------------------------------\n// ★countpid() エディタとして開いた回数をログする\n//---------------------------------------------------------------------------\nfunction countpid(puzzle){\n\tvar counts = JSON.parse(localStorage['pzprv3_index:ranking']||'{}');\n\t\n\t// パズルの開いた数を記録\n\tvar count = counts.count || {};\n\tvar cnt = count[puzzle.pid] || 0;\n\tcount[puzzle.pid] = cnt + 1;\n\t\n\t// 最新10パズルを記録\n\tvar recent = counts.recent || [];\n\tif(recent.indexOf(puzzle.pid)>=0){ recent.splice(recent.indexOf(puzzle.pid),1);}\n\trecent.unshift(puzzle.pid);\n\tif(recent.length>10){ recent.pop();}\n\t\n\tlocalStorage['pzprv3_index:ranking'] = JSON.stringify({count:count,recent:recent});\n}\n\n//---------------------------------------------------------------------------\n// ★accesslog() playerのアクセスログをとる\n//---------------------------------------------------------------------------\nfunction accesslog(puzzle){\n\tif(!puzzle.playeronly || !onload_pzl.pid || !require_accesslog){ return;}\n\n\tif(document.domain!=='indi.s58.xrea.com' &&\n\t   document.domain!=='pzprv3.sakura.ne.jp' &&\n\t   !document.domain.match(/(dev\\.)?pzv\\.jp/)){ return;}\n\n\tvar refer = document.referrer;\n\tif(refer.match(/http\\:\\/\\/[\\w\\.]*pzv\\.jp/)){ return;}\n\n\trefer = refer.replace(/\\?/g,\"%3f\").replace(/\\&/g,\"%26\")\n\t\t\t\t .replace(/\\=/g,\"%3d\").replace(/\\//g,\"%2f\");\n\n\t// 送信\n\tvar xmlhttp = false;\n\tif(typeof ActiveXObject !== \"undefined\"){\n\t\ttry { xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\");}\n\t\tcatch (e) { xmlhttp = false;}\n\t}\n\tif(!xmlhttp && typeof XMLHttpRequest !== \"undefined\") {\n\t\txmlhttp = new XMLHttpRequest();\n\t}\n\tif(xmlhttp){\n\t\tvar data = [\n\t\t\t(\"scr=\"     + \"pzprv3\"),\n\t\t\t(\"pid=\"     + onload_pzl.pid),\n\t\t\t(\"referer=\" + refer),\n\t\t\t(\"pzldata=\" + onload_pzl.qdata)\n\t\t].join('&');\n\n\t\txmlhttp.open(\"POST\", \"./record.cgi\");\n\t\txmlhttp.onreadystatechange = function(){};\n\t\txmlhttp.setRequestHeader(\"Content-Type\" , \"application/x-www-form-urlencoded\");\n\t\txmlhttp.send(data);\n\t}\n}\n\n})();\n","// Event.js v3.4.0\n/* global ui:false, _doc:false */\n\n//---------------------------------------------------------------------------\n// ★UIEventsクラス イベント設定の管理を行う\n//---------------------------------------------------------------------------\n// メニュー描画/取得/html表示系\nui.event =\n{\n\tresizetimer : null,\t// resizeタイマー\n\n\tremovers : [],\n\n\t//----------------------------------------------------------------------\n\t// event.addEvent()        addEventListener(など)を呼び出す\n\t//----------------------------------------------------------------------\n\taddEvent : function(el, event, self, callback, capt){\n\t\tthis.removers.push( pzpr.util.addEvent(el, event, self, callback, !!capt) );\n\t},\n\n\t//----------------------------------------------------------------------\n\t// event.removeAllEvents() addEventで登録されたイベントを削除する\n\t//----------------------------------------------------------------------\n\tremoveAllEvents : function(){\n\t\tthis.removers.forEach(function(remover){ remover();});\n\t\tthis.removers=[];\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// event.setWindowEvents()  マウス入力、キー入力以外のイベントの設定を行う\n\t//---------------------------------------------------------------------------\n\tsetWindowEvents : function(){\n\t\t// File API＋Drag&Drop APIの設定\n\t\tif(!!ui.reader){\n\t\t\tvar DDhandler = function(e){\n\t\t\t\tui.reader.readAsText(e.dataTransfer.files[0]);\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t};\n\t\t\tthis.addEvent(window, 'dragover', this, function(e){ e.preventDefault();}, true);\n\t\t\tthis.addEvent(window, 'drop', this, DDhandler, true);\n\t\t}\n\n\t\t// onBlurにイベントを割り当てる\n\t\tthis.addEvent(_doc, 'blur', this, this.onblur_func);\n\n\t\t// onresizeイベントを割り当てる\n\t\tvar evname = (!pzpr.env.OS.iOS ? 'resize' : 'orientationchange');\n\t\tthis.addEvent(window, evname, this, this.onresize_func);\n\n\t\t// onbeforeunloadイベントを割り当てる\n\t\tthis.addEvent(window, 'beforeunload', this, this.onbeforeunload_func);\n\n\t\t// onunloadイベントを割り当てる\n\t\tthis.addEvent(window, 'unload', this, this.onunload_func);\n\n\t\t// エラー表示を消去する\n\t\tthis.addEvent(document.getElementById('quesboard'), 'mousedown', this, function(e){\n\t\t\tui.puzzle.errclear();\n\t\t\te.stopPropagation();\n\t\t});\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// event.onload_func()   ウィンドウを開いた時に呼ばれる関数\n\t// event.onunload_func() ウィンドウをクローズする前に呼ばれる関数\n\t//---------------------------------------------------------------------------\n\tonload_func : function(){\n\t\tui.initFileReadMethod();\n\t\t\n\t\tui.menuconfig.restore();\n\t\t\n\t\tui.listener.setListeners(ui.puzzle);\n\t\t\n\t\tif(pzpr.env.OS.Android){\n\t\t\tui.misc.modifyCSS({'body, .btn':{fontFamily:'Verdana, Arial, sans-serif'}});\n\t\t}\n\t},\n\tonunload_func : function(){\n\t\tui.menuconfig.save();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// event.onresize_func() ウィンドウリサイズ時に呼ばれる関数\n\t// event.onblur_func()   ウィンドウからフォーカスが離れた時に呼ばれる関数\n\t// event.onbeforeunload_func()  ウィンドウをクローズする前に呼ばれる関数\n\t//---------------------------------------------------------------------------\n\tonresize_func : function(){\n\t\tif(this.resizetimer){ clearTimeout(this.resizetimer);}\n\t\tthis.resizetimer = setTimeout(function(){ ui.adjustcellsize();},250);\n\t},\n\tonblur_func : function(){\n\t\tui.puzzle.key.keyreset();\n\t\tui.puzzle.mouse.mousereset();\n\t},\n\tonbeforeunload_func : function(e){\n\t\tif(ui.puzzle.playeronly || !ui.puzzle.ismodified()){ return;}\n\t\t\n\t\tvar msg = ui.selectStr(\"盤面が更新されています\", \"The board is edited.\");\n\t\te.returnValue = msg;\n\t\treturn msg;\n\t}\n};\n","// Listener.js v3.4.1\n/* global ui:false */\n\n//---------------------------------------------------------------------------\n// ★UIListener Puzzleに付加するListenerイベント設定の管理を行う\n//  注意：execListenerで呼び出される関数は、thisがui.listenerになっていません\n//---------------------------------------------------------------------------\nui.listener =\n{\n\t//---------------------------------------------------------------------------\n\t// listener.setListeners()  PuzzleのListenerを登録する\n\t//---------------------------------------------------------------------------\n\tsetListeners : function(puzzle){\n\t\tpuzzle.once('ready',  this.onFirstReady);\n\t\tpuzzle.on('ready',    this.onReady);\n\t\t\n\t\tpuzzle.on('key',      this.onKeyInput);\n\t\tpuzzle.on('mouse',    this.onMouseInput);\n\t\tpuzzle.on('history',  this.onHistoryChange);\n\t\tpuzzle.on('trial',    this.onTrialModeChange);\n\t\tpuzzle.on('mode',     this.onModeChange);\n\t\t\n\t\tpuzzle.on('adjust',     this.onAdjust);\n\t\tpuzzle.on('resize',     this.onResize);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// listener.onFirstReady() 初回のパズル読み込み完了時に呼び出される関数\n\t// listener.onReady()  パズル読み込み完了時に呼び出される関数\n\t//---------------------------------------------------------------------------\n\tonFirstReady : function(puzzle){\n\t\tui.initImageSaveMethod(puzzle);\n\t},\n\tonReady : function(puzzle){\n\t\t/* パズルの種類が同じならMenuArea等の再設定は行わない */\n\t\tif(ui.currentpid !== puzzle.pid){\n\t\t\t/* 以前設定済みのイベントを削除する */\n\t\t\tui.event.removeAllEvents();\n\t\t\t\n\t\t\t/* menuareaより先に キーポップアップを作成する必要がある */\n\t\t\tui.keypopup.create();\n\t\t\t\n\t\t\t/* メニュー用の設定を消去・再設定する */\n\t\t\tui.menuarea.reset();\n\t\t\tui.toolarea.reset();\n\t\t\tui.popupmgr.reset();\n\t\t\tui.notify.reset();\n\t\t\tui.misc.displayDesign();\n\t\t\t\n\t\t\t/* Windowへのイベント設定 */\n\t\t\tui.event.setWindowEvents();\n\t\t}\n\t\t\n\t\tui.menuconfig.sync();\n\t\tui.menuconfig.set('autocheck_once', ui.menuconfig.get('autocheck'));\n\t\tui.currentpid = puzzle.pid;\n\t\t\n\t\tui.adjustcellsize();\n\t\tui.keypopup.display();\n\t\t\n\t\tui.timer.reset();\t\t\t\t\t/* タイマーリセット(最後) */\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// listener.onKeyInput()    キー入力時に呼び出される関数 (return false = 処理をキャンセル)\n\t// listener.onMouseInput()  盤面へのマウス入力時に呼び出される関数 (return false = 処理をキャンセル)\n\t//---------------------------------------------------------------------------\n\tonKeyInput : function(puzzle, c){\n\t\tvar kc = puzzle.key, ut = ui.undotimer, result = true;\n\t\tif(kc.keydown){\n\t\t\t/* TimerでUndo/Redoする */\n\t\t\tif(c==='ctrl+z' || c==='meta+z'){ ut.startKeyUndo(); result = false;}\n\t\t\tif(c==='ctrl+y' || c==='meta+y'){ ut.startKeyRedo(); result = false;}\n\n\t\t\t/* F2で回答モード Shift+F2で問題作成モード */\n\t\t\tif(!puzzle.playeronly){\n\t\t\t\tif     (puzzle.editmode && c==='F2'      ){ ui.menuconfig.set(\"mode\", puzzle.MODE_PLAYER); result = false;}\n\t\t\t\telse if(puzzle.playmode && c==='shift+F2'){ ui.menuconfig.set(\"mode\", puzzle.MODE_EDITOR); result = false;}\n\t\t\t}\n\n\t\t\t/* デバッグ用ルーチンを通す */\n\t\t\tif(ui.debug.keydown(c)){ result = false;}\n\t\t}\n\t\telse if(kc.keyup){\n\t\t\t/* TimerのUndo/Redoを停止する */\n\t\t\tif(c==='ctrl+z' || c==='meta+z'){ ut.stopKeyUndo(); result = false;}\n\t\t\tif(c==='ctrl+y' || c==='meta+y'){ ut.stopKeyRedo(); result = false;}\n\t\t}\n\t\t\n\t\tif(!kc.isCTRL && !kc.isMETA){ ut.reset();}\n\t\telse if(!kc.isZ){ ut.stopKeyUndo();}\n\t\telse if(!kc.isY){ ut.stopKeyRedo();}\n\t\t\n\t\tkc.cancelEvent = !result;\n\t},\n\tonMouseInput : function(puzzle){\n\t\tvar mv = puzzle.mouse, result = true;\n\t\tif(mv.mousestart && mv.btn==='middle'){ /* 中ボタン */\n\t\t\tui.menuconfig.set('mode', puzzle.playmode ? 'edit' : 'play');\n\t\t\tmv.mousereset();\n\t\t\tresult = false;\n\t\t}\n\t\telse if(ui.puzzle.pid === \"goishi\"){\n\t\t\tif(mv.mousestart && ui.puzzle.playmode){\n\t\t\t\tif(mv.btn==='left'){\n\t\t\t\t\tvar cell = mv.getcell();\n\t\t\t\t\tif(cell.isnull || !cell.isStone() || cell.anum!==-1){\n\t\t\t\t\t\tui.undotimer.startAnswerRedo();\n\t\t\t\t\t\tresult = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(mv.btn==='right'){\n\t\t\t\t\tui.undotimer.startAnswerUndo();\n\t\t\t\t\tresult = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(mv.mouseend){\n\t\t\t\tui.undotimer.stop();\n\t\t\t\tresult = false;\n\t\t\t}\n\t\t}\n\t\t\n\t\tmv.cancelEvent = !result;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// listener.onHistoryChange() 履歴変更時に呼び出される関数\n\t// listener.onTrialModeChange() 仮置きモード変更時に呼び出される関数\n\t// listener.onModeChange()      Mode変更時に呼び出される関数\n\t//---------------------------------------------------------------------------\n\tonHistoryChange : function(puzzle){\n\t\tif(!!ui.currentpid){\n\t\t\tui.setdisplay(\"operation\");\n\t\t}\n\t},\n\tonTrialModeChange : function(puzzle, trialstage){\n\t\tif(!!ui.currentpid){\n\t\t\tui.setdisplay(\"trialmode\");\n\t\t}\n\t},\n\tonModeChange : function(puzzle){\n\t\tui.menuconfig.list.mode.val = (ui.puzzle.playmode ? 'play' : 'edit');\n\t\tui.setdisplay('mode');\n\t\tui.menuconfig.set('inputmode', ui.puzzle.mouse.inputMode);\n\t\t\n\t\tui.setdisplay('keypopup');\n\t\tui.setdisplay('bgcolor');\n\t\tui.setdisplay('passallcell');\n\t\tui.keypopup.display();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// listener.onAdjust()  盤面の大きさが変わったときの処理を呼び出す\n\t//---------------------------------------------------------------------------\n\tonAdjust : function(puzzle){\n\t\tui.adjustcellsize();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// listener.onResize()  canvasのサイズを変更したときの処理を呼び出す\n\t//---------------------------------------------------------------------------\n\tonResize : function(puzzle){\n\t\tvar pc = puzzle.painter, cellsize = Math.min(pc.cw, pc.ch);\n\t\tvar val = (ui.getBoardPadding()*cellsize)|0, valTop = val;\n\t\tif(puzzle.pid==='starbattle'||puzzle.pid==='easyasabc'){\n\t\t\tvalTop = ((0.05*cellsize)|0)+'px';\n\t\t}\n\t\tpuzzle.canvas.parentNode.style.padding = val+'px';\n\t\tpuzzle.canvas.parentNode.style.paddingTop = valTop+'px';\n\t\t\n\t\tui.keypopup.resizepanel();\n\t}\n};\n","// MenuConfig.js v3.4.1\n/* global pzpr:false, ui:false, JSON:false */\n\n(function(){\n//---------------------------------------------------------------------------\n// ★MenuConfigクラス UI側の設定値を管理する\n//---------------------------------------------------------------------------\nvar Config = pzpr.Puzzle.prototype.Config.prototype;\n\n// メニュー描画/取得/html表示系\n// Menuクラス\nui.menuconfig = {\n\n\tlist : null,\t\t\t// MenuConfigの設定内容を保持する\n\n\t//---------------------------------------------------------------------------\n\t// menuconfig.init()  MenuConfigの初期化を行う\n\t// menuconfig.add()   初期化時に設定を追加する\n\t//---------------------------------------------------------------------------\n\tinit : function(){\n\t\tthis.list = {};\n\t\t\n\t\tthis.add('autocheck',      ui.puzzle.playeronly);\t\t\t\t\t/* 正解自動判定機能 */\n\t\tthis.add('autocheck_once', ui.puzzle.playeronly, {volatile:true});\t/* 正解自動判定機能 */\n\t\t\n\t\tthis.add('keypopup', false);\t\t\t\t\t\t/* キーポップアップ (数字などのパネル入力) */\n\n\t\tthis.add('adjsize', true);\t\t\t\t\t\t\t/* 自動横幅調節 */\n\t\tthis.add('cellsizeval', (ui.windowWidth()<=960?36:48));\t/* セルのサイズ設定用 */\n\t\tthis.add('fullwidth', (ui.windowWidth()<600));\t\t/* キャンバスを横幅いっぱいに広げる */\n\t\t\n\t\tthis.add('toolarea', true);\t\t\t\t\t\t\t/* ツールエリアの表示 */\n\t\t\n\t\tthis.add('inputmode', 'auto', {volatile:true});\t\t/* inputMode */\n\t\t\n\t\tthis.add('lrinvert', false, {volatile:true});\t\t/* マウスの左右ボタンを反転する設定 */\n\t\t\n\t\tthis.add('language', pzpr.lang, {option:['en','ja']});\t/* 言語設定 */\n\n\t\t/* puzzle.configを一括で扱うため登録 */\n\t\tfor(var name in ui.puzzle.config.list){\n\t\t\tvar item = ui.puzzle.config.list[name], extoption = {puzzle:true};\n\t\t\tif(!!item.option){ extoption.option = item.option;}\n\t\t\tthis.add(name, item.defval, extoption);\n\t\t}\n\t\tthis.add('mode', (!ui.puzzle.playmode?'edit':'play'), {option:['edit','play'], puzzle:true});\n\t},\n\tadd : function(name, defvalue, extoption){\n\t\tConfig.add.call(this, name, defvalue, extoption);\n\t\tif(!!extoption && extoption.puzzle){\n\t\t\tvar item = this.list[name];\n\t\t\titem.volatile = item.puzzle = true;\n\t\t}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// menuconfig.sync()  URL形式などによって変化する可能性がある設定値を同期する\n\t//---------------------------------------------------------------------------\n\tsync : function(){\n\t\tvar idname = null;\n\t\tswitch(ui.puzzle.pid){\n\t\t\tcase 'yajirin':   idname = 'disptype_yajilin';   break;\n\t\t\tcase 'pipelinkr': idname = 'disptype_pipelinkr'; break;\n\t\t\tcase 'bosanowa':  idname = 'disptype_bosanowa';  break;\n\t\t}\n\t\tif(!!idname){ this.set(idname, ui.puzzle.getConfig(idname));}\n\t\t\n\t\tthis.set('lrinvert', ui.puzzle.mouse.inversion);\n\t\tthis.set('autocmp',  ui.puzzle.getConfig('autocmp'));\n\t\tthis.set('autoerr',  ui.puzzle.getConfig('autoerr'));\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// menuconfig.getCurrentName()  指定されたidを現在使用している名前に変換する\n\t//---------------------------------------------------------------------------\n\tgetCurrentName : Config.getCurrentName,\n\tgetNormalizedName : Config.getNormalizedName,\n\n\t//---------------------------------------------------------------------------\n\t// menuconfig.get()  各フラグの設定値を返す\n\t// menuconfig.get()  各フラグの設定値を返す\n\t// menuconfig.reset() 各フラグの設定値を初期化する\n\t//---------------------------------------------------------------------------\n\tget : Config.get,\n\tset : function(argname, newval){\n\t\tvar names = this.getNormalizedName(argname), idname = names.name;\n\t\tif(!this.list[idname]){ return;}\n\t\tif(idname==='mode'){ ui.puzzle.setMode(newval); newval = (!ui.puzzle.playmode?'edit':'play');}\n\t\telse if(idname==='inputmode'){ ui.puzzle.mouse.setInputMode(newval); newval = ui.puzzle.mouse.inputMode;}\n\t\t\n\t\tnewval = this.setproper(names, newval);\n\t\t\n\t\tif(idname==='language'){ pzpr.lang = newval;}\n\t\telse if(this.list[idname].puzzle){ ui.puzzle.setConfig(argname, newval);}\n\t\t\n\t\tthis.configevent(idname,newval);\n\t},\n\treset : Config.reset,\n\n\t//---------------------------------------------------------------------------\n\t// menuconfig.restore()  保存された各種設定値を元に戻す\n\t// menuconfig.save()     各種設定値を保存する\n\t//---------------------------------------------------------------------------\n\trestore : function(){\n\t\t/* 設定が保存されている場合は元に戻す */\n\t\tui.puzzle.config.init();\n\t\tthis.init();\n\t\tvar json_puzzle = localStorage['pzprv3_config:puzzle'];\n\t\tvar json_menu   = localStorage['pzprv3_config:ui'];\n\t\tif(!!json_puzzle){ this.setAll(JSON.parse(json_puzzle));}\n\t\tif(!!json_menu)  { this.setAll(JSON.parse(json_menu));}\n\t},\n\tsave : function(){\n\t\tlocalStorage['pzprv3_config:puzzle'] = JSON.stringify(ui.puzzle.saveConfig());\n\t\tlocalStorage['pzprv3_config:ui']     = JSON.stringify(this.getAll());\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// menuconfig.getList()  現在有効な設定値のリストを返す\n\t//---------------------------------------------------------------------------\n\tgetList : Config.getList,\n\tgetexec : function(name){\n\t\tif(!this.list[name]){ return false;}\n\t\tif(name==='mode'){ return !ui.puzzle.playeronly;}\n\t\telse if(this.list[name].puzzle){ return ui.puzzle.validConfig(name);}\n\t\treturn true;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// menuconfig.getAll()  全フラグの設定値を返す\n\t// menuconfig.setAll()  全フラグの設定値を設定する\n\t//---------------------------------------------------------------------------\n\tgetAll : Config.getAll,\n\tsetAll : function(setting){\n\t\tfor(var key in setting){ this.set(key,setting[key]);}\n\t\tthis.list.autocheck_once.val = this.list.autocheck.val;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// menuconfig.setproper()    設定値の型を正しいものに変換して設定変更する\n\t// menuconfig.valid()        設定値が有効なパズルかどうかを返す\n\t//---------------------------------------------------------------------------\n\tsetproper : Config.setproper,\n\tvalid : function(idname){\n\t\tif(!this.list[idname]){ return false;}\n\t\tif(idname===\"keypopup\"){ return (ui.keypopup.paneltype[1]!==0 || ui.keypopup.paneltype[3]!==0);}\n\t\telse if(idname==='mode'){ return !ui.puzzle.playeronly;}\n\t\telse if(idname==='inputmode'){ return (ui.puzzle.mouse.getInputModeList('play').length>1 || (!ui.puzzle.playeronly && ui.puzzle.mouse.getInputModeList('edit').length>1));}\n\t\telse if(this.list[idname].puzzle){ return ui.puzzle.validConfig(idname);}\n\t\treturn true;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// config.configevent()  設定変更時の動作を記述する (modeはlistener.onModeChangeで変更)\n\t//---------------------------------------------------------------------------\n\tconfigevent : function(idname, newval){\n\t\tif(!ui.menuarea.menuitem){ return;}\n\t\tui.setdisplay(idname);\n\t\tswitch(idname){\n\t\tcase 'keypopup':\n\t\t\tui.keypopup.display();\n\t\t\tbreak;\n\t\t\t\n\t\tcase 'adjsize': case 'cellsizeval': case 'fullwidth':\n\t\t\tui.adjustcellsize();\n\t\t\tbreak;\n\t\t\t\n\t\tcase 'autocheck':\n\t\t\tthis.list.autocheck_once.val = newval;\n\t\t\tbreak;\n\t\t\n\t\tcase 'language':\n\t\t\tui.displayAll();\n\t\t\tbreak;\n\t\t\n\t\tcase 'lrinvert':\n\t\t\tui.puzzle.mouse.setInversion(newval);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\n})();","// MenuArea.js v3.4.0\n/* global ui:false, getEL:false, _doc:false */\n\n// メニュー描画/取得/html表示系\nui.menuarea = {\n\tcaptions : [],\t\t\t\t// 言語指定を切り替えた際のキャプションを保持する\n\tmenuitem : null,\t\t\t// メニューの設定切り替え用エレメント等を保持する\n\tnohover : false,\t\t\t// :hover擬似クラスを使用しないでhover表示する\n\t\n\t//---------------------------------------------------------------------------\n\t// menuarea.reset()  メニュー、サブメニュー、フロートメニューの初期設定を行う\n\t//---------------------------------------------------------------------------\n\treset : function(){\n\t\tthis.createMenu();\n\t\t\n\t\tthis.display();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// menuarea.createMenu()  メニューの初期設定を行う\n\t//---------------------------------------------------------------------------\n\tcreateMenu : function(){\n\t\tif(this.menuitem===null){\n\t\t\tthis.modifySelector();\n\t\t\t\n\t\t\tthis.menuitem = {};\n\t\t\tthis.walkElement(getEL(\"menupanel\"));\n\t\t}\n\t\tui.misc.displayByPid(getEL(\"menupanel\"));\n\t\tthis.stopHovering();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// menuarea.walkElement()  エレメントを探索して領域の初期設定を行う\n\t//---------------------------------------------------------------------------\n\twalkElement : function(parent){\n\t\tvar menuarea = this;\n\t\tfunction menufactory(role){\n\t\t\treturn function(e){ menuarea[role](e); if(menuarea.nohover){ e.preventDefault(); e.stopPropagation();}};\n\t\t}\n\t\tfunction addmenuevent(el,type,role){\n\t\t\tvar func = (typeof role==='function' ? role : menufactory(role));\n\t\t\tpzpr.util.addEvent(el, type, menuarea, func);\n\t\t}\n\t\tui.misc.walker(parent, function(el){\n\t\t\tif(el.nodeType===1 && el.nodeName===\"LI\"){\n\t\t\t\tvar setevent = false;\n\t\t\t\tvar idname = ui.customAttr(el,\"config\");\n\t\t\t\tif(!!idname){\n\t\t\t\t\tmenuarea.menuitem[idname] = {el:el};\n\t\t\t\t\tif(el.className===\"check\"){\n\t\t\t\t\t\taddmenuevent(el, \"mousedown\", \"checkclick\");\n\t\t\t\t\t\tsetevent = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar value = ui.customAttr(el,\"value\");\n\t\t\t\tif(!!value){\n\t\t\t\t\tvar parent = el.parentNode.parentNode, idname = ui.customAttr(parent,\"config\");\n\t\t\t\t\tvar item = menuarea.menuitem[idname];\n\t\t\t\t\tif(!item.children){ item.children=[];}\n\t\t\t\t\titem.children.push(el);\n\t\t\t\t\t\n\t\t\t\t\taddmenuevent(el, \"mousedown\", \"childclick\");\n\t\t\t\t\tsetevent = true;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar role = ui.customAttr(el,\"menuExec\");\n\t\t\t\tif(!!role){\n\t\t\t\t\taddmenuevent(el, \"mousedown\", role);\n\t\t\t\t\tsetevent = true;\n\t\t\t\t}\n\t\t\t\trole = ui.customAttr(el,\"pressExec\");\n\t\t\t\tif(!!role){\n\t\t\t\t\tvar roles = role.split(/,/);\n\t\t\t\t\taddmenuevent(el, \"mousedown\", roles[0]);\n\t\t\t\t\tif(!!role[1]){\n\t\t\t\t\t\taddmenuevent(el, \"mouseup\", roles[1]);\n\t\t\t\t\t\taddmenuevent(el, \"mouseleave\", roles[1]);\n\t\t\t\t\t\taddmenuevent(el, \"touchcancel\", roles[1]);\n\t\t\t\t\t}\n\t\t\t\t\tsetevent = true;\n\t\t\t\t}\n\t\t\t\trole = ui.customAttr(el,\"popup\");\n\t\t\t\tif(!!role){\n\t\t\t\t\taddmenuevent(el, \"mousedown\", \"disppopup\");\n\t\t\t\t\tsetevent = true;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(!setevent){\n\t\t\t\t\tif(!menuarea.nohover || !el.querySelector(\"menu\")){\n\t\t\t\t\t\taddmenuevent(el, \"mousedown\", function(e){ e.preventDefault();});\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\taddmenuevent(el, \"mousedown\", function(e){ menuarea.showHovering(e,el); e.preventDefault(); e.stopPropagation();});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar link = ui.customAttr(el,\"pidlink\");\n\t\t\t\tif(!!link){\n\t\t\t\t\tel.firstChild.setAttribute(\"href\", link+ui.puzzle.pid);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(el.nodeType===1 && el.nodeName===\"MENU\"){\n\t\t\t\tvar label = el.getAttribute(\"label\");\n\t\t\t\tif(!!label && label.match(/^__(.+)__(.+)__$/)){\n\t\t\t\t\tmenuarea.captions.push({menu:el, str_jp:RegExp.$1, str_en:RegExp.$2});\n\t\t\t\t\tif(menuarea.nohover){\n\t\t\t\t\t\taddmenuevent(el, \"mousedown\", function(e){ e.stopPropagation();});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(el.nodeType===3){\n\t\t\t\tif(el.data.match(/^__(.+)__(.+)__$/)){\n\t\t\t\t\tmenuarea.captions.push({textnode:el, str_jp:RegExp.$1, str_en:RegExp.$2});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t//--------------------------------------------------------------------------------\n\t// menuarea.modifySelector()  MenuAreaに関するCSSセレクタテキストを変更する (Android向け)\n\t//--------------------------------------------------------------------------------\n\tmodifySelector : function(){\n\t\t/* Android 4.0, iOS5.1以上向け処理です */\n\t\tif(!pzpr.env.OS.mobile || !getEL(\"menupanel\").classList){ return;}\n\t\tvar sheet = _doc.styleSheets[0];\n\t\tvar rules = sheet.cssRules || sheet.rules;\n\t\tif(rules===null){} // Chromeでローカルファイルを開くとおかしくなるので、とりあえず何もしないようにします\n\t\t\n\t\tfor(var i=0,len=rules.length;i<len;i++){\n\t\t\tvar rule = rules[i];\n\t\t\tif(!rule.selectorText){ continue;}\n\t\t\tif(rule.selectorText.match(/\\#menupanel.+\\:hover.*/)){\n\t\t\t\tsheet.insertRule(rule.cssText.replace(\":hover\",\".hovering\"), i);\n\t\t\t\tsheet.deleteRule(i+1);\n\t\t\t}\n\t\t}\n\t\tthis.nohover = true;\n\t},\n\t\n\t//--------------------------------------------------------------------------------\n\t// menuarea.showHovering()  MenuAreaのポップアップを表示する (Android向け)\n\t// menuarea.stopHovering()  MenuAreaのポップアップを消去する (Android向け)\n\t//--------------------------------------------------------------------------------\n\tshowHovering : function(e,el0){\n\t\tif(!this.nohover){ return;}\n\t\tel0.classList.toggle(\"hovering\");\n\t\tui.misc.walker(getEL(\"menupanel\"), function(el){\n\t\t\tif(el.nodeType===1 && !!el.classList && !el.contains(el0)){ el.classList.remove(\"hovering\");}\n\t\t});\n\t},\n\tstopHovering : function(){\n\t\tif(!this.nohover){ return;}\n\t\tui.misc.walker(getEL(\"menupanel\"), function(el){\n\t\t\tif(el.nodeType===1 && !!el.classList){ el.classList.remove(\"hovering\");}\n\t\t});\n\t},\n\t\n\t//---------------------------------------------------------------------------\n\t// menuarea.display()    全てのメニューに対して文字列を設定する\n\t// menuarea.setdisplay() サブメニューに表示する文字列を個別に設定する\n\t//---------------------------------------------------------------------------\n\tdisplay : function(){\n\t\tgetEL('menupanel').style.display = \"\";\n\t\t\n\t\tgetEL(\"menu_imagesave\").className = (ui.enableSaveImage ? \"\" : \"disabled\");\n\t\tgetEL(\"menu_subclear\").style.display  = (!ui.puzzle.board.disable_subclear ? \"\" : \"none\");\n\t\t\n\t\tvar EDITOR = !ui.puzzle.playeronly;\n\t\tgetEL(\"menu_newboard\").style.display  = (EDITOR ? \"\" : \"none\");\n\t\tgetEL(\"menu_urloutput\").style.display = (EDITOR ? \"\" : \"none\");\n\t\tgetEL(\"menu_metadata\").style.display  = (EDITOR ? \"\" : \"none\");\n\t\tgetEL(\"menu_adjust\").style.display    = (EDITOR ? \"\" : \"none\");\n\t\tgetEL(\"menu_turnflip\").style.display  = (EDITOR ? \"\" : \"none\");\n\t\tgetEL(\"menu_sep_edit1\").style.display = (EDITOR ? \"\" : \"none\");\n\t\t\n\t\tfor(var idname in this.menuitem){ this.setdisplay(idname);}\n\t\tthis.setdisplay(\"operation\");\n\t\tthis.setdisplay(\"trialmode\");\n\t\tthis.setdisplay(\"toolarea\");\n\t\t\n\t\t/* キャプションの設定 */\n\t\tfor(var i=0;i<this.captions.length;i++){\n\t\t\tvar obj = this.captions[i];\n\t\t\tif(!!obj.textnode) { obj.textnode.data = ui.selectStr(obj.str_jp, obj.str_en);}\n\t\t\telse if(!!obj.menu){ obj.menu.setAttribute(\"label\", ui.selectStr(obj.str_jp, obj.str_en));}\n\t\t}\n\t},\n\tsetdisplay : function(idname){\n\t\tif(idname===\"operation\"){\n\t\t\tvar opemgr = ui.puzzle.opemgr;\n\t\t\tgetEL('menu_oldest').className = (opemgr.enableUndo ? \"\" : \"disabled\");\n\t\t\tgetEL('menu_undo').className   = (opemgr.enableUndo ? \"\" : \"disabled\");\n\t\t\tgetEL('menu_redo').className   = (opemgr.enableRedo ? \"\" : \"disabled\");\n\t\t\tgetEL('menu_latest').className = (opemgr.enableRedo ? \"\" : \"disabled\");\n\t\t}\n\t\telse if(idname==='trialmode'){\n\t\t\tvar trialstage = ui.puzzle.board.trialstage;\n\t\t\tgetEL('menu_trialenter').className         = ((trialstage===0) ? '' : 'disabled');\n\t\t\tgetEL('menu_trialenter').nextSibling.nextSibling.style.display = ((trialstage>0) ? '' : 'none'); // hr tag\n\t\t\tgetEL('menu_trialaccept').style.display    = ((trialstage>0) ? '' : 'none');\n\t\t\tgetEL('menu_trialreject').style.display    = ((trialstage===1)? '' : 'none');\n\t\t\tgetEL('menu_trialreject2').style.display   = ((trialstage>1) ? '' : 'none');\n\t\t\tgetEL('menu_trialrejectall').style.display = ((trialstage>1) ? '' : 'none');\n\t\t\tgetEL('menu_trialenter2').style.display    = ((trialstage>0) ? '' : 'none');\n\t\t}\n\t\telse if(idname===\"toolarea\"){\n\t\t\tvar str;\n\t\t\tif(!ui.menuconfig.get(\"toolarea\")){ str = ui.selectStr(\"ツールエリアを表示\",\"Show tool area\");}\n\t\t\telse                              { str = ui.selectStr(\"ツールエリアを隠す\",\"Hide tool area\");}\n\t\t\tgetEL('menu_toolarea').childNodes[0].data = str;\n\t\t}\n\t\telse if(this.menuitem===null || !this.menuitem[idname]){\n\t\t\t/* DO NOTHING */\n\t\t}\n\t\telse if(ui.menuconfig.valid(idname)){\n\t\t\tvar menuitem = this.menuitem[idname];\n\t\t\tmenuitem.el.style.display = \"\";\n\t\t\t\n\t\t\t/* セレクタ部の設定を行う */\n\t\t\tif(!!menuitem.children){\n\t\t\t\tvar children = menuitem.children;\n\t\t\t\tvar validval = (idname==='inputmode' ? ui.puzzle.mouse.getInputModeList() : null);\n\t\t\t\tfor(var i=0;i<children.length;i++){\n\t\t\t\t\tvar child = children[i], value = ui.customAttr(child,\"value\"), selected = (value===\"\"+ui.menuconfig.get(idname));\n\t\t\t\t\tchild.className = (selected ? \"checked\" : \"\");\n\t\t\t\t\tchild.style.display = ((validval===null || validval.indexOf(value)>=0) ? '' : 'none');\n\t\t\t\t}\n\t\t\t}\n\t\t\t/* Check部の表記の変更 */\n\t\t\telse if(!!menuitem.el){\n\t\t\t\tvar cname = (ui.menuconfig.get(idname) ? \"checked\" : \"check\");\n\t\t\t\tvar disabled = null;\n\t\t\t\tif(idname===\"passallcell\"){ disabled = !ui.puzzle.editmode;}\n\t\t\t\tif(disabled===true){ cname += \" disabled\";}\n\t\t\t\t\n\t\t\t\tmenuitem.el.className = cname;\n\t\t\t}\n\t\t}\n\t\telse if(!!this.menuitem[idname]){\n\t\t\tthis.menuitem[idname].el.style.display = \"none\";\n\t\t}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// menuarea.checkclick()   メニューから設定値の入力があった時、設定を変更する\n\t// menuarea.childclick()   メニューから設定値の入力があった時、設定を変更する\n\t//---------------------------------------------------------------------------\n\tcheckclick : function(e){\n\t\tvar el = e.target;\n\t\tif(el.nodeName===\"SPAN\"){ el = el.parentNode;}\n\t\tif(el.className.match(/disabled/)){ return;}\n\t\t\n\t\tvar idname = ui.customAttr(el,\"config\");\n\t\tui.menuconfig.set(idname, !ui.menuconfig.get(idname));\n\t},\n\tchildclick : function(e){\n\t\tvar el = e.target;\n\t\tif(el.nodeName===\"SPAN\"){ el = el.parentNode;}\n\t\t\n\t\tvar parent = el.parentNode.parentNode;\n\t\tui.menuconfig.set(ui.customAttr(parent,\"config\"), ui.customAttr(el,\"value\"));\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// メニューがクリックされた時の動作を呼び出す\n\t//---------------------------------------------------------------------------\n\t// submenuから呼び出される関数たち\n\tanscheck : function(){ this.answercheck();},\n\tundo     : function(){ ui.undotimer.startButtonUndo();},\n\tundostop : function(){ ui.undotimer.stopButtonUndo();},\n\tundoall  : function(){ ui.puzzle.undoall();},\n\tredo     : function(){ ui.undotimer.startButtonRedo();},\n\tredostop : function(){ ui.undotimer.stopButtonRedo();},\n\tredoall  : function(){ ui.puzzle.redoall();},\n\tansclear : function(){ this.ACconfirm();},\n\tsubclear : function(){ this.ASconfirm();},\n\tdropblocks  : function(){ ui.puzzle.board.operate('drop');},\n\traiseblocks : function(){ ui.puzzle.board.operate('raise');},\n\tresetblocks : function(){ ui.puzzle.board.operate('resetpos');},\n\tshowgatenum : function(){ ui.puzzle.board.operate('showgatenumber');},\n\thidegatenum : function(){ ui.puzzle.board.operate('hidegatenumber');},\n\tenterTrial         : function(){ if(ui.puzzle.board.trialstage===0){ ui.puzzle.enterTrial();}},\n\tenterFurtherTrial  : function(){ ui.puzzle.enterTrial();},\n\tacceptTrial        : function(){ ui.puzzle.acceptTrial();},\n\trejectTrial        : function(){ ui.puzzle.rejectTrial();},\n\trejectCurrentTrial : function(){ ui.puzzle.rejectCurrentTrial();},\n\tduplicate: function(){ this.duplicate_board();},\n\ttoolarea : function(){\n\t\tui.menuconfig.set(\"toolarea\", !ui.menuconfig.get(\"toolarea\"));\n\t\tui.displayAll();\n\t},\n\trepaint : function(){ ui.puzzle.redraw(true);},\n\tdisppopup : function(e){\n\t\tvar el = e.target;\n\t\tif(el.nodeName===\"SPAN\"){ el = el.parentNode;}\n\t\tif(el.className!==\"disabled\"){\n\t\t\tvar idname = ui.customAttr(el,\"popup\");\n\t\t\tif(idname==='database'){\n\t\t\t\tif(pzpr.util.currentTime() > parseInt(localStorage['pzprv3_storage:warning-time'] || 0) + 43200000){ // 12hours\n\t\t\t\t\tui.notify.alert(\"ブラウザのデータクリア等で意図せずデータが消えることありますので、長期保存に使用しないでください\",\n\t\t\t\t\t\t\t\t\t\"Don't use this for long-term use as these data will be cleared unexpectedly due to browser's cache clear etc.\");\n\t\t\t\t\tlocalStorage['pzprv3_storage:warning-time'] = pzpr.util.currentTime();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(!pzpr.env.OS.mobile){\n\t\t\t\tvar pos = pzpr.util.getPagePos(e);\n\t\t\t\tui.popupmgr.open(idname, pos.px-8, pos.py-8);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tvar rect = pzpr.util.getRect(getEL(\"menupanel\"));\n\t\t\t\tui.popupmgr.open(idname, 8, rect.bottom+8);\n\t\t\t}\n\t\t\tthis.stopHovering();\n\t\t}\n\t},\n\tdispdebug : function(){\n\t\tui.popupmgr.open(\"debug\", 0, 0);\n\t\tthis.stopHovering();\n\t},\n\n\t//------------------------------------------------------------------------------\n\t// menuarea.duplicate_board() 盤面の複製を行う => 受取はBoot.jsのimportFileData()\n\t//------------------------------------------------------------------------------\n\tduplicate_board : function(){\n\t\tif(getEL(\"menu_duplicate\").className===\"disabled\"){ return;}\n\t\tvar filestr = ui.puzzle.getFileData(pzpr.parser.FILE_PZPR, {history:true});\n\t\tvar url = './p?'+ui.puzzle.pid+(ui.puzzle.playeronly?\"_play\":\"\");\n\t\tif(!pzpr.env.browser.Presto){\n\t\t\tvar old = sessionStorage['filedata'];\n\t\t\tsessionStorage['filedata'] = filestr;\n\t\t\twindow.open(url,'');\n\t\t\tif(!!old){ sessionStorage['filedata'] = old;}\n\t\t\telse     { delete sessionStorage['filedata'];}\n\t\t}\n\t\telse{\n\t\t\tlocalStorage['pzprv3_filedata'] = filestr;\n\t\t\twindow.open(url,'');\n\t\t}\n\t\tthis.stopHovering();\n\t},\n\n\t//------------------------------------------------------------------------------\n\t// menuarea.answercheck()「正答判定」ボタンを押したときの処理\n\t// menuarea.ACconfirm()  「解答消去」ボタンを押したときの処理\n\t// menuarea.ASconfirm()  「補助消去」ボタンを押したときの処理\n\t//------------------------------------------------------------------------------\n\tanswercheck : function(){\n\t\tvar check = ui.puzzle.check(true);\n\t\tif(check.complete){\n\t\t\tui.timer.stop();\n\t\t\tif(ui.callbackComplete){\n\t\t\t\tui.callbackComplete(ui.puzzle, check);\n\t\t\t}\n\t\t}\n\t\tvar str = \"\", texts = check.text.split(/\\n/);\n\t\tfor(var i=0;i<texts.length;i++){ str += \"<div style=\\\"margin-bottom:6pt;\\\">\"+texts[i]+\"</div>\";}\n\t\tthis.stopHovering();\n\t\tui.notify.alert(str);\n\t},\n\tACconfirm : function(){\n\t\tthis.stopHovering();\n\t\tui.notify.confirm(\"解答を消去しますか？\",\"Do you want to erase the Answer?\", function(){ ui.puzzle.ansclear();});\n\t},\n\tASconfirm : function(){\n\t\tthis.stopHovering();\n\t\tui.notify.confirm(\"補助記号を消去しますか？\",\"Do you want to erase the auxiliary marks?\", function(){ ui.puzzle.subclear();});\n\t}\n};\n","// Menu.js v3.4.0\n/* global ui:false, _doc:false, getEL:false */\n\n//---------------------------------------------------------------------------\n// ★PopupManagerクラス ポップアップメニューを管理します\n//---------------------------------------------------------------------------\nui.popupmgr =\n{\n\tpopup     : null,\t/* 表示中のポップアップメニュー */\n\t\n\tpopups    : {},\t\t/* 管理しているポップアップメニューのオブジェクト一覧 */\n\t\n\tmovingpop : null,\t/* 移動中のポップアップメニュー */\n\toffset : {px:0, py:0},\t/* 移動中ポップアップメニューのページ左上からの位置 */\n\t\n\t//---------------------------------------------------------------------------\n\t// popupmgr.reset()      ポップアップメニューの設定をクリアする\n\t// popupmgr.setEvents()  ポップアップメニュー(タイトルバー)のイベントを設定する\n\t//---------------------------------------------------------------------------\n\treset : function(){\n\t\t/* イベントを割り当てる */\n\t\tthis.setEvents();\n\t\t\n\t\t/* Captionを設定する */\n\t\tthis.translate();\n\t},\n\t\n\tsetEvents : function(){\n\t\tui.event.addEvent(_doc, \"mousemove\", this, this.titlebarmove);\n\t\tui.event.addEvent(_doc, \"mouseup\",   this, this.titlebarup);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// popupmgr.translate()  言語切り替え時にキャプションを変更する\n\t//---------------------------------------------------------------------------\n\ttranslate : function(){\n\t\tfor(var name in this.popups){ this.popups[name].translate();}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// popupmgr.addpopup()   ポップアップメニューを追加する\n\t//---------------------------------------------------------------------------\n\taddpopup : function(idname, proto){\n\t\tvar NewPopup = {}, template = this.popups.template || {};\n\t\tfor(var name in template){ NewPopup[name] = template[name];}\n\t\tfor(var name in proto)   { NewPopup[name] = proto[name];}\n\t\tthis.popups[idname] = NewPopup;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// popupmgr.open()  ポップアップメニューを開く\n\t//---------------------------------------------------------------------------\n\topen : function(idname, px, py){\n\t\tvar target = this.popups[idname] || null;\n\t\tif(target!==null){\n\t\t\t/* 表示しているウィンドウがある場合は閉じる */\n\t\t\tif(!target.multipopup && !!this.popup){ this.popup.close();}\n\t\t\t\n\t\t\t/* ポップアップメニューを表示する */\n\t\t\ttarget.show(px, py);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// popupmgr.titlebardown()  タイトルバーをクリックしたときの動作を行う(タイトルバーにbind)\n\t// popupmgr.titlebarup()    タイトルバーでボタンを離したときの動作を行う(documentにbind)\n\t// popupmgr.titlebarmove()  タイトルバーからマウスを動かしたときポップアップメニューを動かす(documentにbind)\n\t//---------------------------------------------------------------------------\n\ttitlebardown : function(e){\n\t\tvar popel = e.target.parentNode;\n\t\tvar pos = pzpr.util.getPagePos(e);\n\t\tthis.movingpop = popel;\n\t\tthis.offset.px = pos.px - parseInt(popel.style.left,10);\n\t\tthis.offset.py = pos.py - parseInt(popel.style.top,10);\n\t\tui.event.enableMouse = false;\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t},\n\ttitlebarup : function(e){\n\t\tvar popel = this.movingpop;\n\t\tif(!!popel){\n\t\t\tthis.movingpop = null;\n\t\t\tui.event.enableMouse = true;\n\t\t}\n\t},\n\ttitlebarmove : function(e){\n\t\tvar popel = this.movingpop;\n\t\tif(!!popel){\n\t\t\tvar pos = pzpr.util.getPagePos(e);\n\t\t\tpopel.style.left = pos.px - this.offset.px + 'px';\n\t\t\tpopel.style.top  = pos.py - this.offset.py + 'px';\n\t\t\te.preventDefault();\n\t\t}\n\t}\n};\n\n//---------------------------------------------------------------------------\n// ★PopupMenuクラス ポップアップメニューを作成表示するベースのオブジェクトです\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('template',\n{\n\tformname : '',\n\tmultipopup : false,\n\tpid : '',\n\n\tinit : function(){ // 初回1回のみ呼び出される\n\t\tthis.form      = document[this.formname];\n\t\tthis.pop       = this.form.parentNode;\n\t\tthis.titlebar  = this.pop.querySelector('.titlebar') || null;\n\t\tif(!!this.titlebar){\n\t\t\tpzpr.util.unselectable(this.titlebar);\n\t\t\tpzpr.util.addEvent(this.titlebar, \"mousedown\", ui.popupmgr, ui.popupmgr.titlebardown);\n\t\t}\n\t\tpzpr.util.addEvent(this.form, \"submit\", this, function(e){ e.preventDefault();});\n\n\t\tthis.walkCaption(this.pop);\n\t\tthis.translate();\n\n\t\tthis.walkEvent(this.pop);\n\t},\n\treset : function(){ // パズルの種類が変わったら呼び出される\n\t},\n\n\ttranslate : function(){\n\t\tif(!this.captions){ return;}\n\t\tfor(var i=0;i<this.captions.length;i++){\n\t\t\tvar obj  = this.captions[i];\n\t\t\tvar text = ui.selectStr(obj.str_jp, obj.str_en);\n\t\t\tif   (!!obj.textnode){ obj.textnode.data = text;}\n\t\t\telse if(!!obj.button){ obj.button.value  = text;}\n\t\t}\n\t},\n\n\twalkCaption : function(parent){\n\t\tvar popup = this;\n\t\tthis.captions  = [];\n\t\tui.misc.walker(parent, function(el){\n\t\t\tif(el.nodeType===3 && el.data.match(/^__(.+)__(.+)__$/)){\n\t\t\t\tpopup.captions.push({textnode:el, str_jp:RegExp.$1, str_en:RegExp.$2});\n\t\t\t}\n\t\t});\n\t},\n\twalkEvent : function(parent){\n\t\tvar popup = this;\n\t\tfunction eventfactory(role){\n\t\t\treturn function(e){ popup[role](e); if(e.type!=='click'){ e.preventDefault(); e.stopPropagation();}};\n\t\t}\n\t\tui.misc.walker(parent, function(el){\n\t\t\tif(el.nodeType!==1){ return;}\n\t\t\tvar role = ui.customAttr(el,\"buttonExec\");\n\t\t\tif(!!role){\n\t\t\t\tpzpr.util.addEvent(el, (!pzpr.env.API.touchevent ? \"click\" : \"mousedown\"), popup, eventfactory(role));\n\t\t\t}\n\t\t\trole = ui.customAttr(el,\"changeExec\");\n\t\t\tif(!!role){\n\t\t\t\tpzpr.util.addEvent(el, \"change\", popup, eventfactory(role));\n\t\t\t}\n\t\t});\n\t},\n\n\tshow : function(px,py){ // 表示するたびに呼び出される\n\t\tif(!this.pop){ this.init();}\n\t\tif(this.pid!==ui.puzzle.pid){\n\t\t\tthis.pid = ui.puzzle.pid;\n\t\t\tthis.reset();\n\t\t}\n\t\t\n\t\tthis.pop.style.left = px + 'px';\n\t\tthis.pop.style.top  = py + 'px';\n\t\tthis.pop.style.display = 'inline';\n\t\tif(!this.multipopup){\n\t\t\tui.popupmgr.popup = this;\n\t\t}\n\t},\n\tclose : function(){\n\t\tthis.pop.style.display = \"none\";\n\t\tif(!this.multipopup){\n\t\t\tui.popupmgr.popup = null;\n\t\t}\n\t\t\n\t\tui.puzzle.key.enableKey = true;\n\t\tui.puzzle.mouse.enableMouse = true;\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_NewBoardクラス 新規盤面作成のポップアップメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('newboard',\n{\n\tformname : 'newboard',\n\t\n\treset : function(){\n\t\tui.misc.displayByPid(this.pop);\n\t\tif(this.pid!=='tawa'){ return;}\n\t\tfor(var i=0;i<=3;i++){\n\t\t\tvar _div = getEL(\"nb_shape_\"+i), _img = _div.children[0];\n\t\t\t_img.src = \"data:image/gif;base64,R0lGODdhgAAgAKEBAAAAAP//AP//////ACwAAAAAgAAgAAAC/pSPqcvtD6OctNqLs968+98A4kiWJvmcquisrtm+MpAAwY0Hdn7vPN1aAGstXs+oQw6FyqZxKfDlpDhqLyXMhpw/ZfHJndbCVW9QATWkEdYk+Pntvn/j+dQc0hK39jKcLxcoxkZ29JeHpsfUZ0gHeMeoUyfo54i4h7lI2TjI0PaJp1boZumpeLCGOvoZB7kpyTbzIiTrglY7o4Yrc8l2irYamjiciar2G4VM7Lus6fpcdVZ8PLxmrTyd3AwcydprvK19HZ6aPf5YCX31TW3ezuwOcQ7vGXyIPA+e/w6ORZ5ir9S/gfu0ZRt4UFU3YfHiFSyoaxeMWxJLUKx4IiLGZIn96HX8iNBjQ5EG8Zkk+dDfyJAgS7Lkxy9lOJTYXMK0ibOlTJ0n2eEs97OnUJ40X668SfRo0ZU7SS51erOp0XxSkSaFGtTo1a0bUcSo9bVr2I0gypo9izat2rVs27p9Czfu2QIAOw==\";\n\t\t\t_img.style.clip = \"rect(0px,\"+((i+1)*32)+\"px,\"+32+\"px,\"+(i*32)+\"px)\";\n\t\t}\n\t},\n\tshow : function(px,py){\n\t\tui.popupmgr.popups.template.show.call(this,px,py);\n\t\tui.puzzle.key.enableKey = false;\n\t\t\n\t\tswitch(ui.puzzle.pid){\n\t\t\tcase 'sudoku': this.setsize_sudoku(); break;\n\t\t\tcase 'tawa':   this.setsize_tawa();   break;\n\t\t\tdefault:       this.setsize();        break;\n\t\t}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// setsize()   盤面のサイズをセットする\n\t// getsize()   盤面のサイズを取得する\n\t//---------------------------------------------------------------------------\n\tsetsize : function(){\n\t\tvar bd = ui.puzzle.board;\n\t\tthis.form.col.value=''+bd.cols;\n\t\tthis.form.row.value=''+bd.rows;\n\t},\n\tgetsize : function(){\n\t\tvar col = this.form.col.value|0;\n\t\tvar row = this.form.row.value|0;\n\t\treturn ((!!col && !!row) ? {col:col, row:row} : null);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// setsize_sudoku()   盤面のサイズをセットする (数独向け)\n\t// getsize_sudoku()   盤面のサイズを取得する (数独向け)\n\t//---------------------------------------------------------------------------\n\tsetsize_sudoku : function(){\n\t\tfor(var i=0;i<4;i++){ getEL(\"nb_size_sudoku_\"+i).checked = '';}\n\t\tswitch(ui.puzzle.board.cols){\n\t\t\tcase 16: getEL(\"nb_size_sudoku_2\").checked = true; break;\n\t\t\tcase 25: getEL(\"nb_size_sudoku_3\").checked = true; break;\n\t\t\tcase  4: getEL(\"nb_size_sudoku_0\").checked = true; break;\n\t\t\tcase  6: getEL(\"nb_size_sudoku_4\").checked = true; break;\n\t\t\tdefault: getEL(\"nb_size_sudoku_1\").checked = true; break;\n\t\t}\n\t},\n\tgetsize_sudoku : function(){\n\t\tvar col, row;\n\t\tif     (getEL(\"nb_size_sudoku_2\").checked){ col=row=16;}\n\t\telse if(getEL(\"nb_size_sudoku_3\").checked){ col=row=25;}\n\t\telse if(getEL(\"nb_size_sudoku_0\").checked){ col=row= 4;}\n\t\telse if(getEL(\"nb_size_sudoku_4\").checked){ col=row= 6;}\n\t\telse                                      { col=row= 9;}\n\t\treturn {col:col, row:row};\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// setsize_tawa()   盤面のサイズをセットする (たわむれんが向け)\n\t// getsize_tawa()   盤面のサイズを取得する (たわむれんが向け)\n\t//---------------------------------------------------------------------------\n\tsetsize_tawa : function(){\n\t\t/* タテヨコのサイズ指定部分 */\n\t\tvar bd = ui.puzzle.board, col = bd.cols, row = bd.rows, shape = bd.shape;\n\t\t\n\t\tif(shape===3){ col++;}\n\t\tthis.form.col.value=''+col;\n\t\tthis.form.row.value=''+row;\n\t\t\n\t\t/* たわむレンガの形状指定ルーチン */\n\t\tthis.setshape(shape);\n\t},\n\tgetsize_tawa : function(){\n\t\tvar col = this.form.col.value|0;\n\t\tvar row = this.form.row.value|0;\n\t\tif(!col || !row){ return null;}\n\t\t\n\t\tvar shape = this.getshape();\n\t\tif(!isNaN(shape) && !(col===1 && (shape===0||shape===3))){\n\t\t\tif(shape===3){ col--;}\n\t\t}\n\t\telse{ return null;}\n\t\t\n\t\treturn {col:col, row:row, shape:shape};\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// setshape()   たわむれんの形状から形状指定ボタンの初期値をセットする\n\t// getshape()   たわむれんがのどの形状が指定されか取得する\n\t// clickshape() たわむれんがの形状指定ボタンを押した時の処理を行う\n\t// setshapeidx() たわむれんがの形状指定ボタンに背景色を設定する\n\t// getshapeidx() たわむれんがの形状指定ボタン背景色からインデックスを取得する\n\t//---------------------------------------------------------------------------\n\tsetshape : function(shape){\n\t\tthis.setshapeidx([0,2,3,1][shape]);\n\t},\n\tgetshape : function(){\n\t\tvar idx = this.getshapeidx();\n\t\treturn (idx!==null ? [0,3,1,2][idx] : null);\n\t},\n\tclickshape : function(e){\n\t\tthis.setshapeidx(+e.target.parentNode.id.charAt(9));\n\t},\n\n\tsetshapeidx : function(idx){\n\t\tfor(var i=0;i<=3;i++){\n\t\t\tgetEL(\"nb_shape_\"+i).style.backgroundColor = (i===idx?'red':'');\n\t\t}\n\t},\n\tgetshapeidx : function(){\n\t\tfor(var i=0;i<=3;i++){\n\t\t\tif(getEL(\"nb_shape_\"+i).style.backgroundColor==='red'){ return i;}\n\t\t}\n\t\treturn null;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// execute() 新規盤面を作成するボタンを押したときの処理を行う\n\t//---------------------------------------------------------------------------\n\texecute : function(){\n\t\tvar pid = ui.puzzle.pid;\n\t\tvar obj;\n\t\tswitch(pid){\n\t\t\tcase 'sudoku': obj = this.getsize_sudoku(); break;\n\t\t\tcase 'tawa':   obj = this.getsize_tawa();   break;\n\t\t\tdefault:       obj = this.getsize();        break;\n\t\t}\n\t\t\n\t\tthis.close();\n\t\tif(!!obj){\n\t\t\tvar url = pid+'/'+obj.col+'/'+obj.row;\n\t\t\tif(pid==='tawa'){ url += ('/'+obj.shape);}\n\t\t\tui.puzzle.open(url);\n\t\t}\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_URLInputクラス URL入力のポップアップメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('urlinput',\n{\n\tformname : 'urlinput',\n\t\n\t//------------------------------------------------------------------------------\n\t// urlinput() URLを入力する\n\t//------------------------------------------------------------------------------\n\turlinput : function(){\n\t\tthis.close();\n\t\tui.puzzle.open(this.form.ta.value.replace(/\\n/g,\"\"));\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_URLOutputクラス URL出力のポップアップメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('urloutput',\n{\n\tformname : 'urloutput',\n\t\n\treset : function(px,py){\n\t\tvar form = this.form, pid = ui.puzzle.pid, exists = pzpr.variety(pid).exists;\n\t\tform.ta.value = '';\n\t\t// form.pzprapp.style.display = form.pzprapp.nextSibling.style.display = (exists.pzprapp ? \"\" : \"none\");\n\t\tform.kanpen.style.display  = form.kanpen.nextSibling.style.display  = (exists.kanpen ? \"\" : \"none\");\n\t\tform.heyaapp.style.display = form.heyaapp.nextSibling.style.display = ((pid===\"heyawake\") ? \"\" : \"none\");\n\t},\n\t\n\tshow : function(px,py){\n\t\tui.popupmgr.popups.template.show.call(this,px,py);\n\t\tthis.reset(px,py);\n\t},\n\n\t//------------------------------------------------------------------------------\n\t// urloutput() URLを出力する\n\t// openurl()   「このURLを開く」を実行する\n\t//------------------------------------------------------------------------------\n\turloutput : function(e){\n\t\tvar url = '', parser = pzpr.parser;\n\t\tswitch(e.target.name){\n\t\t\tcase \"pzprv3\":     url = ui.puzzle.getURL(parser.URL_PZPRV3);  break;\n\t\t\t// case \"pzprapp\": url = ui.puzzle.getURL(parser.URL_PZPRAPP); break;\n\t\t\tcase \"kanpen\":     url = ui.puzzle.getURL(parser.URL_KANPEN);  break;\n\t\t\tcase \"pzprv3e\":    url = ui.puzzle.getURL(parser.URL_PZPRV3).replace(/\\?(\\w+)/,\"?$1_edit\"); break;\n\t\t\tcase \"heyaapp\":    url = ui.puzzle.getURL(parser.URL_HEYAAPP); break;\n\t\t}\n\t\tthis.form.ta.value = url;\n\t},\n\topenurl : function(e){\n\t\tif(this.form.ta.value!==''){\n\t\t\twindow.open(this.form.ta.value, '', '');\n\t\t}\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_FileOpenクラス ファイル入力のポップアップメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('fileopen',\n{\n\tformname : 'fileform',\n\t\n\tinit : function(){\n\t\tui.popupmgr.popups.template.init.call(this);\n\t},\n\t\n\t//------------------------------------------------------------------------------\n\t// fileopen()  ファイルを開く\n\t//------------------------------------------------------------------------------\n\tfileopen : function(e){\n\t\tvar fileEL = this.form.filebox;\n\t\tif(!!ui.reader || ui.enableGetText){\n\t\t\tvar fitem = fileEL.files[0];\n\t\t\tif(!fitem){ return;}\n\t\t\t\n\t\t\tif(!!ui.reader){ ui.reader.readAsText(fitem);}\n\t\t\telse           { ui.puzzle.open(fitem.getAsText(''));}\n\t\t}\n\t\tthis.form.reset();\n\t\tthis.close();\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_FileSaveクラス ファイル出力のポップアップメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('filesave',\n{\n\tformname : 'filesave',\n\tanchor : null,\n\tinit : function(){\n\t\tui.popupmgr.popups.template.init.call(this);\n\t\t\n\t\tthis.anchor = ((!ui.enableSaveBlob && pzpr.env.API.anchor_download) ? getEL(\"saveanchor\") : null);\n\t},\n\treset : function(){\n\t\t/* ファイル形式選択オプション */\n\t\tvar ispencilbox = pzpr.variety(ui.puzzle.pid).exists.pencilbox;\n\t\tthis.form.filetype.options[1].disabled = !ispencilbox;\n\t\tthis.form.filetype.options[2].disabled = !ispencilbox;\n\t},\n\t/* オーバーライド */\n\tshow : function(px,py){\n\t\tui.popupmgr.popups.template.show.call(this,px,py);\n\t\t\n\t\tthis.form.filename.value = ui.puzzle.pid + '.txt';\n\t\tthis.changefilename();\n\t\t\n\t\tui.puzzle.key.enableKey = false;\n\t},\n\tclose : function(){\n\t\tif(!!this.filesaveurl){ URL.revokeObjectURL(this.filesaveurl);}\n\t\t\n\t\tui.popupmgr.popups.template.close.call(this);\n\t},\n\tchangefilename : function(){\n\t\tvar filetype = this.form.filetype.value;\n\t\tvar filename = this.form.filename.value.replace('.xml','').replace('.txt','');\n\t\tvar ext = (filetype!=='filesave4'?'.txt':'.xml');\n\t\tvar pinfo = pzpr.variety(filename);\n\t\tif(pinfo.pid===ui.puzzle.pid){\n\t\t\tif(filetype==='filesave'||filetype==='filesave3'){\n\t\t\t\tfilename = pinfo.urlid;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfilename = pinfo.kanpenid;\n\t\t\t}\n\t\t}\n\t\tthis.form.filename.value = filename + ext;\n\t},\n\t\n\t//------------------------------------------------------------------------------\n\t// filesave()  ファイルを保存する\n\t//------------------------------------------------------------------------------\n\tfilesaveurl : null,\n\tfilesave : function(){\n\t\tvar form = this.form;\n\t\tvar filename = form.filename.value;\n\t\tvar prohibit = ['\\\\', '/', ':', '*', '?', '\"', '<', '>', '|'];\n\t\tfor(var i=0;i<prohibit.length;i++){\n\t\t\tif(filename.indexOf(prohibit[i])!==-1){ ui.notify.alert('ファイル名として使用できない文字が含まれています。'); return;}\n\t\t}\n\n\t\tvar parser = pzpr.parser, filetype = parser.FILE_PZPR, option = {};\n\t\tswitch(form.filetype.value){\n\t\t\tcase 'filesave2': filetype = parser.FILE_PBOX; break;\n\t\t\tcase 'filesave4': filetype = parser.FILE_PBOX_XML; break;\n\t\t\tcase 'filesave3': filetype = parser.FILE_PZPR; option.history = true; break;\n\t\t}\n\n\t\tvar blob = null, filedata = null;\n\t\tif(ui.enableSaveBlob || !!this.anchor){\n\t\t\tblob = new Blob([ui.puzzle.getFileData(filetype, option)], {type:'text/plain'});\n\t\t}\n\t\telse{\n\t\t\tfiledata = ui.puzzle.getFileData(filetype, option);\n\t\t}\n\n\t\tif(ui.enableSaveBlob){\n\t\t\tnavigator.saveBlob(blob, filename);\n\t\t\tthis.close();\n\t\t}\n\t\telse if(!!this.anchor){\n\t\t\tif(!!this.filesaveurl){ URL.revokeObjectURL(this.filesaveurl);}\n\t\t\tthis.filesaveurl = URL.createObjectURL(blob);\n\t\t\tthis.anchor.href = this.filesaveurl;\n\t\t\tthis.anchor.download = filename;\n\t\t\tthis.anchor.click();\n\t\t}\n\t\telse{\n\t\t\tform.ques.value = filedata;\n\t\t\tform.operation.value = (form.filetype.value!=='filesave4' ? 'save' : 'savexml');\n\t\t\tform.submit();\n\t\t\tthis.close();\n\t\t}\n\n\t\tui.puzzle.saved();\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_ImageSaveクラス 画像出力のポップアップメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('imagesave',\n{\n\tformname : 'imagesave',\n\tanchor : null,\n\tshowsize : null,\n\tinit : function(){\n\t\tui.popupmgr.popups.template.init.call(this);\n\t\t\n\t\tthis.anchor = ((!ui.enableSaveBlob && pzpr.env.API.anchor_download) ? getEL(\"saveanchor\") : null);\n\t\tthis.showsize = getEL(\"showsize\");\n\t\t\n\t\t/* ファイル形式選択オプション */\n\t\tvar filetype = this.form.filetype, options = filetype.options;\n\t\tfor(var i=0;i<options.length;i++){\n\t\t\tvar option = options[i];\n\t\t\tif(!ui.enableImageType[option.value]){ filetype.removeChild(option); i--;}\n\t\t}\n\t},\n\t\n\t/* オーバーライド */\n\tshow : function(px,py){\n\t\tui.popupmgr.popups.template.show.call(this,px,py);\n\t\t\n\t\tui.puzzle.key.enableKey = false;\n\t\tui.puzzle.mouse.enableMouse = false;\n\t\t\n\t\tthis.form.filename.value = pzpr.variety(ui.puzzle.pid).urlid+\".png\";\n\t\tthis.form.cellsize.value = ui.menuconfig.get('cellsizeval');\n\t\t\n\t\tthis.changefilename();\n\t\tthis.estimatesize();\n\t},\n\tclose : function(){\n\t\tif(!!this.saveimageurl){ URL.revokeObjectURL(this.saveimageurl);}\n\t\t\n\t\tui.puzzle.setCanvasSize();\n\t\tui.popupmgr.popups.template.close.call(this);\n\t},\n\t\n\tchangefilename : function(){\n\t\tvar filename = this.form.filename.value.replace(/\\.\\w{3,4}$/,'.');\n\t\tthis.form.filename.value = filename + this.form.filetype.value;\n\t},\n\testimatesize : function(){\n\t\tvar cellsize = +this.form.cellsize.value;\n\t\tvar width  = (+cellsize * ui.puzzle.painter.getCanvasCols())|0;\n\t\tvar height = (+cellsize * ui.puzzle.painter.getCanvasRows())|0;\n\t\tthis.showsize.replaceChild(_doc.createTextNode(width+\" x \"+height), this.showsize.firstChild);\n\t},\n\t\n\t//------------------------------------------------------------------------------\n\t// saveimage()    画像をダウンロードする\n\t// submitimage() \"画像をダウンロード\"の処理ルーチン\n\t// saveimage()   \"画像をダウンロード\"の処理ルーチン (IE10用)\n \t//------------------------------------------------------------------------------\n\tsaveimageurl : null,\n\tsaveimage : function(){\n\t\t/* ファイル名チェックルーチン */\n\t\tvar form = this.form;\n\t\tvar filename = form.filename.value;\n\t\tvar prohibit = ['\\\\', '/', ':', '*', '?', '\"', '<', '>', '|'];\n\t\tfor(var i=0;i<prohibit.length;i++){\n\t\t\tif(filename.indexOf(prohibit[i])!==-1){ ui.notify.alert('ファイル名として使用できない文字が含まれています。'); return;}\n\t\t}\n\n\t\t/* 画像出力ルーチン */\n\t\tvar option = {cellsize:+this.form.cellsize.value};\n\t\tif(this.form.transparent.checked){ option.bgcolor = '';}\n\t\tvar type = form.filetype.value;\n\n\t\ttry{\n\t\t\tif(ui.enableSaveBlob || !!this.anchor){\n\t\t\t\tui.puzzle.toBlob(function(blob){\n\t\t\t\t\t/* 出力された画像の保存ルーチン */\n\t\t\t\t\tif(ui.enableSaveBlob){\n\t\t\t\t\t\tnavigator.saveBlob(blob, filename);\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tif(!!this.filesaveurl){ URL.revokeObjectURL(this.filesaveurl);}\n\t\t\t\t\t\tthis.filesaveurl = URL.createObjectURL(blob);\n\t\t\t\t\t\tthis.anchor.href = this.filesaveurl;\n\t\t\t\t\t\tthis.anchor.download = filename;\n\t\t\t\t\t\tthis.anchor.click();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), type, 1.0, option);\n\t\t\t}\n\t\t\telse{\n\t\t\t\t/* 出力された画像の保存ルーチン */\n\t\t\t\tform.urlstr.value = ui.puzzle.toDataURL(type, 1.0, option).replace(/data:.*;base64,/, '');\n\t\t\t\tform.submit();\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t}\n\t\tcatch(e){\n\t\t\tui.notify.alert('画像の出力に失敗しました','Fail to Output the Image');\n\t\t}\n\t},\n\t\n \t//------------------------------------------------------------------------------\n\t// openimage()   \"別ウィンドウで開く\"の処理ルーチン\n\t//------------------------------------------------------------------------------\n\topenimage : function(){\n\t\t/* 画像出力ルーチン */\n\t\tvar option = {cellsize:+this.form.cellsize.value};\n\t\tif(this.form.transparent.checked){ option.bgcolor = '';}\n\t\tvar type = this.form.filetype.value;\n\t\tvar IEkei = navigator.userAgent.match(/(Trident|Edge)\\//);\n\t\t\n\t\tvar dataurl = \"\";\n\t\ttry{\n\t\t\tif(!IEkei || type!=='svg'){\n\t\t\t\tdataurl = ui.puzzle.toDataURL(type, 1.0, option);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tdataurl = ui.puzzle.toBuffer('svg', option);\n\t\t\t}\n\t\t}\n\t\tcatch(e){\n\t\t\tui.notify.alert('画像の出力に失敗しました','Fail to Output the Image');\n\t\t}\n\t\tif(!dataurl){ /* No Data URL */ return;}\n\t\t\n\t\t/* 出力された画像を開くルーチン */\n\t\tfunction writeContent(blob){\n\t\t\tvar filename = this.form.filename.value;\n\t\t\tvar cdoc = window.open('', '', '').document;\n\t\t\tcdoc.open();\n\t\t\tcdoc.writeln(\"<!DOCTYPE html>\\n<HTML LANG=\\\"ja\\\">\\n<HEAD>\");\n\t\t\tcdoc.writeln(\"<META CHARSET=\\\"utf-8\\\">\");\n\t\t\tcdoc.writeln(\"<TITLE>ぱずぷれv3<\\/TITLE>\\n<\\/HEAD><BODY>\");\n\t\t\tif(!!blob){\n\t\t\t\tcdoc.writeln(\"<img src=\\\"\", dataurl, \"\\\"><br>\\n\");\n\t\t\t\tcdoc.writeln(\"<a href=\\\"\", cdoc.defaultView.URL.createObjectURL(blob), \"\\\" download=\\\"\", filename, \"\\\">Download \", filename, \"</a>\");\n\t\t\t}\n\t\t\telse if(!IEkei || type!=='svg'){\n\t\t\t\tcdoc.writeln(\"<img src=\\\"\", dataurl, \"\\\">\");\n\t\t\t}\n\t\t\telse{\n\t\t\t\tcdoc.writeln(dataurl.replace(/^<\\?.+?\\?>/,''));\n\t\t\t}\n\t\t\tcdoc.writeln(\"<\\/BODY>\\n<\\/HTML>\");\n\t\t\tcdoc.close();\n\t\t}\n\t\tif(pzpr.env.API.anchor_download){\n\t\t\t// ChromeでDataURLが直接開けない対策\n\t\t\tui.puzzle.toBlob(writeContent.bind(this), type, 1.0, option);\n\t\t}\n\t\telse{\n\t\t\twriteContent(null);\n\t\t}\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_Adjustクラス 盤面の調整のポップアップメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('adjust',\n{\n\tformname : 'adjust',\n\t\n\tadjust : function(e){\n\t\tui.puzzle.board.operate(e.target.name);\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_TurnFlipクラス 回転・反転のポップアップメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('turnflip',\n{\n\tformname : 'turnflip',\n\t\n\treset : function(){\n\t\tthis.form.turnl.disabled = (ui.puzzle.pid==='tawa');\n\t\tthis.form.turnr.disabled = (ui.puzzle.pid==='tawa');\n\t},\n\t\n\tadjust : function(e){\n\t\tui.puzzle.board.operate(e.target.name);\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_Metadataクラス メタデータの設定・表示を行うメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('metadata',\n{\n\tformname : 'metadata',\n\t\n\tshow : function(px,py){\n\t\tui.popupmgr.popups.template.show.call(this,px,py);\n\t\t\n\t\tvar form = this.form;\n\t\tvar puzzle = ui.puzzle, bd = puzzle.board, meta = puzzle.metadata;\n\t\tgetEL(\"metadata_variety\").innerHTML = pzpr.variety(puzzle.pid)[pzpr.lang] + \"&nbsp;\" + bd.cols+\"×\"+bd.rows;\n\t\tform.author.value  = meta.author;\n\t\tform.source.value  = meta.source;\n\t\tform.hard.value    = meta.hard;\n\t\tform.comment.value = meta.comment;\n\t},\n\n\tsave : function(){\n\t\tvar form = this.form;\n\t\tvar puzzle = ui.puzzle, meta = puzzle.metadata;\n\t\tmeta.author  = form.author.value;\n\t\tmeta.source  = form.source.value;\n\t\tmeta.hard    = form.hard.value;\n\t\tmeta.comment = form.comment.value;\n\t\tthis.close();\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_Colorsクラス 色の選択を行うメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('colors',\n{\n\tformname : 'colors',\n\tcolorElement : true,\n\t\n\tinit : function(){\n\t\tui.popupmgr.popups.template.init.call(this);\n\t\t\n\t\tui.misc.walker(this.form, function(el){\n\t\t\tvar target = ui.customAttr(el.parentNode,\"colorTarget\") || '';\n\t\t\tif(el.nodeName===\"INPUT\" && el.getAttribute(\"type\")===\"color\"){\n\t\t\t\tif(el.type!==\"color\"){ this.colorElement = false;}\n\t\t\t\tel.addEventListener('change', function(e){ this.setcolor(e, target);}.bind(this), false);\n\t\t\t}\n\t\t\tif(el.nodeName===\"BUTTON\"){\n\t\t\t\tel.addEventListener('mousedown', function(e){ this.clearcolor(e, target);}.bind(this), false);\n\t\t\t}\n\t\t}.bind(this));\n\t},\n\tshow : function(px,py){\n\t\tui.popupmgr.popups.template.show.call(this,px,py);\n\t\tthis.refresh();\n\t},\n\n\t//------------------------------------------------------------------------------\n\t// refresh()    フォームに表示される色を再設定する\n\t//------------------------------------------------------------------------------\n\trefresh : function(name){\n\t\tui.misc.walker(this.form, function(el){\n\t\t\tif(el.nodeName===\"INPUT\" && el.getAttribute(\"type\")===\"color\"){\n\t\t\t\tvar target = ui.customAttr(el.parentNode,\"colorTarget\") || '';\n\t\t\t\tif(!!target && (!name || name===target)){\n\t\t\t\t\tel.value = this.getdefaultcolor(target);\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\t},\n\tgetdefaultcolor : function(name){\n\t\tvar color = '';\n\t\tif(name!=='bgcolor'){\n\t\t\tcolor = pzpr.Candle.parse(ui.puzzle.painter[name]);\n\t\t}\n\t\telse{\n\t\t\tcolor = ui.menuconfig.get(\"color_\"+name);\n\t\t}\n\t\tif(this.colorElement){\n\t\t\tswitch(color){\n\t\t\t\tcase 'black': color = '#000000'; break;\n\t\t\t\tcase 'white': color = '#ffffff'; break;\n\t\t\t}\n\t\t}\n\t\treturn color;\n\t},\n\tgetnamedcolor : function(rgbcolor){\n\t\tvar color = rgbcolor;\n\t\tif(this.colorElement){\n\t\t\tswitch(rgbcolor.toLowerCase()){\n\t\t\t\tcase '#000000': color = 'black'; break;\n\t\t\t\tcase '#ffffff': color = 'white'; break;\n\t\t\t}\n\t\t}\n\t\treturn color;\n\t},\n\t\n\t//------------------------------------------------------------------------------\n\t// setcolor()   色を設定する\n\t// clearcolor() 色の設定をクリアする\n\t//------------------------------------------------------------------------------\n\tsetcolor : function(e, name){\n\t\tui.menuconfig.set(\"color_\"+name, this.getnamedcolor(e.target.value));\n\t},\n\tclearcolor : function(e, name){\n\t\tui.menuconfig.reset(\"color_\"+name);\n\t\tthis.refresh(name);\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_DispSizeクラス サイズの変更を行うポップアップメニューを作成したり表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('dispsize',\n{\n\tformname : 'dispsize',\n\t\n\tshow : function(px,py){\n\t\tui.popupmgr.popups.template.show.call(this,px,py);\n\t\t\n\t\tthis.form.cellsize.value = ui.menuconfig.get('cellsizeval');\n\t\tui.puzzle.key.enableKey = false;\n\t},\n\t\n\t//------------------------------------------------------------------------------\n\t// changesize()  Canvasでのマス目の表示サイズを変更する\n\t//------------------------------------------------------------------------------\n\tchangesize : function(e){\n\t\tvar csize = this.form.cellsize.value|0;\n\t\tif(csize>0){ ui.menuconfig.set('cellsizeval', csize);}\n\t\tthis.close();\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Popup_Creditクラス Creditやバージョン情報を表示します\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('credit',\n{\n\tformname : 'credit',\n\n\tinit : function(){\n\t\tui.popupmgr.popups.template.init.call(this);\n\t\t\n\t\tgetEL('pzprversion').innerHTML = pzpr.version;\n\t\tgetEL(\"menualltest\").style.display = (!ui.debugmode ? \"none\" : \"\");\n\t},\n\tdebugalltest : function(){\n\t\tui.debug.all_test();\n\t\tthis.close();\n\t}\n});\n","// ToolArea.js v3.4.0\n/* global ui:false, getEL:false */\n\n// メニュー描画/取得/html表示系\n// toolareaオブジェクト\nui.toolarea = {\n\titems : null,\t\t// ツールパネルのエレメント等を保持する\n\tcaptions : [],\t\t// 言語指定を切り替えた際のキャプションを保持する\n\n\t//---------------------------------------------------------------------------\n\t// toolarea.reset()  ツールパネル・ボタン領域の初期設定を行う\n\t//---------------------------------------------------------------------------\n\treset : function(){\n\t\tif(this.items===null){\n\t\t\tthis.items = {};\n\t\t\tthis.walkElement(getEL(\"usepanel\"));\n\t\t\tthis.walkElement(getEL(\"checkpanel\"));\n\t\t\tthis.walkElement(getEL('btnarea'));\n\t\t}\n\t\tui.misc.displayByPid(getEL(\"checkpanel\"));\n\t\tui.misc.displayByPid(getEL(\"btnarea\"));\n\t\t\n\t\tthis.display();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// toolarea.walkElement()  エレメントを探索して領域の初期設定を行う\n\t//---------------------------------------------------------------------------\n\twalkElement : function(parent){\n\t\tvar toolarea = this;\n\t\tfunction btnfactory(role){\n\t\t\treturn function(e){ toolarea[role](e); if(e.type!=='click'){ e.preventDefault(); e.stopPropagation();}};\n\t\t}\n\t\tfunction addbtnevent(el,type,role){ pzpr.util.addEvent(el, type, toolarea, btnfactory(role));}\n\t\tui.misc.walker(parent, function(el){\n\t\t\tif(el.nodeType===1){\n\t\t\t\t/* ツールパネル領域 */\n\t\t\t\tif(el.className===\"config\"){\n\t\t\t\t\ttoolarea.items[ui.customAttr(el,\"config\")] = {el:el};\n\t\t\t\t}\n\t\t\t\telse if(el.className.match(/child/)){\n\t\t\t\t\tvar parent = el.parentNode.parentNode, idname = ui.customAttr(parent,\"config\");\n\t\t\t\t\tvar item = toolarea.items[idname];\n\t\t\t\t\tif(!item.children){ item.children=[];}\n\t\t\t\t\titem.children.push(el);\n\t\t\t\t\t\n\t\t\t\t\taddbtnevent(el, \"mousedown\", \"toolclick\");\n\t\t\t\t}\n\t\t\t\telse if(el.nodeName===\"INPUT\" && el.type===\"checkbox\"){\n\t\t\t\t\tvar parent = el.parentNode, idname = ui.customAttr(parent,\"config\");\n\t\t\t\t\tif(!idname){ return;}\n\t\t\t\t\ttoolarea.items[idname].checkbox=el;\n\t\t\t\t\t\n\t\t\t\t\taddbtnevent(el, \"click\", \"toolclick\");\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* ボタン領域 */\n\t\t\t\tvar role = ui.customAttr(el,\"buttonExec\");\n\t\t\t\tif(!!role){\n\t\t\t\t\taddbtnevent(el, (!pzpr.env.API.touchevent ? \"click\" : \"mousedown\"), role);\n\t\t\t\t}\n\t\t\t\trole = ui.customAttr(el,\"pressExec\");\n\t\t\t\tif(!!role){\n\t\t\t\t\tvar roles = role.split(/,/);\n\t\t\t\t\taddbtnevent(el, \"mousedown\", roles[0]);\n\t\t\t\t\tif(!!role[1]){\n\t\t\t\t\t\taddbtnevent(el, \"mouseup\", roles[1]);\n\t\t\t\t\t\taddbtnevent(el, \"mouseleave\", roles[1]);\n\t\t\t\t\t\taddbtnevent(el, \"touchcancel\", roles[1]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(el.nodeType===3){\n\t\t\t\tif(el.data.match(/^__(.+)__(.+)__$/)){\n\t\t\t\t\ttoolarea.captions.push({textnode:el, str_jp:RegExp.$1, str_en:RegExp.$2});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\t\n\t//---------------------------------------------------------------------------\n\t// toolarea.display()    全てのラベルに対して文字列を設定する\n\t// toolarea.setdisplay() 管理パネルに表示する文字列を個別に設定する\n\t//---------------------------------------------------------------------------\n\tdisplay : function(){\n\t\t/* ツールパネル領域 */\n\t\t/* -------------- */\n\t\tvar mandisp  = (ui.menuconfig.get(\"toolarea\") ? 'block' : 'none');\n\t\tgetEL('usepanel').style.display = mandisp;\n\t\tgetEL('checkpanel').style.display = mandisp;\n\t\t/* 経過時間の表示/非表示設定 */\n\t\tgetEL('separator2').style.display = (ui.puzzle.playeronly ? \"\" : \"none\");\n\t\tgetEL('timerpanel').style.display = (ui.puzzle.playeronly ? \"block\" : \"none\");\n\t\t\n\t\tfor(var idname in this.items){ this.setdisplay(idname);}\n\t\t\n\t\t/* ボタン領域 */\n\t\t/* --------- */\n\t\tgetEL('btnarea').style.display = \"\";\n\t\tpzpr.util.unselectable(getEL('btnarea'));\n\t\t\n\t\tthis.setdisplay(\"operation\");\n\t\tgetEL('btnclear2').style.display  = (!ui.puzzle.board.disable_subclear ? \"\" : \"none\");\n\t\tgetEL('btncircle').style.display  = (ui.puzzle.pid==='pipelinkr' ? \"\" : \"none\");\n\t\tgetEL('btncolor').style.display   = (ui.puzzle.pid==='tentaisho' ? \"\" : \"none\");\n\t\t/* ボタンエリアの色分けボタンは、ツールパネル領域が消えている時に表示 */\n\t\tgetEL('btnirowake').style.display = ((ui.puzzle.painter.irowake && !ui.menuconfig.get(\"toolarea\")) ? \"\" : \"none\");\n\t\tgetEL('btnirowakeblk').style.display = ((ui.puzzle.painter.irowakeblk && !ui.menuconfig.get(\"toolarea\")) ? \"\" : \"none\");\n\t\tthis.setdisplay(\"trialmode\");\n\t\t\n\t\t/* 共通：キャプションの設定 */\n\t\t/* --------------------- */\n\t\tfor(var i=0;i<this.captions.length;i++){\n\t\t\tvar obj = this.captions[i];\n\t\t\tobj.textnode.data = ui.selectStr(obj.str_jp, obj.str_en);\n\t\t}\n\t},\n\tsetdisplay : function(idname){\n\t\tif(idname===\"operation\"){\n\t\t\tvar opemgr = ui.puzzle.opemgr;\n\t\t\tgetEL('btnundo').style.color = (!opemgr.enableUndo ? 'silver' : '');\n\t\t\tgetEL('btnredo').style.color = (!opemgr.enableRedo ? 'silver' : '');\n\t\t}\n\t\telse if(idname===\"trialmode\"){\n\t\t\tvar trialstage = ui.puzzle.board.trialstage;\n\t\t\tgetEL('btntrial').style.color       = ((trialstage>0) ? 'silver' : '');\n\t\t\tgetEL('btntrialarea').style.display = ((trialstage>0) ? 'block' : 'none');\n\t\t\t\n\t\t\tgetEL('btntrialr').style.display  = ((trialstage<=1) ? '' : 'none');\n\t\t\tgetEL('btntrialr2').style.display = ((trialstage>1)  ? '' : 'none');\n\t\t\tgetEL('btntrialra').style.display = ((trialstage>1)  ? '' : 'none');\n\t\t}\n\t\telse if(this.items===null || !this.items[idname]){\n\t\t\t/* DO NOTHING */\n\t\t}\n\t\telse if(ui.menuconfig.valid(idname)){\n\t\t\tvar toolitem = this.items[idname];\n\t\t\ttoolitem.el.style.display = \"\";\n\t\t\t\n\t\t\t/* 子要素の設定を行う */\n\t\t\tif(!!toolitem.children){\n\t\t\t\tvar children = toolitem.children;\n\t\t\t\tvar validval = (idname==='inputmode' ? ui.puzzle.mouse.getInputModeList() : null);\n\t\t\t\tfor(var i=0;i<children.length;i++){\n\t\t\t\t\tvar child = children[i], value = ui.customAttr(child,\"value\"), selected = (value===\"\"+ui.menuconfig.get(idname));\n\t\t\t\t\tchild.className = (selected ? \"child childsel\" : \"child\");\n\t\t\t\t\tchild.style.display = ((validval===null || validval.indexOf(value)>=0) ? '' : 'none');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar disabled = null;\n\t\t\t\tif(idname===\"inputmode\"){ disabled = (validval.length===1);}\n\t\t\t\tif(disabled!==null){ toolitem.el.className = (!disabled ? \"\" : \"disabled\");}\n\t\t\t}\n\t\t\t/* チェックボックスの表記の設定 */\n\t\t\telse if(!!toolitem.checkbox){\n\t\t\t\tvar check = toolitem.checkbox;\n\t\t\t\tif(!!check){ check.checked = ui.menuconfig.get(idname);}\n\t\t\t\t\n\t\t\t\tvar disabled = null;\n\t\t\t\tif(idname===\"keypopup\"){ disabled = !ui.keypopup.paneltype[ui.puzzle.editmode?1:3];}\n\t\t\t\tif(idname===\"bgcolor\") { disabled = ui.puzzle.editmode;}\n\t\t\t\tif(idname===\"passallcell\"){ disabled = !ui.puzzle.editmode;}\n\t\t\t\tif(disabled!==null){ toolitem.checkbox.disabled = (!disabled ? \"\" : \"true\");}\n\t\t\t}\n\t\t\t\n\t\t\tif((idname===\"disptype_pipelinkr\") && !!getEL('btncircle')){\n\t\t\t\tgetEL('btncircle').innerHTML = ((ui.menuconfig.get(idname)===1)?\"○\":\"■\");\n\t\t\t}\n\t\t}\n\t\telse if(!!this.items[idname]){\n\t\t\tthis.items[idname].el.style.display = \"none\";\n\t\t}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// toolarea.toolclick()   ツールパネルの入力があった時、設定を変更する\n\t//---------------------------------------------------------------------------\n\ttoolclick : function(e){\n\t\tvar el = e.target, parent = el.parentNode;\n\t\tvar idname = ui.customAttr(parent,\"config\")||ui.customAttr(parent.parentNode,\"config\"), value;\n\t\tif(!!this.items[idname].checkbox){ value = !!el.checked;}\n\t\telse                             { value = ui.customAttr(el,\"value\");}\n\t\tui.menuconfig.set(idname, value);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// Canvas下にあるボタンが押された/放された時の動作\n\t//---------------------------------------------------------------------------\n\tanswercheck : function(){ ui.menuarea.answercheck();},\n\tundo     : function(){ ui.undotimer.startButtonUndo();},\n\tundostop : function(){ ui.undotimer.stopButtonUndo();},\n\tredo     : function(){ ui.undotimer.startButtonRedo();},\n\tredostop : function(){ ui.undotimer.stopButtonRedo();},\n\tansclear : function(){ ui.menuarea.ACconfirm();},\n\tsubclear : function(){ ui.menuarea.ASconfirm();},\n\tirowake  : function(){ ui.puzzle.irowake();},\n\tencolorall : function(){ ui.puzzle.board.encolorall();}, /* 天体ショーのボタン */\n\tdropblocks : function(){ ui.puzzle.board.operate('drop');},\n\tresetblocks: function(){ ui.puzzle.board.operate('resetpos');},\n\tshowgatenum: function(){ ui.puzzle.board.operate('showgatenumber');},\n\thidegatenum: function(){ ui.puzzle.board.operate('hidegatenumber');},\n\tenterTrial : function(){ if(ui.puzzle.board.trialstage===0){ ui.puzzle.enterTrial();}},\n\tenterFurtherTrial : function(){ ui.puzzle.enterTrial();},\n\tacceptTrial : function(){ ui.puzzle.acceptTrial();},\n\trejectTrial : function(){ ui.puzzle.rejectTrial();},\n\trejectCurrentTrial : function(){ ui.puzzle.rejectCurrentTrial();},\n\n\t//---------------------------------------------------------------------------\n\t// toolarea.toggledisp()   帰ってきたパイプリンクでアイスと○などの表示切り替え時の処理を行う\n\t//---------------------------------------------------------------------------\n\ttoggledisp : function(){\n\t\tvar current = ui.menuconfig.get('disptype_pipelinkr');\n\t\tui.menuconfig.set('disptype_pipelinkr', (current===1?2:1));\n\t}\n};\n","// Notify.js v3.5.0\n/* global ui:false, getEL:false */\n\n//---------------------------------------------------------------------------\n// ★Notifyクラス alert, confirm関連を管理します\n//---------------------------------------------------------------------------\nui.notify =\n{\n\tonconfirm : null,\n\t\n\t//---------------------------------------------------------------------------\n\t// notify.reset()      Notificationの設定を初期化する\n\t//---------------------------------------------------------------------------\n\treset : function(){\n\t\t/* イベントを割り当てる */\n\t\tthis.walkElement(getEL(\"notifies\"));\n\t},\n\t\n\t//---------------------------------------------------------------------------\n\t// notify.walkElement()  エレメントを探索して領域の初期設定を行う\n\t//---------------------------------------------------------------------------\n\twalkElement : function(parent){\n\t\tvar notify = this;\n\t\tui.misc.walker(parent, function(el){\n\t\t\tif(el.nodeType===1){\n\t\t\t\t/* ボタン領域 */\n\t\t\t\tvar role = ui.customAttr(el,\"buttonExec\");\n\t\t\t\tif(!!role){\n\t\t\t\t\tpzpr.util.addEvent(el, (!pzpr.env.API.touchevent ? \"click\" : \"mousedown\"), notify, notify[role]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* タイトルバーでボックスを動かす設定 */\n\t\t\t\tif(el.className==='titlebar'){\n\t\t\t\t\tpzpr.util.addEvent(el, \"mousedown\", ui.popupmgr, ui.popupmgr.titlebardown);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t//--------------------------------------------------------------------------------\n\t// ui.alert()   現在の言語に応じたダイアログを表示する\n\t// ui.confirm() 現在の言語に応じた選択ダイアログを表示し、結果を返す\n\t// ui.setVerticalPosition() 指定したエレメントの盾位置を画面中央に設定して表示する\n\t//--------------------------------------------------------------------------------\n\talert : function(strJP, strEN){\n\t\tgetEL('notification').innerHTML = ui.selectStr(strJP, strEN);\n\t\tthis.setVerticalPosition(getEL('assertbox'));\n\t},\n\tconfirm : function(strJP, strEN, func){\n\t\tgetEL('confirmcaption').innerHTML = ui.selectStr(strJP, strEN);\n\t\tthis.setVerticalPosition(getEL('confirmbox'));\n\t\tthis.onconfirm = func;\n\t},\n\tsetVerticalPosition : function(el){\n\t\tvar elbg = getEL(\"notifybg\");\n\t\telbg.style.display = \"block\";\n\t\tel.style.display = 'inline-block';\n\t\t\n\t\t/* innerHeightがIE8以下にないので、代わりに背景要素の高さ(height=100%), 幅を取得します */\n\t\tvar rect = pzpr.util.getRect(el), rectbg = pzpr.util.getRect(elbg);\n\t\tel.style.top  = ((rectbg.height - rect.height) / 2) + \"px\";\n\t\tel.style.left = ((rectbg.width -  rect.width ) / 2) + \"px\";\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// notify.closealert()  alertを非表示に戻す\n\t//---------------------------------------------------------------------------\n\tclosealert : function(e){\n\t\tgetEL('assertbox').style.display = 'none';\n\t\tgetEL(\"notifybg\").style.display = \"none\";\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// notify.confirmtrue()  confirmでOKが押された時の処理を記入する\n\t// notify.confirmfalse() confirmでCancelが押されたときの処理を記入する\n\t//---------------------------------------------------------------------------\n\tconfirmtrue : function(e){\n\t\tif(!!this.onconfirm){ this.onconfirm();}\n\t\tthis.onconfirm = null;\n\t\tthis.confirmfalse(e);\n\t},\n\tconfirmfalse : function(e){\n\t\tgetEL('confirmbox').style.display = 'none';\n\t\tgetEL(\"notifybg\").style.display = \"none\";\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t}\n};\n","// KeyPopup.js v3.4.0\n/* global ui:false, createEL:false, getEL:false */\n\n//---------------------------------------------------------------------------\n// ★KeyPopupクラス マウスからキーボード入力する際のPopupウィンドウを管理する\n//---------------------------------------------------------------------------\n// キー入力用Popupウィンドウ\nui.keypopup =\n{\n\t/* メンバ変数 */\n\tpaneltype : {1:0, 3:0},\t/* パネルのタイプ */\n\telement : null,\t\t\t/* キーポップアップのエレメント */\n\n\ttdcolor : \"black\",\t/* 文字の色 */\n\timgCR : [1,1],\t\t/* img表示用画像の横×縦のサイズ */\n\n\timgs  : [],\t\t\t/* resize用 */\n\n\tbasepanel : null,\n\tclearflag : false,\n\n\t/* どの文字配置を作成するかのテーブル */\n\ttype : {\n\t\tslither    : [3,0],\n\t\tnawabari   : [4,0],\n\t\tfourcells  : [4,0],\n\t\tfivecells  : [4,0],\n\t\tfillmat    : [4,0],\n\t\tpaintarea  : [4,0],\n\t\tlightup    : [4,0],\n\t\tshakashaka : [4,0],\n\t\tgokigen    : [4,0],\n\t\twagiri     : [4,0],\n\t\tshugaku    : [4,0],\n\t\tcreek      : [4,0],\n\t\tichimaga   : [4,0],\n\t\tichimagam  : [4,0],\n\t\tichimagax  : [4,0],\n\t\tsukoro     : [4,4],\n\t\tsukororoom : [4,4],\n\t\tlookair    : [5,0],\n\t\ttawa       : [6,0],\n\t\thashikake  : [8,0],\n\t\ttapa       : [8,0],\n\t\tamibo      : [10,0],\n\t\tbag        : [10,0],\n\t\tbdblock    : [10,0],\n\t\tcountry    : [10,0],\n\t\tusotatami  : [10,0],\n\t\theyawake   : [10,0],\n\t\tayeheya    : [10,0],\n\t\tkurodoko   : [10,0],\n\t\tnagenawa   : [10,0],\n\t\tringring   : [10,0],\n\t\tnumlin     : [10,0],\n\t\tnurikabe   : [10,0],\n\t\tnuribou    : [10,0],\n\t\tmochikoro  : [10,0],\n\t\tmochinyoro : [10,0],\n\t\tshikaku    : [10,0],\n\t\taho        : [10,0],\n\t\tshimaguni  : [10,0],\n\t\tchocona    : [10,0],\n\t\tyajitatami : [10,0],\n\t\ttasquare   : [10,0],\n\t\tkurotto    : [10,0],\n\t\tbonsan     : [10,0],\n\t\theyabon    : [10,0],\n\t\trectslider : [10,0],\n\t\tsatogaeri  : [10,0],\n\t\tyosenabe   : [10,0],\n\t\therugolf   : [10,0],\n\t\tfirefly    : [10,0],\n\t\ttateyoko   : [10,0],\n\t\tfactors    : [10,10],\n\t\tfillomino  : [10,10],\n\t\trenban     : [10,10],\n\t\tripple     : [10,10],\n\t\tcojun      : [10,10],\n\t\tmakaro     : [10,10],\n\t\tsudoku     : [10,10],\n\t\tnanro      : [10,10],\n\t\tview       : [10,10],\n\t\tkakuru     : [10,10],\n\t\tkazunori   : [10,10],\n\t\tbuilding   : [10,10],\n\t\tkropki     : [10,10],\n\t\ttilepaint  : [51,0],\n\t\ttriplace   : [51,0],\n\t\tkakuro     : [51,10],\n\t\t\n\t\tslalom     : [101,0],\n\t\treflect    : [102,0],\n\t\tpipelink   : [111,0],\n\t\tpipelinkr  : [111,0],\n\t\tloopsp     : [111,0],\n\t\ttatamibari : [112,0],\n\t\thakoiri    : [113,113],\n\t\tkusabi     : [114,0]\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// kp.display()     キーポップアップを表示する\n\t//---------------------------------------------------------------------------\n\tdisplay : function(){\n\t\tvar mode = ui.puzzle.editmode?1:3;\n\t\tif(this.element && !!this.paneltype[mode] && ui.menuconfig.get('keypopup')){\n\n\t\t\tthis.element.style.display = 'block';\n\n\t\t\tgetEL('panelbase1').style.display = (mode===1?'block':'none');\n\t\t\tgetEL('panelbase3').style.display = (mode===3?'block':'none');\n\t\t}\n\t\telse if(!!this.element){\n\t\t\tthis.element.style.display = 'none';\n\t\t}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// kp.create()      キーポップアップを生成して初期化する\n\t// kp.createtable() キーポップアップのポップアップを作成する\n\t//---------------------------------------------------------------------------\n\tcreate : function(){\n\t\tif(!!this.element){\n\t\t\tgetEL('panelbase1').innerHTML = '';\n\t\t\tgetEL('panelbase3').innerHTML = '';\n\t\t}\n\t\t\n\t\tthis.imgs = [];\t\t\t// resize用\n\t\t\n\t\tvar type = this.type[ui.puzzle.pid];\n\t\tif(!type){ type=[0,0];}\n\t\t\n\t\tthis.paneltype = { 1:(!ui.puzzle.playeronly?type[0]:0), 3:(type[1])};\n\t\tif(!this.paneltype[1] && !this.paneltype[3]){ return;}\n\t\t\n\t\tif(!this.element){\n\t\t\tvar rect = pzpr.util.getRect(getEL('divques'));\n\t\t\tthis.element = getEL('keypopup');\n\t\t\tthis.element.style.left = (rect.left+48)+'px';\n\t\t\tthis.element.style.top  = (rect.top +48)+'px';\n\t\t\tpzpr.util.unselectable(this.element);\n\t\t}\n\t\t\n\t\tif(this.paneltype[1]!==0){ this.createtable(1);}\n\t\tif(this.paneltype[3]!==0){ this.createtable(3);}\n\t\t\n\t\tthis.resizepanel();\n\t\t\n\t\tvar bar = getEL('barkeypopup');\n\t\tui.event.addEvent(bar, \"mousedown\", ui.popupmgr, ui.popupmgr.titlebardown);\n\t\tui.event.addEvent(bar, 'dblclick', ui.menuconfig, function(){ this.set('keypopup',false);});\n\t},\n\tcreatetable : function(mode,type){\n\t\tthis.basepanel = getEL('panelbase'+mode);\n\t\tthis.basepanel.innerHTML = '';\n\t\t\n\t\tthis.tdcolor = (mode===3 ? ui.puzzle.painter.fontAnscolor : \"black\");\n\n\t\tthis.generate(mode);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// kp.generate()    キーポップアップのテーブルを作成する\n\t// kp.gentable4()   キーポップアップの0～4を入力できるテーブルを作成する\n\t// kp.gentable10()  キーポップアップの0～9を入力できるテーブルを作成する\n\t// kp.gentable51()  キーポップアップの[＼],0～9を入力できるテーブルを作成する\n\t//---------------------------------------------------------------------------\n\tgenerate : function(mode){\n\t\tvar type = this.paneltype[mode];\n\t\tif     (type===4) { this.gentable4 (mode);}\n\t\telse if(type===10){ this.gentable10(mode);}\n\t\telse if(type===51){ this.gentable51(mode);}\n\n\t\telse if(type===3) { this.gentable3(mode);}\n\t\telse if(type===5) { this.gentable5(mode);}\n\t\telse if(type===6) { this.gentable6(mode);}\n\t\telse if(type===8) { this.gentable8(mode);}\n\n\t\telse if(type===101){ this.generate_slalom(mode);}\n\t\telse if(type===102){ this.generate_reflect(mode);}\n\t\telse if(type===111){ this.generate_pipelink(mode);}\n\t\telse if(type===112){ this.generate_tatamibari(mode);}\n\t\telse if(type===113){ this.generate_hakoiri(mode);}\n\t\telse if(type===114){ this.generate_kusabi(mode);}\n\t},\n\tgentable4 : function(mode){\n\t\tvar pid = ui.puzzle.pid, itemlist = ['1','2','3','4'];\n\t\tif((mode===3)&&(pid==='sukoro'||pid==='sukororoom')){\n\t\t\tvar mbcolor = ui.puzzle.painter.mbcolor;\n\t\t\titemlist.push(\n\t\t\t\t['q',{text:'○',color:mbcolor}],\n\t\t\t\t['w',{text:'×',color:mbcolor}],\n\t\t\t\t' ',null\n\t\t\t);\n\t\t}\n\t\telse{\n\t\t\tvar cap = '?';\n\t\t\tif(ui.puzzle.painter.hideHatena){\n\t\t\t\tswitch(pid){\n\t\t\t\t\tcase 'lightup': case 'shakashaka':                           cap='■'; break;\n\t\t\t\t\tcase 'gokigen': case 'wagiri': case 'shugaku': case 'creek': cap='○'; break;\n\t\t\t\t}\n\t\t\t}\n\t\t\titemlist.push('0',null,' ',['-',cap]);\n\t\t}\n\t\tthis.generate_main(itemlist,4);\n\t},\n\tgentable10 : function(mode){\n\t\tvar pid = ui.puzzle.pid, itemlist = [];\n\t\tif((mode===3)&&(ui.puzzle.klass.Cell.prototype.numberWithMB)){\n\t\t\tvar mbcolor = ui.puzzle.painter.mbcolor;\n\t\t\titemlist.push(\n\t\t\t\t['q',{text:'○',color:mbcolor}],\n\t\t\t\t['w',{text:'×',color:mbcolor}],\n\t\t\t\t' ',null\n\t\t\t);\n\t\t}\n\t\tif((mode===1)&&(pid==='kakuru'||pid==='tateyoko')){\n\t\t\titemlist.push(['q1','■'],['w2','□'],' ',['-','?']);\n\t\t}\n\t\t\n\t\titemlist.push('0','1','2','3','4','5','6','7','8','9');\n\t\titemlist.push(((mode===1)||(!ui.puzzle.klass.Cell.prototype.numberWithMB)) ? ' ' : null);\n\t\t\n\t\tvar cap = null;\n\t\tif((mode===3)||(pid==='kakuru'||pid==='tateyoko')){\n\t\t}\n\t\telse if(!ui.puzzle.painter.hideHatena){\n\t\t\tcap = '?';\n\t\t}\n\t\telse if(pid==='tasquare'){\n\t\t\tcap = '□';\n\t\t}\n\t\telse if(pid==='rectslider'){\n\t\t\tcap = '■';\n\t\t}\n\t\telse if(pid==='kurotto'||pid==='bonsan'||pid==='satogaeri'||pid==='heyabon'||pid==='yosenabe'||pid==='herugolf'||pid==='kazunori'){\n\t\t\tcap = '○';\n\t\t}\n\t\tif(cap!==null){ itemlist.push(['-',cap]);}\n\t\tthis.generate_main(itemlist,4);\n\t},\n\tgentable51 : function(mode){\n\t\tthis.generate_main([['q',{image:0}],' ','1','2','3','4','5','6','7','8','9','0'],4);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// kp.gentable3()  キーポップアップの0～4を入力できるテーブルを作成する\n\t// kp.gentable5()  キーポップアップの0～5を入力できるテーブルを作成する\n\t// kp.gentable6()  キーポップアップの0～6を入力できるテーブルを作成する\n\t// kp.gentable8()  キーポップアップの0～8を入力できるテーブルを作成する\n\t//---------------------------------------------------------------------------\n\tgentable3 : function(mode){\n\t\tthis.generate_main(['1','2','3','0',' ',['-','?']],3);\n\t},\n\tgentable5: function(mode){\n\t\tthis.generate_main(['1','2','3','4','5',null,'0',' ',['-','?']],3);\n\t},\n\tgentable6 : function(mode){\n\t\tthis.generate_main(['1','2','3','4','5','6','0',' ',['-','?']],3);\n\t},\n\tgentable8 : function(mode){\n\t\tif(ui.puzzle.pid!=='tapa'){\n\t\t\tthis.generate_main(['1','2','3','4','5','6','7','8',' ',['-','○']],4);\n\t\t}\n\t\telse{\n\t\t\tthis.generate_main(['1','2','3','4','5','6','7','8','0',' ',['-','?']],4);\n\t\t}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// kp.generate_slalom()     スラローム用のテーブルを作成する\n\t// kp.generate_reflect()    リフレクトリンク用のテーブルを作成する\n\t//---------------------------------------------------------------------------\n\tgenerate_slalom : function(mode){\n\t\tthis.imgCR = [4,1];\n\t\tthis.generate_main([\n\t\t\t['q',{image:0}],\n\t\t\t['s',{image:1}],\n\t\t\t['w',{image:2}],\n\t\t\t['e',{image:3}],\n\t\t\t['r',' '],\n\t\t\t'1','2','3','4','5',\n\t\t\t'6','7','8','9','0',\n\t\t\t'-',' '\n\t\t],5);\n\t},\n\tgenerate_reflect : function(mode){\n\t\tthis.imgCR = [4,1];\n\t\tthis.generate_main([\n\t\t\t['q',{image:0}],\n\t\t\t['w',{image:1}],\n\t\t\t['e',{image:2}],\n\t\t\t['r',{image:3}],\n\t\t\t['t','╋'],['y',' '],\n\t\t\t'1','2','3','4','5','6',\n\t\t\t'7','8','9','0','-'\n\t\t],6);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// kp.generate_pipelink()   パイプリンク、帰ってきたパイプリンク、環状線スペシャル用のテーブルを作成する\n\t// kp.generate_tatamibari() タタミバリ用のテーブルを作成する\n\t// kp.generate_hakoiri()    はこいり○△□用のテーブルを作成する\n\t// kp.generate_kusabi()     クサビリンク用のテーブルを作成する\n\t//---------------------------------------------------------------------------\n\tgenerate_pipelink : function(mode){\n\t\tvar pid = ui.puzzle.pid, itemlist = [];\n\t\titemlist.push(\n\t\t\t['q','╋'],['w','┃'],['e','━'],['r',' '],(pid!=='loopsp'?['-','?']:null),\n\t\t\t['a','┗'],['s','┛'],['d','┓'],['f','┏']\n\t\t);\n\t\tif     (pid==='pipelink') { itemlist.push(null);}\n\t\telse if(pid==='pipelinkr'){ itemlist.push(['1','○']);}\n\t\telse if(pid==='loopsp')   { itemlist.push(['-','○']);}\n\t\t\n\t\tif(pid==='loopsp'){\n\t\t\titemlist.push('1','2','3','4','5','6','7','8','9','0');\n\t\t}\n\t\tthis.generate_main(itemlist,5);\n\t},\n\tgenerate_tatamibari : function(mode){\n\t\tthis.generate_main([['q','╋'],['w','┃'],['e','━'],['r',' '],['-','?']],3);\n\t},\n\tgenerate_hakoiri : function(mode){\n\t\tthis.generate_main([\n\t\t\t['1','○'],['2','△'],['3','□'],\n\t\t\t['4',{text:(mode===1?'?':'・'), color:(mode===3?\"rgb(255, 96, 191)\":\"\")}],' '\n\t\t],3);\n\t},\n\tgenerate_kusabi : function(mode){\n\t\tthis.generate_main([['1','同'],['2','短'],['3','長'],['-','○'],' '],3);\n\t},\n\n\tgenerate_main : function(list, split){\n\t\tfor(var i=0; i<list.length; i++){\n\t\t\tthis.inputcol(list[i]);\n\t\t\tif((i+1)%split===0){ this.insertrow();}\n\t\t}\n\t\tif(i%split!==0){ this.insertrow();}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// kp.inputcol()  テーブルのセルを追加する\n\t// kp.insertrow() テーブルの行を追加する\n\t//---------------------------------------------------------------------------\n\tinputcol : function(item){\n\t\tvar type = \"num\", ca, disp, color = this.tdcolor;\n\t\tif(!item){ type = \"empty\";}\n\t\telse{\n\t\t\tif(typeof item===\"string\"){ ca = disp = item;}\n\t\t\telse if(typeof item[1]===\"string\"){ ca = item[0]; disp = item[1];}\n\t\t\telse if(!!item[1].text) { ca = item[0]; disp = item[1].text; color = item[1].color;}\n\t\t\telse if(item[1].image!==void 0){ ca = item[0]; disp = item[1].image; type = \"image\";}\n\t\t}\n\t\t\n\t\tvar _div = null, _child = null;\n\t\tif(type!=='empty'){\n\t\t\t_div = createEL('div');\n\t\t\t_div.className = 'kpcell kpcellvalid';\n\t\t\t_div.onclick = function(e){ e.preventDefault();};\n\t\t\tui.event.addEvent(_div, \"mousedown\", ui.puzzle, function(e){ this.key.keyevent(ca,0); e.preventDefault(); e.stopPropagation();});\n\t\t\tpzpr.util.unselectable(_div);\n\t\t}\n\t\telse{\n\t\t\t_div = createEL('div');\n\t\t\t_div.className = 'kpcell kpcellempty';\n\t\t\tpzpr.util.unselectable(_div);\n\t\t}\n\n\t\tif(type==='num'){\n\t\t\t_child = createEL('span');\n\t\t\t_child.className   = 'kpnum';\n\t\t\t_child.style.color = color;\n\t\t\t_child.innerHTML   = disp;\n\t\t\tpzpr.util.unselectable(_child);\n\t\t}\n\t\telse if(type==='image'){\n\t\t\t_child = createEL('img');\n\t\t\t_child.className = 'kpimg';\n\t\t\tvar pid = ui.puzzle.pid;\n\t\t\t_child.src = \"data:image/gif;base64,\"+this.dataurl[!!this.dataurl[pid] ? pid : 'shitappa'];\n\t\t\tpzpr.util.unselectable(_child);\n\t\t\tvar x = disp%this.imgCR[0], y = (disp-x)/this.imgCR[1];\n\t\t\tthis.imgs.push({'el':_child, 'x':x, 'y':y});\n\t\t}\n\n\t\tif(this.clearflag){ _div.style.clear='both'; this.clearflag=false;}\n\t\tif(!!_child){ _div.appendChild(_child);}\n\t\tthis.basepanel.appendChild(_div);\n\t},\n\tinsertrow : function(){\n\t\tthis.clearflag = true;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// kp.resizepanel() キーポップアップのセルのサイズを変更する\n\t//---------------------------------------------------------------------------\n\tresizepanel : function(){\n\t\tvar cellsize = Math.min(ui.puzzle.painter.cw, 120);\n\t\tif(cellsize<20){ cellsize=20;}\n\n\t\tvar dsize = (cellsize*0.90)|0, tsize = (cellsize*0.70)|0;\n\t\tfor(var i=0,len=this.imgs.length;i<len;i++){\n\t\t\tvar obj = this.imgs[i], img=obj.el;\n\t\t\timg.style.width  = \"\"+(dsize*this.imgCR[0])+\"px\";\n\t\t\timg.style.height = \"\"+(dsize*this.imgCR[1])+\"px\";\n\t\t\timg.style.clip   = \"rect(\"+(dsize*obj.y+1)+\"px,\"+(dsize*(obj.x+1))+\"px,\"+(dsize*(obj.y+1))+\"px,\"+(dsize*obj.x+1)+\"px)\";\n\t\t\timg.style.top    = \"-\"+(obj.y*dsize)+\"px\";\n\t\t\timg.style.left   = \"-\"+(obj.x*dsize)+\"px\";\n\t\t}\n\n\t\tui.misc.modifyCSS({\n\t\t\t\"div.kpcell\" : { width:(\"\"+dsize+\"px\"), height:(\"\"+dsize+\"px\"), lineHeight:(\"\"+dsize+\"px\")},\n\t\t\t\"span.kpnum\" : { fontSize:(\"\"+tsize+\"px\")}\n\t\t});\n\t},\n\n\tdataurl : {\n\t\tslalom   : \"R0lGODlhAAFAAMIEAAICAmBgYJ+fn///////AP//AP//AP//ACH5BAEKAAQALAAAAAAAAUAAAAP+OLrc/jDKSau9OOvNu/9gKI5kaZ5oqq5s675wLM90bd94ru+24AdAH68BKBqHNqNyyWw6n9DSD2oMCHhMZI3K7XqLI0Hgq7TmstoZec0GhMTt8jW5TKvj+OhnnFfOaWh2MH2EdR0ChUtmd0qCMYmJHXxOQFZ/P5OUjEeOL5CFHJmKfxFTmp2oIZ+EG6JVpBVwTQGptR2rfRquAIsbiLO2wRi4eRm7tB+yS7DCzQ7EeBi/yyO7zCiBziTQcRfTfiWuyCzZ2iLcbReu1yDrLeXmIOhsFt9F7CGu74bx5/NkFkSNO2EPAL4R8Prd+vclFpODbxKWkKhQA8OGFAS2EAX+UR6/ih4ueqFQsGPEMiCDieySUZGLkilrreTSEpwLjjFTzaRCweULewNz2tmpR4JPTyhTUBQ6geiTCUBjiFKxlGkEp06gUoMxVelHqxawNpmAE4Y9kxyqevw4dkFbt+XeQhBbtezPrSfUfpDLN67fr8/oNpLQ1SxeE3pDZuv7Ve4Ax4EFgyF8uMVZr4MxZ368+O9mzoCJSJ5cqjILeyAZb3bMuupo0hAucw3tTDUnBa0bu36tNemLwmCRvHbT1Lflo8GHDO9JG0XU5MJ5kzWdwm7e5tBFjyaJXAVMzbCzX5Ve3OaK5+CJizdKnrLx9GgXfl4fWbJD6iQ0rkgMfXmvBX0pfEcVdvT5x113+SF43Xz0MWBgTeYliF+DgLTH3IShMBEUhTc8eCCGxjQRH4fkWAjhe744MSKJ+5l4YoQhisjiDh4GRMmKBRmx4lq3zQiafa08YQlUu+goA3/J1agOFUH44CQQXOyoCoHrKelNkXj08giV4lkpTSJaHslldl5Kg2UXYW4SHotlapAjk1Iu2KOPVplCyZB05pmDk0Lo6eefgAYq6KCEFmrooSwkAAA7\",\n\t\treflect  : \"R0lGODlhAAFAAIABAAAAAP///yH5BAEKAAEALAAAAAAAAUAAAAL+jI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6bgD8H/A9AMSi8YhMKpdJCPMJjSKdQiCOGJFqt9Mh96vNYq22ogSMflLT7OPZTJ4ZJ+362GGv0+dxmHufh7YW+EXR1cdy+EbINcgoVdGEqCJp+BjmdRlloTSJ0smpCeUoWmlp6hmyhFHKRNoKFwqaCuLKCqvIgJt7OkvLoZaxy4c3fHcx+ruRLGz8WrrMrCxrq+GciQu8OR25HZ2N3dqByS3m/S0eLuqxVf7si76ufvnR6K7bXp9eDK2ff4+gUK1+/DSpEggwCEJ/9OYFEiEIYMSDDQsyGpHmXkb+jBUbGOQ4URmbEh3xXSTRZlpKkict2jGhh1ZMlg8dbqQ50tPLE4Tegfm0s0+eFDVd3oQ5NE5RnkE9NkWaFEhPSjOdriQ6lUdLrDmN2qOaNcejFlethuQatsxYskdN/mS7Vm3cRGcXtAU7V4Y8F3UV9EWb9wVBvgvdkiO8V/BgxIcNn2P8EXJJycG8rtILi3JgzfDsNlacecWuGp/9QqIxDO8+OY89S8M8mmls0q9dV0N9DWVu2rcd84KdGmTwG5XNosJtrArD4cQvW1YuN/nA5NCj/7G8g3qseLuvHDf9m7d2bdqrN79u/JjY8uq7sZeK3jF89ubNvZ/fHnx+7/Q96z9nrtV2bpHRn4A2SUfgfgEpyF+BiziolH8HMNgghP8hqJQTCW3IYYcefghiiCKOSGKJJp6IYooqrlhOAQA7\",\n\t\tshitappa : \"R0lGODlhQABAAIABAAAAAP//ACH5BAEKAAEALAAAAABAAEAAAAL6jI+py+0Po5y02ouz3rz7DwHiSJbmiaZnqLbuW7LwTMdPjdcyCUb8veo5fkOUsEFEjgK2YyLJ+DWdBuiCOHVaFcmscPtcIrwg8Fh8Rn/VUXbVvIG/RW13R860z+k9PJys4ad3AIghyFc0aHEI4IMnwQj5uEMpqWjZCIToeFmZmDlRyAmqtIlJWhG5OMnVyRrWeeUaW2c66nkhKmvbykuhC4u6K7xKm+ebRlyMHIwb+Kh6F12qbCg3La2InY28za3s/T3sXGYV7pF1jt41y7yOpv5hEy/PQ18f9Ek1fF8OnAPwxY6ABP8VPMgIYcF9DBs6fAgxosSJFBMUAAA7\"\n\t}\n};\n","// DataBase.js v3.4.0\n/* global ui:false, createEL:false, getEL:false, JSON:false */\n\n//---------------------------------------------------------------------------\n// ★ProblemDataクラス データベースに保存する1つのデータを保持する\n//---------------------------------------------------------------------------\nui.ProblemData = function(){\n\tthis.id = null;\n\tthis.pdata = '';\n\tthis.time = 0;\n\n\tif(arguments.length>0){ this.parse(arguments[0]);}\n};\nui.ProblemData.prototype =\n{\n\tupdatePuzzleData : function(id){\n\t\tvar puzzle = ui.puzzle, bd = puzzle.board;\n\t\tthis.id = id;\n\t\tthis.pdata = puzzle.getFileData(pzpr.parser.FILE_PZPR).replace(/\\r?\\n/g,\"/\");\n\t\tthis.time = (pzpr.util.currentTime()/1000)|0;\n\t\tthis.pid = puzzle.pid;\n\t\tthis.col = bd.cols;\n\t\tthis.row = bd.rows;\n\t},\n\tupdateMetaData : function(){\n\t\tvar metadata = new pzpr.MetaData(), form = document.database;\n\t\tmetadata.comment = form.comtext.value;\n\t\tmetadata.hard    = form.hard.value;\n\t\tmetadata.author  = form.author.value;\n\t\tmetadata.source  = form.source.value;\n\t\tvar pzl = pzpr.parser(this.pdata);\n\t\tpzl.metadata.update(metadata);\n\t\tthis.pdata = pzl.generate();\n\t\treturn metadata;\n\t},\n\tgetFileData : function(){\n\t\treturn this.pdata.replace(/\\//g,\"\\n\");\n\t},\n\ttoString : function(){\n\t\tvar data = { id:this.id, pdata:this.pdata, time:this.time};\n\t\treturn JSON.stringify(data);\n\t},\n\tparse : function(str){\n\t\tif(str===(void 0)){ this.id=null; return this;}\n\t\tvar data = JSON.parse(str);\n\t\tfor(var key in data){ this[key]=data[key];}\n\t\tvar pzl = pzpr.parser(this.pdata);\n\t\tthis.pid = pzl.pid;\n\t\tthis.col = pzl.cols;\n\t\tthis.row = pzl.rows;\n\t\treturn this;\n\t}\n};\n\n//---------------------------------------------------------------------------\n// ★Popup_DataBaseクラス データベース用ポップアップメニューの作成を行う\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('database',\n{\n\tformname : 'database',\n\t\n\tshow : function(px,py){\n\t\tui.popupmgr.popups.template.show.call(this,px,py);\n\t\tui.database.openDialog();\n\t},\n\tclose : function(){\n\t\tui.database.closeDialog();\n\t\tui.popupmgr.popups.template.close.call(this);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// database_handler() データベースmanagerへ処理を渡します\n\t//---------------------------------------------------------------------------\n\tdatabase_handler : function(e){\n\t\tui.database.clickHandler(e.target.name);\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★DataBaseManagerクラス Web Storage用 データベースの設定・管理を行う\n//---------------------------------------------------------------------------\nui.database = {\n\tdbh    : null,\t// データベースハンドラ\n\n\tDBsid  : -1,\t// 現在選択されているリスト中のID\n\tDBlist : [],\t// 現在一覧にある問題のリスト\n\n\tsync   : false,\t// 一覧がDataBaseのデータと合っているかどうかを表す\n\n\tupdate : function(){ ui.database.updateDialog();},\n\n//\tstorageType : {},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.openDialog()   データベースダイアログが開いた時の処理\n\t// dbm.closeDialog()  データベースダイアログが閉じた時の処理\n\t//---------------------------------------------------------------------------\n\topenDialog : function(){\n\t\t// データベースを開く\n\t\tthis.dbh = new ui.DataBaseHandler_LS(this);\n\t\tthis.sync = false;\n\t\tthis.dbh.convert();\n\t\tthis.dbh.importDBlist();\n\t},\n\tcloseDialog : function(){\n\t\tthis.DBlist = [];\n\t},\n\n//\t//---------------------------------------------------------------------------\n//\t// dbm.checkStorageType()  使用できるStorageの種類を取得\n//\t//---------------------------------------------------------------------------\n//\tcheckStorageType : function(){\n//\t\tthis.storageType = (function(){\n//\t\t\tvar val = 0x00;\n//\t\t\ttry{ if(!!window.sessionStorage){ val |= 0x10;}}catch(e){}\n//\t\t\ttry{ if(!!window.localStorage)  { val |= 0x08;}}catch(e){}\n//\t\t\ttry{ if(!!window.indexedDB)     { val |= 0x04;}}catch(e){}\n//\t\t\ttry{ if(!!window.openDatabase){ // Opera10.50対策\n//\t\t\t\tvar dbtmp = openDatabase('pzprv3_manage', '1.0', 'manager', 1024*1024*5);\t// Chrome3対策\n//\t\t\t\tif(!!dbtmp){ val |= 0x02;}\n//\t\t\t}}catch(e){}\n//\t\t\t\n//\t\t\t// Firefox 8.0より前はローカルだとデータベース系は使えない\n//\t\t\tvar Gecko = (UA.indexOf('Gecko')>-1 && UA.indexOf('KHTML')===-1);\n//\t\t\tvar Gecko7orOlder = (Gecko && UA.match(/rv\\:(\\d+\\.\\d+)/) && +RegExp.$1<8.0); /* Firefox8.0よりも前 */\n//\t\t\tif(Gecko7orOlder && !location.hostname){ val = 0;}\n//\t\t\t\n//\t\t\treturn {\n//\t\t\t\tsession : !!(val & 0x10),\n//\t\t\t\tlocalST : !!(val & 0x08),\n//\t\t\t\tWebIDB  : !!(val & 0x04),\n//\t\t\t\tWebSQL  : !!(val & 0x02)\n//\t\t\t};\n//\t\t})();\n//\t}\n\n\t//---------------------------------------------------------------------------\n\t// dbm.clickHandler()  フォーム上のボタンが押された時、各関数にジャンプする\n\t//---------------------------------------------------------------------------\n\tclickHandler : function(name){\n\t\tif(this.sync===false){ return;}\n\t\tswitch(name){\n\t\t\tcase 'sorts'   : this.displayDataTableList();\t// breakがないのはわざとです\n\t\t\t/* falls through */\n\t\t\tcase 'datalist': this.selectDataTable(); break;\n\t\t\tcase 'tableup' : this.upDataTable();     break;\n\t\t\tcase 'tabledn' : this.downDataTable();   break;\n\t\t\tcase 'open'    : this.openDataTable();   break;\n\t\t\tcase 'save'    : this.saveDataTable();   break;\n\t\t\tcase 'overwrite' : this.saveDataTable(); break;\n\t\t\tcase 'updateinfo': this.updateInfo();    break;\n\t\t\tcase 'del'     : this.deleteDataTable(); break;\n\t\t}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.getDataID()    選択中データの(this.DBlistのkeyとなる)IDを取得する\n\t// dbm.updateDialog() 管理テーブル情報やダイアログの表示を更新する\n\t//---------------------------------------------------------------------------\n\tgetDataID : function(){\n\t\t/* jshint eqeqeq:false */\n\t\tvar val = document.database.datalist.value;\n\t\tif(val!==\"new\" && val!==\"\"){\n\t\t\tfor(var i=0;i<this.DBlist.length;i++){\n\t\t\t\tif(this.DBlist[i].id==val){ return i;}\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t},\n\tupdateDialog : function(){\n\t\tthis.dbh.updateManageData();\n\t\tthis.displayDataTableList();\n\t\tthis.selectDataTable();\n\t\tthis.sync = true;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.displayDataTableList() 保存しているデータの一覧を表示する\n\t// dbm.appendNewOption()      option要素を生成する\n\t// dbm.getRowString()         1データから文字列を生成する\n\t// dbm.dateString()           時刻の文字列を生成する\n\t//---------------------------------------------------------------------------\n\tdisplayDataTableList : function(){\n\t\tswitch(document.database.sorts.value){\n\t\t\tcase 'idlist' : this.DBlist = this.DBlist.sort(function(a,b){ return (a.id-b.id);}); break;\n\t\t\tcase 'newsave': this.DBlist = this.DBlist.sort(function(a,b){ return (b.time-a.time || a.id-b.id);}); break;\n\t\t\tcase 'oldsave': this.DBlist = this.DBlist.sort(function(a,b){ return (a.time-b.time || a.id-b.id);}); break;\n\t\t\tcase 'size'   : this.DBlist = this.DBlist.sort(function(a,b){ return (a.col-b.col || a.row-b.row || a.id-b.id);}); break;\n\t\t}\n\n\t\tdocument.database.datalist.innerHTML = \"\";\n\t\tfor(var i=0;i<this.DBlist.length;i++){\n\t\t\tvar row = this.DBlist[i];\n\t\t\tif(!!row){ this.appendNewOption(row.id, this.getRowString(row));}\n\t\t}\n\t\tthis.appendNewOption(-1, ui.selectStr(\"&nbsp;&lt;新しく保存する&gt;\",\"&nbsp;&lt;New Save&gt;\"));\n\t},\n\tappendNewOption : function(id, str){\n\t\t/* jshint eqeqeq:false */\n\t\tvar opt = createEL('option');\n\t\topt.setAttribute('value', (id!=-1 ? id : \"new\"));\n\t\topt.innerHTML = str;\n\t\tif(this.DBsid==id){ opt.setAttribute('selected', \"selected\");}\n\n\t\tdocument.database.datalist.appendChild(opt);\n\t},\n\tgetRowString : function(row){\n\t\tvar str = \"\";\n\t\tstr += ((row.id<10?\"&nbsp;\":\"\")+row.id+\" :&nbsp;\");\n\t\tstr += (pzpr.variety(row.pid)[pzpr.lang]+\"&nbsp;\");\n\t\tstr += (\"\"+row.col+\"×\"+row.row+\" &nbsp;\");\n\t\tstr += (pzpr.parser(row.pdata).metadata.hard+\"&nbsp;\");\n\t\tstr += (\"(\"+this.dateString(row.time*1000)+\")\");\n\t\treturn str;\n\t},\n\tdateString : function(time){\n\t\tfunction ni(num){ return (num<10?\"0\":\"\")+num;}\n\t\tvar date = new Date();\n\t\tdate.setTime(time);\n\t\treturn (ni(date.getFullYear()%100)+\"/\"+ni(date.getMonth()+1)+\"/\"+ni(date.getDate())+ \" \" +\n\t\t\t\tni(date.getHours()) + \":\" + ni(date.getMinutes()));\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.selectDataTable() データを選択して、コメントなどを表示する\n\t//---------------------------------------------------------------------------\n\tselectDataTable : function(){\n\t\tvar selected = this.getDataID(), form = document.database, item, metadata;\n\t\tif(selected>=0){\n\t\t\titem = this.DBlist[selected];\n\t\t\tmetadata = pzpr.parser(item.pdata).metadata;\n\t\t\tgetEL(\"database_cand\").innerHTML = \"\";\n\t\t}\n\t\telse{\n\t\t\titem = new ui.ProblemData();\n\t\t\titem.updatePuzzleData(-1);\n\t\t\tmetadata = ui.puzzle.metadata;\n\t\t\tgetEL(\"database_cand\").innerHTML = ui.selectStr(\"(新規保存)\", \"(Candidate)\");\n\t\t}\n\t\tform.comtext.value = \"\"+metadata.comment;\n\t\tform.hard.value    = \"\"+metadata.hard;\n\t\tform.author.value  = \"\"+metadata.author;\n\t\tform.source.value  = \"\"+metadata.source;\n\t\tgetEL(\"database_info\").innerHTML = pzpr.variety(item.pid)[pzpr.lang] + \"&nbsp;\" + item.col+\"×\"+item.row +\n\t\t\t\t\t\t\t\t\t\t   \"&nbsp;&nbsp;&nbsp;(\" + this.dateString(item.time*1000) + \")\";\n\n\t\tvar sid = this.DBsid = +item.id; /* selected id */\n\t\tvar sortbyid = (form.sorts.value==='idlist');\n\t\tform.tableup.disabled = (!sortbyid || sid===-1 || sid===1);\n\t\tform.tabledn.disabled = (!sortbyid || sid===-1 || sid===this.DBlist.length);\n\t\tform.updateinfo.disabled = (sid===-1);\n\t\tform.open.style.color = (sid===-1 ? \"silver\" : \"\");\n\t\tform.del.style.color  = (sid===-1 ? \"silver\" : \"\");\n\t\tform.save.style.display      = (sid===-1 ? \"\" : \"none\");\n\t\tform.overwrite.style.display = (sid===-1 ? \"none\" : \"\");\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.upDataTable()      データの一覧での位置をひとつ上にする\n\t// dbm.downDataTable()    データの一覧での位置をひとつ下にする\n\t// dbm.convertDataTable() データの一覧での位置を入れ替える\n\t//---------------------------------------------------------------------------\n\tupDataTable : function(){\n\t\tvar selected = this.getDataID();\n\t\tif(selected===-1 || selected===0){ return;}\n\t\tthis.convertDataTable(selected, selected-1);\n\t},\n\tdownDataTable : function(){\n\t\tvar selected = this.getDataID();\n\t\tif(selected===-1 || selected===this.DBlist.length-1){ return;}\n\t\tthis.convertDataTable(selected, selected+1);\n\t},\n\tconvertDataTable : function(sid, tid){\n\t\tthis.DBsid = this.DBlist[tid].id;\n\n\t\t/* idプロパティ以外を入れ替える */\n\t\tvar id = this.DBlist[sid].id;\n\t\tthis.DBlist[sid].id = this.DBlist[tid].id;\n\t\tthis.DBlist[tid].id = id;\n\t\tvar row = this.DBlist[sid];\n\t\tthis.DBlist[sid] = this.DBlist[tid];\n\t\tthis.DBlist[tid] = row;\n\n\t\tthis.sync = false;\n\t\tthis.dbh.saveItem(sid, tid);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.openDataTable()  データの盤面に読み込む\n\t// dbm.saveDataTable()  データの盤面を保存/上書きする\n\t//---------------------------------------------------------------------------\n\topenDataTable : function(){\n\t\tvar id = this.getDataID(); if(id===-1){ return;}\n\t\tvar filestr = this.DBlist[id].getFileData();\n\t\tui.notify.confirm(\"このデータを読み込みますか？ (現在の盤面は破棄されます)\",\n\t\t\t\t\t\t  \"Recover selected data? (Current board is erased)\",\n\t\t\t\t\t\t  function(){ ui.puzzle.open(filestr);});\n\t},\n\tsaveDataTable : function(){\n\t\tvar id = this.getDataID(), dbm = this;\n\t\tfunction refresh(){\n\t\t\tvar list = dbm.DBlist, item = list[id];\n\t\t\tif(id===-1){ /* newSave */\n\t\t\t\tid = list.length;\n\t\t\t\titem = list[id] = new ui.ProblemData();\n\t\t\t}\n\t\t\titem.updatePuzzleData(id+1);\n\t\t\tvar metadata = item.updateMetaData();\n\t\t\tui.puzzle.metadata.update(metadata);\n\t\t\tdbm.DBsid = item.id;\n\t\t\t\n\t\t\tdbm.sync = false;\n\t\t\tdbm.dbh.saveItem(id);\n\t\t}\n\t\t\n\t\tif(id===-1){ refresh();}\n\t\telse       { ui.notify.confirm(\"このデータに上書きしますか？\",\"Overwrite selected data?\", refresh);}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.editComment()   データのコメントを更新する\n\t//---------------------------------------------------------------------------\n\tupdateInfo : function(){\n\t\tvar id = this.getDataID(); if(id===-1){ return;}\n\n\t\tthis.DBlist[id].updateMetaData();\n\n\t\tthis.sync = false;\n\t\tthis.dbh.saveItem(id);\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.deleteDataTable() 選択している盤面データを削除する\n\t//---------------------------------------------------------------------------\n\tdeleteDataTable : function(){\n\t\tvar id = this.getDataID(), dbm = this; if(id===-1){ return;}\n\t\tui.notify.confirm(\"このデータを完全に削除しますか？\",\"Delete selected data?\", function(){\n\t\t\tvar list = dbm.DBlist, sID = list[id].id, max = list.length;\n\t\t\tfor(var i=sID-1;i<max-1;i++){ list[i] = list[i+1]; list[i].id--;}\n\t\t\tlist.pop();\n\n\t\t\tdbm.sync = false;\n\t\t\tdbm.dbh.deleteItem(sID, max);\n\t\t});\n\t}\n};\n\n//---------------------------------------------------------------------------\n// ★DataBaseHandler_LSクラス Web localStorage用 データベースハンドラ\n//---------------------------------------------------------------------------\nui.DataBaseHandler_LS = function(parent){\n\tthis.pheader = 'pzprv3_storage:data:';\n\tthis.parent = parent;\n\tthis.currentVersion = localStorage['pzprv3_storage:version'] || '0';\n\n\tthis.createManageDataTable();\n\tthis.createDataBase();\n};\nui.DataBaseHandler_LS.prototype =\n{\n\t//---------------------------------------------------------------------------\n\t// dbm.dbh.importDBlist()  DataBaseからDBlistを作成する\n\t//---------------------------------------------------------------------------\n\timportDBlist : function(){\n\t\tthis.parent.DBlist = [];\n\t\tfor(var i=1;true;i++){\n\t\t\tvar row = new ui.ProblemData(localStorage[this.pheader+i]);\n\t\t\tif(row.id===null){ break;}\n\t\t\tthis.parent.DBlist.push(row);\n\t\t}\n\t\tthis.parent.update();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.dbh.createManageDataTable() 管理情報テーブルを作成する(消去はなし)\n\t// dbm.dbh.updateManageData()      管理情報レコードを更新する\n\t//---------------------------------------------------------------------------\n\tcreateManageDataTable : function(){\n\t\tlocalStorage['pzprv3_storage:version'] = '3.0';\n\t},\n\tupdateManageData : function(){\n\t\tlocalStorage['pzprv3_storage:count'] = this.parent.DBlist.length;\n\t\tlocalStorage['pzprv3_storage:time']  = (pzpr.util.currentTime()/1000)|0;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.dbh.createDataBase()     テーブルを作成する\n\t//---------------------------------------------------------------------------\n\tcreateDataBase : function(){\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.dbh.saveItem() databaseの指定されたIDを保存する\n\t//---------------------------------------------------------------------------\n\tsaveItem : function(){\n\t\tvar args = arguments;\n\t\tfor(var i=0;i<args.length;i++){\n\t\t\tvar item = this.parent.DBlist[args[i]];\n\t\t\tlocalStorage[this.pheader+item.id] = item.toString();\n\t\t}\n\t\tthis.parent.update();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.dbh.deleteItem() 選択している盤面データを削除する\n\t//---------------------------------------------------------------------------\n\tdeleteItem : function(sID, max){\n\t\tfor(var i=+sID;i<max;i++){\n\t\t\tvar data = new ui.ProblemData(localStorage[this.pheader+(i+1)]);\n\t\t\tdata.id--;\n\t\t\tlocalStorage[this.pheader+i] = data.toString();\n\t\t}\n\t\tlocalStorage.removeItem(this.pheader+max);\n\t\tthis.parent.update();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// dbm.dbh.convert() データ形式をコンバート\n\t//---------------------------------------------------------------------------\n\tconvert : function(){\n\t\tif(!!localStorage['pzprv3_manage']) { this.convertfrom1();}\n\t\telse if(this.currentVersion==='2.0'){ this.convertfrom2();}\n\t\tthis.currentVersion = '3.0';\n\t},\n\thardstr : [\n\t\t{ja:'−'      , en:'-'     },\n\t\t{ja:'らくらく', en:'Easy'  },\n\t\t{ja:'おてごろ', en:'Normal'},\n\t\t{ja:'たいへん', en:'Hard'  },\n\t\t{ja:'アゼン'  , en:'Expert'}\n\t],\n\tconvertfrom2 : function(){\n\t\t/* jshint eqeqeq:false */\n\t\tfor(var i=1;true;i++){\n\t\t\tvar item = new ui.ProblemData(localStorage[this.pheader+i]);\n\t\t\tif(item.id===null){ break;}\n\t\t\tvar pzl = pzpr.parser(item.pdata);\n\t\t\tif(item.hard!='0'){ pzl.metadata.hard    = this.hardstr[item.hard][pzpr.lang];}\n\t\t\tif(!!item.comment){ pzl.metadata.comment = item.comment;}\n\t\t\titem.pdata = pzl.generate();\n\t\t\tlocalStorage[this.pheader+i] = item.toString();\n\t\t}\n\t},\n\tconvertfrom1 : function(){\n\t\tvar keys=['id', 'col', 'row', 'hard', 'pdata', 'time', 'comment'];\n\n\t\tvar timemax=0, countall=0;\n\t\tdelete localStorage['pzprv3_manage'];\n\t\tdelete localStorage['pzprv3_manage:manage'];\n\n\t\tvar puzzles = [];\n\t\tfor(var pid in pzpr.variety.info){ // いらないのもあるけど、問題ないのでOK\n\t\t\tif(!localStorage['pzprv3_'+pid]){ continue;}\n\t\t\tvar mheader = 'pzprv3_manage:manage!'+pid+'!';\n\t\t\tvar count = localStorage[mheader+'count'];\n\t\t\tvar ptime = localStorage[mheader+'time'];\n\t\t\tdelete localStorage[mheader+'count'];\n\t\t\tdelete localStorage[mheader+'time'];\n\n\t\t\tif(ptime > timemax){ ptime = timemax;}\n\t\t\tcountall += count;\n\n\t\t\tdelete localStorage['pzprv3_'+pid];\n\t\t\tdelete localStorage['pzprv3_'+pid+':puzdata'];\n\t\t\tfor(var i=0;i<count;i++){\n\t\t\t\tvar pheader = 'pzprv3_'+pid+':puzdata!'+(i+1)+'!';\n\t\t\t\tvar row = new ui.ProblemData();\n\t\t\t\tfor(var c=0;c<7;c++){\n\t\t\t\t\trow[keys[c]] = localStorage[pheader+keys[c]];\n\t\t\t\t\tdelete localStorage[pheader+keys[c]];\n\t\t\t\t}\n\t\t\t\tvar pzl = pzpr.parser(row.pdata);\n\t\t\t\tpzl.metadata.hard    = this.hardstr[row.hard][pzpr.lang];\n\t\t\t\tpzl.metadata.comment = row.comment;\n\t\t\t\trow.pdata = pzl.generate();\n\t\t\t\tdelete row.hard;\n\t\t\t\tdelete row.comment;\n\t\t\t\tdelete row.col;\n\t\t\t\tdelete row.row;\n\t\t\t\tpuzzles.push(row);\n\t\t\t}\n\t\t}\n\n\t\tpuzzles.sort(function(a,b){ return (a.time-b.time || a.id-b.id);});\n\t\tlocalStorage['pzprv3_storage:version'] = '3.0';\n\t\tlocalStorage['pzprv3_storage:count'] = puzzles.length;\n\t\tlocalStorage['pzprv3_storage:time']  = (pzpr.util.currentTime()/1000)|0;\n\t\tfor(var i=0;i<puzzles.length;i++){\n\t\t\tpuzzles[i].id = (i+1);\n\t\t\tlocalStorage['pzprv3_storage:data:'+(i+1)] = puzzles[i].toString();\n\t\t}\n\t}\n};\n","// Timer.js v3.4.0\n/* global ui:false */\n\n(function(){\n\n//---------------------------------------------------------------------------\n// ★Timerクラス  一般タイマー(経過時間の表示/自動正答判定用)\n//---------------------------------------------------------------------------\nvar timerInterval = 100;\t\t\t\t\t/* タイマー割り込み間隔 */\n\nui.timer =\n{\n\t/* メンバ変数 */\n\tTID      : null,\t\t\t\t\t/* タイマーID */\n\tcurrent  : 0,\t\t/* 現在のgetTime()取得値(ミリ秒) */\n\n\t/* 経過時間表示用変数 */\n\tbseconds : 0,\t\t/* 前回ラベルに表示した時間(秒数) */\n\ttimerEL  : null,\t/* 経過時間表示用要素 */\n\n\t/* 自動正答判定用変数 */\n\tworstACtime : 0,\t/* 正答判定にかかった時間の最悪値(ミリ秒) */\n\tnextACtime  : 0,\t/* 次に自動正答判定ルーチンに入ることが可能になる時間 */\n\n\t//---------------------------------------------------------------------------\n\t// tm.reset()      タイマーのカウントを0にして、スタートする\n\t// tm.start()      update()関数を200ms間隔で呼び出す\n\t// tm.update()     200ms単位で呼び出される関数\n\t//---------------------------------------------------------------------------\n\treset : function(){\n\t\tthis.worstACtime = 0;\n\t\tthis.timerEL = document.getElementById('timerpanel');\n\t\tthis.timerEL.innerHTML = this.label()+\"00:00\";\n\n\t\tclearInterval(this.TID);\n\t\tthis.start();\n\t},\n\tstart : function(){\n\t\tvar self = this;\n\t\tthis.TID = setInterval(function(){ self.update();}, timerInterval);\n\t},\n\tstop : function(){\n\t\tclearInterval(this.TID);\n\t},\n\tupdate : function(){\n\t\tthis.current = pzpr.util.currentTime();\n\n\t\tif(ui.puzzle.playeronly){ this.updatetime();}\n\t\tif(ui.menuconfig.get('autocheck_once') && !ui.debug.alltimer){ this.ACcheck();}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// tm.updatetime() 秒数の表示を行う\n\t// tm.label()      経過時間に表示する文字列を返す\n\t//---------------------------------------------------------------------------\n\tupdatetime : function(){\n\t\tvar seconds = (ui.puzzle.getTime()/1000)|0;\n\t\tif(this.bseconds === seconds){ return;}\n\n\t\tvar hours   = (seconds/3600)|0;\n\t\tvar minutes = ((seconds/60)|0) - hours*60;\n\t\tseconds = seconds - minutes*60 - hours*3600;\n\n\t\tif(minutes < 10){ minutes = \"0\" + minutes;}\n\t\tif(seconds < 10){ seconds = \"0\" + seconds;}\n\n\t\tthis.timerEL.innerHTML = [this.label(), (!!hours?hours+\":\":\"\"), minutes, \":\", seconds].join('');\n\n\t\tthis.bseconds = seconds;\n\t},\n\tlabel : function(){\n\t\treturn ui.selectStr(\"経過時間：\",\"Time: \");\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// tm.ACcheck()    自動正解判定を呼び出す\n\t//---------------------------------------------------------------------------\n\tACcheck : function(){\n\t\tvar puzzle = ui.puzzle;\n\t\tif(this.current>this.nextACtime && puzzle.playmode && !puzzle.checker.inCheck && puzzle.board.trialstage===0){\n\t\t\tvar check = puzzle.check(false);\n\t\t\tif(check.complete){\n\t\t\t\tui.timer.stop();\n\t\t\t\tpuzzle.mouse.mousereset();\n\t\t\t\tui.menuconfig.set('autocheck_once',false);\n\t\t\t\tif(ui.callbackComplete){\n\t\t\t\t\tui.callbackComplete(puzzle, check);\n\t\t\t\t}\n\t\t\t\tui.notify.alert(\"正解です！\",\"Complete!\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.worstACtime = Math.max(this.worstACtime, (pzpr.util.currentTime()-this.current));\n\t\t\tthis.nextACtime = this.current + (this.worstACtime<250 ? this.worstACtime*4+120 : this.worstACtime*2+620);\n\t\t}\n\t}\n};\n\n//---------------------------------------------------------------------------\n// ★UndoTimerクラス   Undo/Redo用タイマー\n//---------------------------------------------------------------------------\nvar KeyUndo = 1,\n\tButtonUndo = 2,\n\tAnswerUndo = 4,\n\tundoTimerInterval = 25,\t\t/* タイマー割り込み間隔 */\n\texecWaitTime      = 300;\t/* 1回目にwaitを多く入れるための値 */\n\nui.undotimer = {\n\t/* メンバ変数 */\n\tTID    : null,\t/* タイマーID */\n\t\n\t/* bit1:button bit0:key */\n\tinUNDO : 0,\t/* Undo実行中 */\n\tinREDO : 0,\t/* Redo実行中 */\n\n\t//---------------------------------------------------------------------------\n\t// ut.reset()  タイマーをスタートする\n\t//---------------------------------------------------------------------------\n\treset : function(){\n\t\tthis.stop();\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// ut.startKeyUndo() キー入力によるUndoを開始する\n\t// ut.startKeyRedo() キー入力によるRedoを開始する\n\t// ut.startButtonUndo() ボタンによるUndoを開始する\n\t// ut.startButtonRedo() ボタンによるRedoを開始する\n\t// ut.startAnswerUndo() 碁石ひろい用のマウスによるUndoを開始する\n\t// ut.startAnswerRedo() 碁石ひろい用のマウスによるRedoを開始する\n\t//---------------------------------------------------------------------------\n\tstartKeyUndo    : function(){ this.startUndo(KeyUndo);},\n\tstartKeyRedo    : function(){ this.startRedo(KeyUndo);},\n\tstartButtonUndo : function(){ this.startUndo(ButtonUndo);},\n\tstartButtonRedo : function(){ this.startRedo(ButtonUndo);},\n\tstartAnswerUndo : function(){ this.startUndo(AnswerUndo);},\n\tstartAnswerRedo : function(){ this.startRedo(AnswerUndo);},\n\n\t//---------------------------------------------------------------------------\n\t// ut.stopKeyUndo() キー入力によるUndoを停止する\n\t// ut.stopKeyRedo() キー入力によるRedoを停止する\n\t// ut.stopButtonUndo() ボタンによるUndoを停止する\n\t// ut.stopButtonRedo() ボタンによるRedoを停止する\n\t// ut.startAnswerUndo() 碁石ひろい用のマウスによるUndoを停止する\n\t// ut.startAnswerRedo() 碁石ひろい用のマウスによるRedoを停止する\n\t//---------------------------------------------------------------------------\n\tstopKeyUndo    : function(){ this.stopUndo(KeyUndo);},\n\tstopKeyRedo    : function(){ this.stopRedo(KeyUndo);},\n\tstopButtonUndo : function(){ this.stopUndo(ButtonUndo);},\n\tstopButtonRedo : function(){ this.stopRedo(ButtonUndo);},\n\t/* stopAnswerUndo : function(){ this.stopUndo(AnswerUndo);}, */\n\t/* stopAnswerRedo : function(){ this.stopRedo(AnswerUndo);}, */\n\n\t//---------------------------------------------------------------------------\n\t// ut.startUndo() Undo開始共通処理\n\t// ut.startRedo() Redo開始共通処理\n\t// ut.stopUndo() Undo停止共通処理\n\t// ut.stopRedo() Redo停止共通処理\n\t//---------------------------------------------------------------------------\n\tstartUndo : function(bit){ if(!(this.inUNDO & bit)){ this.inUNDO |=  bit; this.proc();}},\n\tstartRedo : function(bit){ if(!(this.inREDO & bit)){ this.inREDO |=  bit; this.proc();}},\n\tstopUndo  : function(bit){ if(  this.inUNDO & bit ){ this.inUNDO &= ~bit; this.proc();}},\n\tstopRedo  : function(bit){ if(  this.inREDO & bit ){ this.inREDO &= ~bit; this.proc();}},\n\n\t//---------------------------------------------------------------------------\n\t// ut.start() Undo/Redo呼び出しを開始する\n\t// ut.stop()  Undo/Redo呼び出しを終了する\n\t//---------------------------------------------------------------------------\n\tstart : function(){\n\t\tvar self = this;\n\t\tfunction handler(){ self.proc();}\n\t\tfunction inithandler(){\n\t\t\tclearInterval(self.TID);\n\t\t\tself.TID = setInterval(handler, undoTimerInterval);\n\t\t}\n\t\tthis.TID = setInterval(inithandler, execWaitTime);\n\t\tthis.exec();\n\t},\n\tstop : function(){\n\t\tthis.inUNDO = 0;\n\t\tthis.inREDO = 0;\n\t\t\n\t\tclearInterval(this.TID);\n\t\tthis.TID = null;\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// ut.proc()  Undo/Redo呼び出しを実行する\n\t// ut.exec()  Undo/Redo関数を呼び出す\n\t//---------------------------------------------------------------------------\n\tproc : function(){\n\t\tif     (!!(this.inUNDO | this.inREDO) &&  !this.TID){ this.start();}\n\t\telse if( !(this.inUNDO | this.inREDO) && !!this.TID){ this.stop();}\n\t\telse if(!!this.TID){ this.exec();}\n\t},\n\texec : function(){\n\t\tif(!this.checknextprop()){ this.stop();}\n\t\telse if(this.inUNDO){ ui.puzzle.undo();}\n\t\telse if(this.inREDO){ ui.puzzle.redo();}\n\t},\n\n\t//---------------------------------------------------------------------------\n\t// ut.checknextprop()  次にUndo/Redoができるかどうかの判定を行う\n\t//---------------------------------------------------------------------------\n\tchecknextprop : function(){\n\t\tvar opemgr = ui.puzzle.opemgr;\n\t\tvar isenable = ((this.inUNDO && opemgr.enableUndo) || (this.inREDO && opemgr.enableRedo));\n\t\tif(isenable && ui.puzzle.pid===\"goishi\"){\n\t\t\tif(this.inUNDO===AnswerUndo){\n\t\t\t\tvar nextopes = opemgr.ope[opemgr.position-1];\n\t\t\t\tisenable = (nextopes[nextopes.length-1].property==='anum');\n\t\t\t}\n\t\t\telse if(this.inREDO===AnswerUndo){\n\t\t\t\tvar nextopes = opemgr.ope[opemgr.position];\n\t\t\t\tisenable = (nextopes[0].property==='anum');\n\t\t\t}\n\t\t}\n\t\treturn isenable;\n\t}\n};\n\n})();\n","// Debug.js v3.4.0\n/* jshint devel:true */\n/* global ui:false */\n\n//---------------------------------------------------------------------------\n// ★Popup_Debugクラス  poptest関連のポップアップメニュー表示用\n//---------------------------------------------------------------------------\nui.popupmgr.addpopup('debug',\n{\n\tformname : 'debug',\n\tmultipopup : true,\n\t\n\tinit : function(){\n\t\tui.popupmgr.popups.template.init.call(this);\n\t\tif(!ui.debugmode){\n\t\t\tvar form = this.form;\n\t\t\tform.starttest.style.display = \"none\";\n\t\t\tform.all_test.style.display = \"none\";\n\t\t\tform.loadperf.style.display = \"none\";\n\t\t\tform.inputcheck_popup.style.display = \"none\";\n\t\t}\n\t},\n\thandler : function(e){\n\t\tui.debug[e.target.name]();\n\t},\n\t\n\tshow : function(px,py){\n\t\tui.popupmgr.popups.template.show.call(this,40,80);\n\t}\n});\n\n//---------------------------------------------------------------------------\n// ★Debugクラス  poptest関連の実行関数など\n//---------------------------------------------------------------------------\nui.debug =\n{\n\textend : function(proto){\n\t\tfor(var name in proto){ this[name] = proto[name];}\n\t},\n\n\t// debugmode===true時はオーバーライドされます\n\tkeydown : function(ca){\n\t\tif(ca==='alt+p'){ this.disppoptest();}\n\t\telse{ return false;}\n\t\t\n\t\tui.puzzle.key.cancelEvent = true;\t/* カーソルを移動させない */\n\t},\n\tdisppoptest : function(){\n\t\tui.popupmgr.popups.debug.show();\n\t},\n\n\tfilesave : function(){\n\t\tthis.setTA(ui.puzzle.getFileData(pzpr.parser.FILE_PZPR, {history:true}));\n\t},\n\tfilesave_pencilbox : function(){\n\t\tif(pzpr.variety(ui.puzzle.pid).exists.pencilbox){\n\t\t\tthis.setTA(ui.puzzle.getFileData(pzpr.parser.FILE_PBOX));\n\t\t}\n\t\telse{\n\t\t\tthis.setTA(\"\");\n\t\t}\n\t},\n\tfilesave_pencilbox_xml : function(){\n\t\tif(pzpr.variety(ui.puzzle.pid).exists.pencilbox){\n\t\t\tthis.setTA(ui.puzzle.getFileData(pzpr.parser.FILE_PBOX_XML).replace(/\\>/g,'>\\n'));\n\t\t}\n\t\telse{\n\t\t\tthis.setTA(\"\");\n\t\t}\n\t},\n\n\tfileopen : function(){\n\t\tui.puzzle.open(this.getTA());\n\t},\n\n\terasetext : function(){\n\t\tthis.setTA('');\n\t},\n\n\tperfeval : function(){\n\t\tvar ans = ui.puzzle.checker;\n\t\tthis.timeeval(\"正答判定\", function(){ ans.resetCache(); ans.checkAns();});\n\t},\n\tpainteval : function(){\n\t\tthis.timeeval(\"描画時間\", function(){ ui.puzzle.redraw();});\n\t},\n\tresizeeval : function(){\n\t\tthis.timeeval(\"resize描画\", function(){ ui.puzzle.redraw(true);});\n\t},\n\tsearcheval : function(){\n\t\tvar graph = ui.puzzle.board.linegraph;\n\t\tgraph.rebuild();\n\t\tvar nodes = [];\n\t\tfor(var i=0;i<graph.components.length;i++){\n\t\t\tnodes = nodes.concat(graph.components[i].nodes);\n\t\t}\n\t\tthis.timeeval(\"search linemgr\", function(){\n\t\t\tgraph.components = [];\n\t\t\tgraph.modifyNodes = nodes;\n\t\t\tgraph.searchGraph();\n\t\t});\n\t},\n\trebuildeval : function(){\n\t\tvar graph = ui.puzzle.board.linegraph;\n\t\tthis.timeeval(\"reset linemgr\", function(){ graph.rebuild();});\n\t},\n\ttimeeval : function(text,func){\n\t\tvar count=0, old = pzpr.util.currentTime();\n\t\twhile(pzpr.util.currentTime() - old < 3000){\n\t\t\tcount++;\n\n\t\t\tfunc();\n\t\t}\n\t\tvar time = pzpr.util.currentTime() - old;\n\t\tthis.addTA(text+\" ave. \"+(time/count)+\"ms\");\n\t},\n\n\tdispdatabase : function(){\n\t\tvar text = \"\";\n\t\tfor(var i=0;i<localStorage.length;i++){\n\t\t\tvar key = localStorage.key(i);\n\t\t\tif(key.match(/^pzprv3/)){\n\t\t\t\ttext += (\"\"+key+\" \"+localStorage[key]+\"\\n\");\n\t\t\t}\n\t\t}\n\t\tthis.setTA(text);\n\t},\n\n\tgetTA : function(){ return document.getElementById('testarea').value;},\n\tsetTA : function(str){ document.getElementById('testarea').value  = str;},\n\taddTA : function(str){\n\t\tif(!!window.console){ console.log(str);}\n\t\tdocument.getElementById('testarea').value += (str+\"\\n\");\n\t},\n\n\tincludeDebugScript : function(filename){\n\t\tif(!!this.includedScript[filename]){ return;}\n\t\tvar _script = document.createElement('script');\n\t\t_script.type = 'text/javascript';\n\t\t_script.src = pzpr.util.getpath()+'../../tests/script/'+filename;\n\t\tdocument.getElementsByTagName('head')[0].appendChild(_script);\n\t\tthis.includedScript[filename] = true;\n\t},\n\tincludedScript : {}\n};\n"]}