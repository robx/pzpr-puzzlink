/*! @license pzprv3-ui.js v0.0.1 (c) 2009-2019 robx, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */

!function(){function a(a){return d.getElementById(a)}function b(a){return d.createElement(a)}function c(a){var b={aho:["ICAgKCgoC","I4Qdp3vJDxwMtNorV85sQ6RwWhhiZPNF57Q+3udgcjWmLVMAADs="],amibo:["P/AwP///y","HoRjqQvI36AKtNrrolx5Hz+BXjeKX4KlVWmSmyt1BQA7"],ayeheya:["P/ow////y","F4SPGJEN66KctNoGaZ5b9guGIsdoZVUAADs="],bag:["P+vg///wC","JYRjl4DbmlqYtNr3mFs67g+FYiZd5uSlYjdyJNim56mytv3CeQEAOw=="],barns:["MDAwID//y","JQyCqZa369hTDtg7cYxT+r51zUVyWSMiYbqKJZl65tOCqDHjZQEAOw=="],bdblock:["Dn/pP///y","IoyPqQHb+lJE81RzmdsMeI994EKWJsVJKQqtlouFovydSgEAOw=="],bonsan:["P//wMD/wC","JoSPicGqcWCSgBpbJWa81zlR4hNizomeHMh+1wZ2MtssrTmmmVQAADs="],box:["ICAgKCgoC","IgyOCaadxpyKEkHqKH5tLxmEondg5MeBU2WyKziGakfPRwEAOw=="],cbblock:["P/QQf///y","H4wDp3vJj+BzUlEIst784rp4lSiRH9igKdNpk2qYRwEAOw=="],chocona:["P/AwP///y","IIyPGcDtD1BUM1WpVr6HG69R2yiWFnmamNqh0Ntk8iwXADs="],cojun:["MD//////y","I4wfgMvKD+Jrcp6IrcF18ux9DiWOSNldaJqspgu28AZndVYAADs="],country:["P/Gif///y","IISPGZFtDKB7SDZL78RYna6BjhhO1WdG3siubWZC5FkAADs="],creek:["AD//8H+/y","JIQfGces2tyD8RkrU16XboBVExd1YTmSjXWa5NlirTsjU/k1BQA7"],factors:["AD//////y","IISPqcsWHxp4iKq4cGXayd5dWwN+SXigqHeBawpJ8pwUADs="],fillmat:["P//wLP/gS","JoSDAam2yh6SM9pbE4UaT3d0HrWRmDOiXMZ+oLfG5cjIMAnOIlsAADs="],fillomino:["ODg4P///y","I4QPgcvKn4KU0DhbE7qP3wl608FtDVRq3bkuYZillYxmLlQAADs="],firefly:["ID/gP//wC","JISDpqvRzNySME2EMaAHzuddXEiWlVVSYxRl7riCsqeaG2orBQA7"],fivecells:["MD/wP///y","IwyOmWbqDaCLCgY7T5NT8vV02fdpYpVRSAmqZ4S145rS7FMAADs="],fourcells:["MD/wP///y","JoSPELeZrdxjoUJbmTYQ3T1xoEdh1gh+jhqtaZlxGOqK0nvL5o4VADs="],goishi:["P/zwf///y","JoSPiRHK2UA0cU5JVz5V79stFzUq5oly5eOBG8a9sAu/4QetZXoUADs="],gokigen:["OD/g////y","HYQPgafbvlKUMD42r9HbZg9W4oh9IdmZaLpSLZcUADs="],hakoiri:["MD//////y","KISPicEa+UyUYE5KLcSVY81FVyc1JYMq6oKm6zgu2zur8Eoesd6aSgEAOw=="],hanare:["AD//////y","FYSPqcvtDyMMdNLqLm46WC+F4kgmBQA7"],hashikake:["P///8DAwC","JoQflse829qLMlhLVYQuw8s5F+JtpTJSIKm2UgaAGBxrdI3TU1MAADs="],hebi:["ID/gMD/wC","FISPqcvtD1WYtM6Is96825pcHVQAADs="],herugolf:["MD//+H//y","I4SPiRHqwJ6KcrV6KIbXdqNlITeNo3Q+zMo67Ou+ayx/G1IAADs="],heyabon:["P//wMD/wC","LYyPacDtH9p5LgJ7IYt4V559Clh9Idad0kJ57caimmex7nqNUN2lti8JvSaAAgA7"],heyawake:["MD/wP///y","F4SPGJEN66KctNoGaZ5b9guGIsdoZVUAADs="],hitori:["P//QP///y","H4SPFhvpwNpDcVJ2lz11Q+x1HgduonVOZ/qwjpvASAEAOw=="],icebarn:["EH9/////y","F4SPqcvt3wJEcpp6g95cW/yAjmiV5nkWADs="],icelom:["EH9/////y","GYSPqcvdAYOblMl1UU7b9PN9XkWSkVimaQEAOw=="],icelom2:["H///////y","G4SPqcvNEQxsMVX71MWue7SBWjZyywSg38o2BQA7"],ichimaga:["ODg4P///y","IIyPGcDtfZ4EUdmLzWRxQ+1kovh0HgVO42qhy+nCHBsUADs="],ichimagam:["ODg4P///y","F4yPGcDtD6NTtFojs3639w1m3kiW5lUAADs="],ichimagax:["ODg4P///y","HkSOicDtDyNUtNHKltzcXXsloNKVm2aEqHqYbsQuBQA7"],juosan:["Pjzu9/bqC","H4SPEMm43R5MUoWLZZ1mcz+BIDRGHHU6ToYdJfOiZwEAOw=="],kaero:["P/A/////y","KIyPecDtbUB4dE5JIbtSxa1VISaC5sOlmXo6LImOnCt77BxjuPhlbgEAOw=="],kazunori:["KD/wND/4C","IwyOqaaN7BqMKdiL86xU9vVx4bEtFklBRglcj4a1T0qe9AgUADs="],kakuro:["ICAgP///y","F4SPqcut4V5McJ5qAbZ79vg5YTNmZlYAADs="],kakuru:["MD/wP///y","HYSPqcut4QA8c1Vq2ZWu7vxpERYmXmeKz6oaJVUAADs="],kinkonkan:["P//gP///y","JoSDAanmrKBbsDaL7ctoUuwdjBhSWxdyHod+bObCZyetiVuOo1MAADs="],kouchoku:["ODg4P///y","IIwDp3vJbxxccqraMKK6xX4BYDh+0SRSTLparevBsVwVADs="],kramma:["ID/gMD/wC","IISPGJFt6xqMitEzL8hv+Q+G4idZGkehkeqwpdbBj7wVADs="],kramman:["ID/gMD/wC","GYSPqcvtj4IMb85mbcy8+7xxGOho0ImmaQEAOw=="],kurochute:["PDw8ODg4C","IYSPFpGty9yBUD5qb9QVrER1GTaSUvWdadqILCKW2UzTBQA7"],kurodoko:["ICAgMDAwC","H4SPiRHqDaAzMk66Lraa1g6GIhNCn1Kd2aGubUKKSAEAOw=="],kurotto:["MDAwODg4C","KYxvoKuIzNKSD8gWMM2T12t5h+ZAncOZaoiu6LZFYtyRmGyHuPqmUF8AADs="],kusabi:["MD/wP///y","I4SPqZvh/06QaxoLMMK80uuBYvaRY3eWW6mxqjuuJwQx9r0UADs="],lightup:["MD//////y","IIRvgcvKDxycNAY5r6a6I99t2xdijVeN1bqYHJvA0VMAADs="],lits:["ICAgKCgoC","IYQRqXmNq9yBUT7alr1wU2Z9gfeRWFiip6RNKfs6otkdBQA7"],lookair:["AD//6D//y","GoSPqcsa/5qBUdIgwc07+w92jciQi+lQYFYAADs="],loopsp:["P+AgP/Pgy","KYwPeLtpzoCcVDb1Mg7QQb55T9VVGrOBaPqhHomY6iyG2EfCa7dep1EAADs="],loute:["IH/gf///y","IYyPaaDB+lJE89TVrssZ+Ph5zUiWG8ShqpSyK9V9Vmg2BQA7"],makaro:["NnZ2e3t7S","I0xgmYDqytpzUa6K7cl1wuh9lnZ93siEompwoOhSHTuz26kUADs="],mashu:["P/AwP///y","JoR/kRntvYxCFExb6b0ZS/Y4kdeRXLaVViqFJ1vCndw+oziP+QcUADs="],mejilink:["NDQ0P///y","JoxheZrI4VhUE9iLc5ztQc8tz9ZBpPiN4Kq2hwZbpcTS7lk1zlYAADs="],minarism:["AD//4H+/y","HYyPqcutAKN8DNBlU75oa/6FoOF141EG0po67vsWADs="],mochikoro:["AAAAICAgC","IYwDqXmNq9yBUT7alr1wU2Z9gPeRWFiip6RNKfs6otkdBQA7"],mochinyoro:["MDAwKCgoC","FoSPqct9AaOctNqLs4au+29s4kiWUwEAOw=="],nagare:["N/Z/+7r/y","H4SPEJtt7FqItFo678t3ceWF4iGWIWim6sqirbtubQEAOw=="],nagenawa:["ACAgACeoC","JYSPacHdCgKUiiaL8NFrO7eF3RiJJWml5geS2QRX8TWxDITnegEAOw=="],nanro:["MD//+H//y","IIQfGcet2+KLUlFnL8rs+Q+G4khOWKJtaAqYqavBlwwUADs="],nawabari:["MD//////y","IwRihsnK2xI88dnqJM68zhl9G6V5wYmmagc24vZisavWKYsVADs="],norinori:["P/d1MDAwC","I4QfGcet2+KLUlFn8USvJ+Z5YLgZogZdZqYCpfpeMTVXX1MAADs="],numlin:["MDAwP///y","JYyBaJG6Cx6UhzIbacuszaphYkhKG+SVD7eOJpZ2yXepdGuDRgEAOw=="],nuribou:["KCgoICAgC","JYQRGYfKug58TlYzbaJbR3w1HTiKn8mdGamGK+ql6Uu7dlnjYQEAOw=="],nurikabe:["P+hof/R0S","FoSPqcvtD1eY1NHa7rSaX49F4kiWTAEAOw=="],nurimaze:["MD/wP/0/y","I4Qfp4u8aYKcs0WnINBYc+dRlIVtZHeCiMh6JfO9MSitbTwbBQA7"],paintarea:["P//wMD/wC","JowDCYfKug58TlYzbaJbR3w1HTiKn8lBZ5oxpOp6rTurIXvL+TsXADs="],pipelink:["ID/gM//gy","Kkxgqae4bYCcjs6YaoaY9a99BxWRz4mmi1VeW+d44Px6cWXhrHzG/OMoAAA7"],pipelinkr:["ID//8D//y","Kkxgqae4bYCcjs6YaoaY9a99BxWRz4mmi1VeW+d44Px6cWXhrHzG/OMoAAA7"],rectslider:["MDAwODg4C","IIxvoKuIzNyBa1Jqb5RB8359mseRkumMG6gCGSSGpSwVADs="],reflect:["MDAwP///y","HoyPqcvtCMAzMb5aWw5YbfpxVtKJEoONWrhO7gsnBQA7"],renban:["ID/gP//wC","JoRjeZrI4FhUM9h7F4yzPfh1mkRp2MmF6iOCLIVaZvrWpF16bnwVADs="],ringring:["KCgoMDAwC","JwRiqae4bYKctDr3Isw63dp1VsgcYCmeWDmirLpx6/p81n1xJL04BQA7"],ripple:["AD//////y","IIyBYJG6jRg8sNqLs97RyvZMnxNGo3liKce2XkuBVVAAADs="],roma:["P/wwf///y","IoSPqXvBGtxrcZpYJ85sc+hJYLiE2Ggm5oas7OWeQMzSWwEAOw=="],sashigane:["IH/gf///y","HYyPqcsBrcBrskp4LjZz+79p2NQxZRkhaOp4IhgUADs="],shakashaka:["AAAAICAgC","IoSPqRe7AR2CVAKKHd5q++l9VxgaJMecTXJqoltZ4ypfSwEAOw=="],shikaku:["ICAgMDAwC","HoSPGcm43YKctMoIcVab9/N8QPiRjoVe4riyq7kFBQA7"],shimaguni:["P//wMD/wC","G4yPqavgDx2KFMwKL5as+w+GBqVtJXZWqcgeBQA7"],shugaku:["AAAQAAAgC","JoRvoauIzNyBSyYaXp37Nv55GTiKGnWWQESmbguLrISp6ezUFlAAADs="],shwolf:["ID/gMD/wC","IQyOiQas6RqcytlXsY569RaE4vhx5Zedx5WulKuamNwFBQA7"],slalom:["ID//////y","IIwPecsJDIOLcNJlr3FP76yBF+d9SkmipydSbbWOsVEAADs="],slither:["AAAAP///y","F4yPqcutAF5MULqLs978Vjohnxh2ZlYAADs="],sudoku:["P//wP///y","HoRvgcvKDxxccp5qY0bY9hiE4khCn7ldabJq6/l8BQA7"],sukoro:["MDAwODg4C","JYyPoMin39KDMUwa76p2crd9HGaQF0hpQHeqrOe671p6KEOKSAEAOw=="],tapa:["P+hof/R0S","IISPqRAdm9yDR9LqrjY2ZvYhXSd+JNZs2gmxi6vAqlEAADs="],tasquare:["ICAgGBgYC","IYxvoKuIzNyBSyYKbMDZcv15HPaMzWR2l1mmFcrCYzsfBQA7"],tatamibari:["LP/gf///y","HYSPqaHA2x6SM9pETzbbwY9dFTiG5lmmzcq2rlIAADs="],tateyoko:["P/AwP///y","H4RjqQvI3+BzJ9hLqUx6R8+BXreRkoZhofiJJvROSgEAOw=="],tawa:["MDAwODg4C","GIR/gcud3hRccj57Mai6+8lZIeiNkOlwBQA7"],tentaisho:["IWL/X23/y","KASCYcum+5qDUx6mYtPZ3u19VZhooVWeBzJK5WNCr7jNsfOyXq6mQAEAOw=="],tilepaint:["KCgoICAgC","JowDCYfKug58TlYzbaJbR3w1HTiKn8lBZ5oxpOp6rTurIXvL+TsXADs="],toichika:["ID/gP///y","IoSPqRvsGlqSJlp6adXAwreE4nhwooeYWWlW6ZpObfeRYQEAOw=="],triplace:["MD/wP///y","JgyOCXas6dxrKNiLb51xv0593lJhI6ig0jlCZQabEzuHZH0v8V4AADs="],usotatami:["MD/wP//wC","KIQTppqcvc6BMKIKsIuZN10hjDdZnkguKNeV2ri+pQquKi2l9nulQAEAOw=="],wagiri:["P/rw////y","IIQPEci42dgzs1Ua77na7ShBoNR1YpilKmqtrOd+MVUAADs="],yajikazu:["P/B/f///y","HoSPEMm5DZ8JtNoKmcyTo+1loBh25YVSX3mMnMsyBQA7"],yajirin:["MD/wP///y","HISDicas2tpL0c1Qs968nwuGl0eWHqihmVqxRgEAOw=="],yajitatami:["MD/wP//wC","J4wPeRvpj9SbwLhG4WV8aZkpWBVWFkh1HHSSZTuGY7ypXYnSE/y2BQA7"],yosenabe:["ODg/////y","JIwDd6nGjdqD0VFZr5qg+4ltGgiKJkWO4bJ8nVhCT8yeq20dBQA7"],bosanowa:["P/AwP/hw////////y","LowtAst5l1gTL6Q4r968e5VR0CUBToVJ55NOlQWqIhsvGv3l+j22/FgyzYAlRwEAOw=="],dosufuwa:["JmZmbKysszMzP///y","KUyAYMuW3lhCMJ6plMXZXu59TyiSpIAKZmqoXoq2L6y6EV3PeLifbFAAADs="],sukororoom:["NDQ0ODg4PDw8P///y","NIwfgqebBqJpS8X7nL0g18B1FNJgHukkwsqu6ZiioISYmzljN51LewfhZHBBICw2aSmXggIAOw=="],view:["MD/wP//wP///////y","LoQtEst5l1gTDykZXNq8+99hThWJFHlJ41OqJ5tOFdDKaAbmOnebc71YQWJBSgEAOw=="],wblink:["NDQ0ODg4Pj4+P///y","LoQdIct5l1gLDykpXNq8+99hThWJFHlJ41OqJ5tOFdDKaAbmOnebc71YQWJBSgEAOw=="]}[a];return b||(b=["MD/wPD/8C","KYQTpogKnFxbMDpa7W18yjhp1yGO1OidW5mSKFuaTyy585t0ctZ+EFAAADs="]),"data:image/gif;base64,"+(b[0].length<=10?"R0lGODdhEAAQAIAAA":"R0lGODdhEAAQAKEAA")+b[0]+"wAAAAAEAAQAAAC"+b[1]}!function(){function a(){return k||(k=f()||e())&&k.pid||b(),!0}function b(){if(!ui.puzzle||!ui.puzzle.pid){var a=document.getElementById("title2");a&&(a.innerHTML="Fail to import puzzle data or URL."),document.getElementById("menupanel").innerHTML=""}}function c(){var a=k.pid,b=!0;return ui.debugmode&&(ui.debug?ui.debug.urls?ui.debug.urls[a]||(ui.debug.includeDebugScript("test_"+a+".js"),b=!1):(ui.debug.includeDebugScript("for_test.js"),b=!1):b=!1),b}function d(){var a=k,c=a.pid;ui.debugmode&&(l.mode="play"),function(a){return a.match(/MSIE/)||a.match(/AppleWebKit/)&&a.match(/Edge/)}(navigator.userAgent)&&(l.graphic="canvas");var d=document.getElementById("divques"),e=ui.puzzle=new pzpr.Puzzle(d,l);pzpr.connectKeyEvents(e),ui.event.onload_func();var f=null;return ui.debugmode?e.once("ready",function(a){ui.menuconfig.set("autocheck",!0)}):f=i,!ui.debugmode&&j&&"player"!==l.type&&e.once("ready",h),e.once("fail-open",b),e.open(!ui.debugmode||a.qdata?a:c+"/"+ui.debug.urls[c],f),!0}function e(){var a=g("pzprv3_urldata","urldata");if(a&&(j=!1),!(a=a||location.search))return null;for("?"===a.charAt(0)&&(a=a.substr(1));a.match(/^(\w+)\=(\w+)\&(.*)/);)l[RegExp.$1]=RegExp.$2,a=RegExp.$3;"test"===a&&(a="country_test");var b="";a.match(/_test/)?(b="EDITOR",ui.debugmode=!0):a.match(/^m\+/)?b="EDITOR":a.match(/_edit/)?b="EDITOR":a.match(/_play/)&&(b="PLAYER"),j||(b="EDITOR"),a=a.replace(/^m\+/,""),a=a.replace(/(_test|_edit|_play)/,"");var c=pzpr.parser.parseURL(a);return b=b||(c.body?"PLAYER":"EDITOR"),"PLAYER"===b&&(l.type="player"),c}function f(){var a=g("pzprv3_filedata","filedata");if(!a)return null;var b=pzpr.parser.parseFile(a,"");return b?(j=!1,b):null}function g(a,b){var c=localStorage[a];return"string"==typeof c&&(delete localStorage[a],sessionStorage[b]=c),c=sessionStorage[b],"string"==typeof c?c:null}function h(a){var b=JSON.parse(localStorage["pzprv3_index:ranking"]||"{}"),c=b.count||{},d=c[a.pid]||0;c[a.pid]=d+1;var e=b.recent||[];e.indexOf(a.pid)>=0&&e.splice(e.indexOf(a.pid),1),e.unshift(a.pid),e.length>10&&e.pop(),localStorage["pzprv3_index:ranking"]=JSON.stringify({count:c,recent:e})}function i(a){if(a.playeronly&&k.pid&&j&&("indi.s58.xrea.com"===document.domain||"pzprv3.sakura.ne.jp"===document.domain||document.domain.match(/(dev\.)?pzv\.jp/))){var b=document.referrer;if(!b.match(/http\:\/\/[\w\.]*pzv\.jp/)){b=b.replace(/\?/g,"%3f").replace(/\&/g,"%26").replace(/\=/g,"%3d").replace(/\//g,"%2f");var c=!1;if("undefined"!=typeof ActiveXObject)try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){c=!1}if(c||"undefined"==typeof XMLHttpRequest||(c=new XMLHttpRequest),c){var d=["scr=pzprv3","pid="+k.pid,"referer="+b,"pzldata="+k.qdata].join("&");c.open("POST","./record.cgi"),c.onreadystatechange=function(){},c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(d)}}}}var j=!0,k=null,l={};pzpr.on("load",function b(){a()&&c()?d():setTimeout(b,0)})}();var d=document;window.ui={version:"0.0.1",puzzle:null,currentpid:"",event:null,menuconfig:null,menuarea:null,toolarea:null,popupmgr:null,keypopup:null,timer:null,debugmode:!1,enableGetText:!1,enableReadText:!1,reader:null,enableSaveImage:!1,enableImageType:{},enableSaveBlob:!1,callbackComplete:null,displayAll:function(){ui.menuarea.display(),ui.toolarea.display(),ui.popupmgr.translate(),ui.misc.displayDesign()},setdisplay:function(a){ui.menuarea.setdisplay(a),ui.toolarea.setdisplay(a)},customAttr:function(a,b){var c="";if(void 0!==a.dataset)c=a.dataset[b];else{for(var d="data-",e=0;e<b.length;e++){var f=b[e]||b.charAt(e);d+=f>="A"&&f<="Z"?"-"+f.toLowerCase():f}c=a[d]||a.getAttribute(d)||""}return c},windowWidth:function(){return void 0!==window.innerHeight?window.innerWidth:d.body.clientWidth},adjustcellsize:function(){var b,c,d=ui.puzzle,e=d.painter,f=e.getCanvasCols()+2*ui.getBoardPadding(),g=ui.windowWidth()-6,h=ui.menuconfig,i=h.get("cellsizeval"),j={base:1,limit:.4},k={base:.8,limit:.96},l=[];l[0]=g*k.base/(i*j.base),l[1]=g*k.limit/(i*j.base),l[2]=g*k.limit/(i*j.limit),h.get("fullwidth")?(b=.98*g,c=.92*b/f):!h.get("adjsize")||f<l[0]?(b=g*k.base-4,c=i*j.base):f<l[1]?(c=i*j.base,b=c*f):f<l[2]?(b=g*k.limit-4,c=b/f):(c=i*j.limit,b=c*f),e.outputImage||(a("main").style.width=(0|b)+"px"),d.setCanvasSizeByCellSize(c)},getBoardPadding:function(){var a=ui.puzzle,b=0;switch(a.pid){case"firefly":case"hashikake":case"wblink":case"ichimaga":case"ichimagam":case"ichimagax":b=.3;break;case"kouchoku":case"gokigen":case"wagiri":case"creek":b=.2;break;case"slither":case"bag":case"mejilink":b=.15;break;case"kinkonkan":case"building":case"easyasabc":case"box":b=.05;break;case"bosanowa":b=2!==ui.menuconfig.get("disptype_bosanowa")?.5:.05;break;default:b=.5}return ui.menuconfig.get("fullwidth")&&(b=0),b},selectStr:function(a,b){return b?"ja"===pzpr.lang?a:b:a},getCurrentConfigList:function(){return ui.menuconfig.getList()},initFileReadMethod:function(){"undefined"!=typeof FileReader?(this.reader=new FileReader,this.reader.onload=function(a){ui.puzzle.open(a.target.result)},this.enableReadText=!0):(this.reader=null,this.enableGetText="undefined"!=typeof FileList&&void 0!==File.prototype.getAsText)},initImageSaveMethod:function(a){if(pzpr.Candle.enable.canvas&&d.createElement("canvas").toDataURL){this.enableImageType.png=!0;var b=d.createElement("canvas");b.width=b.height=1,b.toDataURL("image/gif").match("image/gif")&&(this.enableImageType.gif=!0),b.toDataURL("image/jpeg").match("image/jpeg")&&(this.enableImageType.jpeg=!0),b.toDataURL("image/webp").match("image/webp")&&(this.enableImageType.webp=!0)}pzpr.Candle.enable.svg&&window.btoa&&(this.enableImageType.svg=!0),(this.enableImageType.png||this.enableImageType.svg)&&(this.enableSaveImage=!0),this.enableSaveBlob=!!window.navigator.saveBlob}},ui.event={resizetimer:null,removers:[],addEvent:function(a,b,c,d,e){this.removers.push(pzpr.util.addEvent(a,b,c,d,!!e))},removeAllEvents:function(){this.removers.forEach(function(a){a()}),this.removers=[]},setWindowEvents:function(){if(ui.reader){var a=function(a){ui.reader.readAsText(a.dataTransfer.files[0]),a.preventDefault(),a.stopPropagation()};this.addEvent(window,"dragover",this,function(a){a.preventDefault()},!0),this.addEvent(window,"drop",this,a,!0)}this.addEvent(d,"blur",this,this.onblur_func);var b=pzpr.env.OS.iOS?"orientationchange":"resize";this.addEvent(window,b,this,this.onresize_func),this.addEvent(window,"beforeunload",this,this.onbeforeunload_func),this.addEvent(window,"unload",this,this.onunload_func),this.addEvent(document.getElementById("quesboard"),"mousedown",this,function(a){ui.puzzle.errclear(),a.stopPropagation()})},onload_func:function(){ui.initFileReadMethod(),ui.menuconfig.restore(),ui.listener.setListeners(ui.puzzle),pzpr.env.OS.Android&&ui.misc.modifyCSS({"body, .btn":{fontFamily:"Verdana, Arial, sans-serif"}})},onunload_func:function(){ui.menuconfig.save()},onresize_func:function(){this.resizetimer&&clearTimeout(this.resizetimer),this.resizetimer=setTimeout(function(){ui.adjustcellsize()},250)},onblur_func:function(){ui.puzzle.key.keyreset(),ui.puzzle.mouse.mousereset()},onbeforeunload_func:function(a){if(!ui.puzzle.playeronly&&ui.puzzle.ismodified()){var b=ui.selectStr("盤面が更新されています","The board is edited.");return a.returnValue=b,b}}},ui.listener={setListeners:function(a){a.once("ready",this.onFirstReady),a.on("ready",this.onReady),a.on("key",this.onKeyInput),a.on("mouse",this.onMouseInput),a.on("history",this.onHistoryChange),a.on("trial",this.onTrialModeChange),a.on("mode",this.onModeChange),a.on("adjust",this.onAdjust),a.on("resize",this.onResize)},onFirstReady:function(a){ui.initImageSaveMethod(a)},onReady:function(a){ui.currentpid!==a.pid&&(ui.event.removeAllEvents(),ui.keypopup.create(),ui.menuarea.reset(),ui.toolarea.reset(),ui.popupmgr.reset(),ui.notify.reset(),ui.misc.displayDesign(),ui.event.setWindowEvents()),ui.menuconfig.sync(),ui.menuconfig.set("autocheck_once",ui.menuconfig.get("autocheck")),ui.currentpid=a.pid,ui.adjustcellsize(),ui.keypopup.display(),ui.timer.reset()},onKeyInput:function(a,b){var c=a.key,d=ui.undotimer,e=!0;c.keydown?("ctrl+z"!==b&&"meta+z"!==b||(d.startKeyUndo(),e=!1),"ctrl+y"!==b&&"meta+y"!==b||(d.startKeyRedo(),e=!1),a.playeronly||(a.editmode&&"F2"===b?(ui.menuconfig.set("mode",a.MODE_PLAYER),e=!1):a.playmode&&"shift+F2"===b&&(ui.menuconfig.set("mode",a.MODE_EDITOR),e=!1)),ui.debug.keydown(b)&&(e=!1)):c.keyup&&("ctrl+z"!==b&&"meta+z"!==b||(d.stopKeyUndo(),e=!1),"ctrl+y"!==b&&"meta+y"!==b||(d.stopKeyRedo(),e=!1)),c.isCTRL||c.isMETA?c.isZ?c.isY||d.stopKeyRedo():d.stopKeyUndo():d.reset(),c.cancelEvent=!e},onMouseInput:function(a){var b=a.mouse,c=!0;if(b.mousestart&&"middle"===b.btn)ui.menuconfig.set("mode",a.playmode?"edit":"play"),b.mousereset(),c=!1;else if("goishi"===ui.puzzle.pid)if(b.mousestart&&ui.puzzle.playmode)if("left"===b.btn){var d=b.getcell();!d.isnull&&d.isStone()&&-1===d.anum||(ui.undotimer.startAnswerRedo(),c=!1)}else"right"===b.btn&&(ui.undotimer.startAnswerUndo(),c=!1);else b.mouseend&&(ui.undotimer.stop(),c=!1);b.cancelEvent=!c},onHistoryChange:function(a){ui.currentpid&&ui.setdisplay("operation")},onTrialModeChange:function(a,b){ui.currentpid&&ui.setdisplay("trialmode")},onModeChange:function(a){ui.menuconfig.list.mode.val=ui.puzzle.playmode?"play":"edit",ui.setdisplay("mode"),ui.menuconfig.set("inputmode",ui.puzzle.mouse.inputMode),ui.setdisplay("keypopup"),ui.setdisplay("bgcolor"),ui.setdisplay("passallcell"),ui.keypopup.display()},onAdjust:function(a){ui.adjustcellsize()},onResize:function(a){var b=a.painter,c=Math.min(b.cw,b.ch),d=ui.getBoardPadding()*c|0,e=d;"starbattle"!==a.pid&&"easyasabc"!==a.pid||(e=(.05*c|0)+"px"),a.canvas.parentNode.style.padding=d+"px",a.canvas.parentNode.style.paddingTop=e+"px",ui.keypopup.resizepanel()}},function(){var a=pzpr.Puzzle.prototype.Config.prototype;ui.menuconfig={list:null,init:function(){this.list={},this.add("autocheck",ui.puzzle.playeronly),this.add("autocheck_once",ui.puzzle.playeronly,{volatile:!0}),this.add("keypopup",!1),this.add("adjsize",!0),this.add("cellsizeval",ui.windowWidth()<=960?36:48),this.add("fullwidth",ui.windowWidth()<600),this.add("toolarea",!0),this.add("inputmode","auto",{volatile:!0}),this.add("lrinvert",!1,{volatile:!0}),this.add("language",pzpr.lang,{option:["en","ja"]});for(var a in ui.puzzle.config.list){var b=ui.puzzle.config.list[a],c={puzzle:!0};b.option&&(c.option=b.option),this.add(a,b.defval,c)}this.add("mode",ui.puzzle.playmode?"play":"edit",{option:["edit","play"],puzzle:!0})},add:function(b,c,d){if(a.add.call(this,b,c,d),d&&d.puzzle){var e=this.list[b];e.volatile=e.puzzle=!0}},sync:function(){var a=null;switch(ui.puzzle.pid){case"yajirin":a="disptype_yajilin";break;case"pipelinkr":a="disptype_pipelinkr";break;case"bosanowa":a="disptype_bosanowa"}a&&this.set(a,ui.puzzle.getConfig(a)),this.set("lrinvert",ui.puzzle.mouse.inversion),this.set("autocmp",ui.puzzle.getConfig("autocmp")),this.set("autoerr",ui.puzzle.getConfig("autoerr"))},getCurrentName:a.getCurrentName,getNormalizedName:a.getNormalizedName,get:a.get,set:function(a,b){var c=this.getNormalizedName(a),d=c.name;this.list[d]&&("mode"===d?(ui.puzzle.setMode(b),b=ui.puzzle.playmode?"play":"edit"):"inputmode"===d&&(ui.puzzle.mouse.setInputMode(b),b=ui.puzzle.mouse.inputMode),b=this.setproper(c,b),"language"===d?pzpr.lang=b:this.list[d].puzzle&&ui.puzzle.setConfig(a,b),this.configevent(d,b))},reset:a.reset,restore:function(){ui.puzzle.config.init(),this.init();var a=localStorage["pzprv3_config:puzzle"],b=localStorage["pzprv3_config:ui"];a&&this.setAll(JSON.parse(a)),b&&this.setAll(JSON.parse(b))},save:function(){localStorage["pzprv3_config:puzzle"]=JSON.stringify(ui.puzzle.saveConfig()),localStorage["pzprv3_config:ui"]=JSON.stringify(this.getAll())},getList:a.getList,getexec:function(a){return!!this.list[a]&&("mode"===a?!ui.puzzle.playeronly:!this.list[a].puzzle||ui.puzzle.validConfig(a))},getAll:a.getAll,setAll:function(a){for(var b in a)this.set(b,a[b]);this.list.autocheck_once.val=this.list.autocheck.val},setproper:a.setproper,valid:function(a){return!!this.list[a]&&("keypopup"===a?0!==ui.keypopup.paneltype[1]||0!==ui.keypopup.paneltype[3]:"mode"===a?!ui.puzzle.playeronly:"inputmode"===a?ui.puzzle.mouse.getInputModeList("play").length>1||!ui.puzzle.playeronly&&ui.puzzle.mouse.getInputModeList("edit").length>1:!this.list[a].puzzle||ui.puzzle.validConfig(a))},configevent:function(a,b){if(ui.menuarea.menuitem)switch(ui.setdisplay(a),a){case"keypopup":ui.keypopup.display();break;case"adjsize":case"cellsizeval":case"fullwidth":ui.adjustcellsize();break;case"autocheck":this.list.autocheck_once.val=b;break;case"language":ui.displayAll();break;case"lrinvert":ui.puzzle.mouse.setInversion(b)}}}}(),ui.misc={displayDesign:function(){var a=ui.puzzle.pid,b=pzpr.variety(a),c=ui.selectStr(b.ja,b.en);c+=ui.puzzle.playeronly?" player":ui.selectStr(" エディタ"," editor"),c+=ui.selectStr(" - ぱずぷれv3"," - PUZ-PRE v3"),d.title=c,d.getElementById("title2").innerHTML=c,d.body.style.backgroundImage="url("+this.bgimage(a)+")"},bgimage:function(a){return c(a)},modifyCSS:function(a){var b=d.styleSheets[0],c=b.cssRules;if(null===c);else if(!this.modifyCSS_sub(c,a)){var e="";for(e in a)break;b.insertRule(e+" {}",c.length),c=b.cssRules,this.modifyCSS_sub(c,a)}},modifyCSS_sub:function(a,b){for(var c=!1,d=0,e=a.length;d<e;d++){var f=a[d];if(f.selectorText){var g=b[f.selectorText];if(g){for(var h in g)g[h]&&(f.style[h]=g[h]);c=!0}}}return c},walker:function(a,b){for(var c=[a.firstChild];c.length>0;){var d=c.pop();b(d),d.nextSibling&&c.push(d.nextSibling),1===d.nodeType&&d.childNodes.length>0&&c.push(d.firstChild)}},displayByPid:function(a){ui.misc.walker(a,function(a){if(1===a.nodeType){var b=ui.customAttr(a,"dispPid");b&&(a.style.display=pzpr.util.checkpid(b,ui.puzzle.pid)?"":"none");var c=ui.customAttr(a,"autocmpType");c&&(a.style.display=ui.puzzle.painter.autocmp===c?"":"none")}})}},ui.menuarea={captions:[],menuitem:null,nohover:!1,reset:function(){this.createMenu(),this.display()},createMenu:function(){null===this.menuitem&&(this.modifySelector(),this.menuitem={},this.walkElement(a("menupanel"))),ui.misc.displayByPid(a("menupanel")),this.stopHovering()},walkElement:function(a){function b(a){return function(b){d[a](b),d.nohover&&(b.preventDefault(),b.stopPropagation())}}function c(a,c,e){var f="function"==typeof e?e:b(e);pzpr.util.addEvent(a,c,d,f)}var d=this;ui.misc.walker(a,function(a){if(1===a.nodeType&&"LI"===a.nodeName){var b=!1,e=ui.customAttr(a,"config");e&&(d.menuitem[e]={el:a},"check"===a.className&&(c(a,"mousedown","checkclick"),b=!0));if(ui.customAttr(a,"value")){var f=a.parentNode.parentNode,e=ui.customAttr(f,"config"),g=d.menuitem[e];g.children||(g.children=[]),g.children.push(a),c(a,"mousedown","childclick"),b=!0}var h=ui.customAttr(a,"menuExec");if(h&&(c(a,"mousedown",h),b=!0),h=ui.customAttr(a,"pressExec")){var i=h.split(/,/);c(a,"mousedown",i[0]),h[1]&&(c(a,"mouseup",i[1]),c(a,"mouseleave",i[1]),c(a,"touchcancel",i[1])),b=!0}h=ui.customAttr(a,"popup"),h&&(c(a,"mousedown","disppopup"),b=!0),b||(d.nohover&&a.querySelector("menu")?c(a,"mousedown",function(b){d.showHovering(b,a),b.preventDefault(),b.stopPropagation()}):c(a,"mousedown",function(a){a.preventDefault()}));var j=ui.customAttr(a,"pidlink");j&&a.firstChild.setAttribute("href",j+ui.puzzle.pid)}else if(1===a.nodeType&&"MENU"===a.nodeName){var k=a.getAttribute("label");k&&k.match(/^__(.+)__(.+)__$/)&&(d.captions.push({menu:a,str_jp:RegExp.$1,str_en:RegExp.$2}),d.nohover&&c(a,"mousedown",function(a){a.stopPropagation()}))}else 3===a.nodeType&&a.data.match(/^__(.+)__(.+)__$/)&&d.captions.push({textnode:a,str_jp:RegExp.$1,str_en:RegExp.$2})})},modifySelector:function(){if(pzpr.env.OS.mobile&&a("menupanel").classList){for(var b=d.styleSheets[0],c=b.cssRules||b.rules,e=0,f=c.length;e<f;e++){var g=c[e];g.selectorText&&(g.selectorText.match(/\#menupanel.+\:hover.*/)&&(b.insertRule(g.cssText.replace(":hover",".hovering"),e),b.deleteRule(e+1)))}this.nohover=!0}},showHovering:function(b,c){this.nohover&&(c.classList.toggle("hovering"),ui.misc.walker(a("menupanel"),function(a){1===a.nodeType&&a.classList&&!a.contains(c)&&a.classList.remove("hovering")}))},stopHovering:function(){this.nohover&&ui.misc.walker(a("menupanel"),function(a){1===a.nodeType&&a.classList&&a.classList.remove("hovering")})},display:function(){a("menupanel").style.display="",a("menu_imagesave").className=ui.enableSaveImage?"":"disabled",a("menu_subclear").style.display=ui.puzzle.board.disable_subclear?"none":"";var b=!ui.puzzle.playeronly;a("menu_newboard").style.display=b?"":"none",a("menu_urloutput").style.display=b?"":"none",a("menu_metadata").style.display=b?"":"none",a("menu_adjust").style.display=b?"":"none",a("menu_turnflip").style.display=b?"":"none",a("menu_sep_edit1").style.display=b?"":"none";for(var c in this.menuitem)this.setdisplay(c);this.setdisplay("operation"),this.setdisplay("trialmode"),this.setdisplay("toolarea");for(var d=0;d<this.captions.length;d++){var e=this.captions[d];e.textnode?e.textnode.data=ui.selectStr(e.str_jp,e.str_en):e.menu&&e.menu.setAttribute("label",ui.selectStr(e.str_jp,e.str_en))}},setdisplay:function(b){if("operation"===b){var c=ui.puzzle.opemgr;a("menu_oldest").className=c.enableUndo?"":"disabled",a("menu_undo").className=c.enableUndo?"":"disabled",a("menu_redo").className=c.enableRedo?"":"disabled",a("menu_latest").className=c.enableRedo?"":"disabled"}else if("trialmode"===b){var d=ui.puzzle.board.trialstage;a("menu_trialenter").className=0===d?"":"disabled",a("menu_trialenter").nextSibling.nextSibling.style.display=d>0?"":"none",a("menu_trialaccept").style.display=d>0?"":"none",a("menu_trialreject").style.display=1===d?"":"none",a("menu_trialreject2").style.display=d>1?"":"none",a("menu_trialrejectall").style.display=d>1?"":"none",a("menu_trialenter2").style.display=d>0?"":"none"}else if("toolarea"===b){var e;e=ui.menuconfig.get("toolarea")?ui.selectStr("ツールエリアを隠す","Hide tool area"):ui.selectStr("ツールエリアを表示","Show tool area"),a("menu_toolarea").childNodes[0].data=e}else if(null!==this.menuitem&&this.menuitem[b])if(ui.menuconfig.valid(b)){var f=this.menuitem[b];if(f.el.style.display="",f.children)for(var g=f.children,h="inputmode"===b?ui.puzzle.mouse.getInputModeList():null,i=0;i<g.length;i++){var j=g[i],k=ui.customAttr(j,"value"),l=k===""+ui.menuconfig.get(b);j.className=l?"checked":"",j.style.display=null===h||h.indexOf(k)>=0?"":"none"}else if(f.el){var m=ui.menuconfig.get(b)?"checked":"check",n=null;"passallcell"===b&&(n=!ui.puzzle.editmode),!0===n&&(m+=" disabled"),f.el.className=m}}else this.menuitem[b]&&(this.menuitem[b].el.style.display="none");else;},checkclick:function(a){var b=a.target;if("SPAN"===b.nodeName&&(b=b.parentNode),!b.className.match(/disabled/)){var c=ui.customAttr(b,"config");ui.menuconfig.set(c,!ui.menuconfig.get(c))}},childclick:function(a){var b=a.target;"SPAN"===b.nodeName&&(b=b.parentNode);var c=b.parentNode.parentNode;ui.menuconfig.set(ui.customAttr(c,"config"),ui.customAttr(b,"value"))},anscheck:function(){this.answercheck()},undo:function(){ui.undotimer.startButtonUndo()},undostop:function(){ui.undotimer.stopButtonUndo()},undoall:function(){ui.puzzle.undoall()},redo:function(){ui.undotimer.startButtonRedo()},redostop:function(){ui.undotimer.stopButtonRedo()},redoall:function(){ui.puzzle.redoall()},ansclear:function(){this.ACconfirm()},subclear:function(){this.ASconfirm()},dropblocks:function(){ui.puzzle.board.operate("drop")},raiseblocks:function(){ui.puzzle.board.operate("raise")},resetblocks:function(){ui.puzzle.board.operate("resetpos")},showgatenum:function(){ui.puzzle.board.operate("showgatenumber")},hidegatenum:function(){ui.puzzle.board.operate("hidegatenumber")},enterTrial:function(){0===ui.puzzle.board.trialstage&&ui.puzzle.enterTrial()},enterFurtherTrial:function(){ui.puzzle.enterTrial()},acceptTrial:function(){ui.puzzle.acceptTrial()},rejectTrial:function(){ui.puzzle.rejectTrial()},rejectCurrentTrial:function(){ui.puzzle.rejectCurrentTrial()},duplicate:function(){this.duplicate_board()},toolarea:function(){ui.menuconfig.set("toolarea",!ui.menuconfig.get("toolarea")),ui.displayAll()},repaint:function(){ui.puzzle.redraw(!0)},disppopup:function(b){var c=b.target;if("SPAN"===c.nodeName&&(c=c.parentNode),"disabled"!==c.className){var d=ui.customAttr(c,"popup");if("database"===d&&pzpr.util.currentTime()>parseInt(localStorage["pzprv3_storage:warning-time"]||0)+432e5&&(ui.notify.alert("ブラウザのデータクリア等で意図せずデータが消えることありますので、長期保存に使用しないでください","Don't use this for long-term use as these data will be cleared unexpectedly due to browser's cache clear etc."),localStorage["pzprv3_storage:warning-time"]=pzpr.util.currentTime()),pzpr.env.OS.mobile){var e=pzpr.util.getRect(a("menupanel"));ui.popupmgr.open(d,8,e.bottom+8)}else{var f=pzpr.util.getPagePos(b);ui.popupmgr.open(d,f.px-8,f.py-8)}this.stopHovering()}},dispdebug:function(){ui.popupmgr.open("debug",0,0),this.stopHovering()},duplicate_board:function(){if("disabled"!==a("menu_duplicate").className){var b=ui.puzzle.getFileData(pzpr.parser.FILE_PZPR,{history:!0}),c="./p?"+ui.puzzle.pid+(ui.puzzle.playeronly?"_play":"");if(pzpr.env.browser.Presto)localStorage.pzprv3_filedata=b,window.open(c,"");else{var d=sessionStorage.filedata;sessionStorage.filedata=b,window.open(c,""),d?sessionStorage.filedata=d:delete sessionStorage.filedata}this.stopHovering()}},answercheck:function(){var a=ui.puzzle.check(!0);a.complete&&(ui.timer.stop(),ui.callbackComplete&&ui.callbackComplete(ui.puzzle,a));for(var b="",c=a.text.split(/\n/),d=0;d<c.length;d++)b+='<div style="margin-bottom:6pt;">'+c[d]+"</div>";this.stopHovering(),ui.notify.alert(b)},ACconfirm:function(){this.stopHovering(),ui.notify.confirm("解答を消去しますか？","Do you want to erase the Answer?",function(){ui.puzzle.ansclear()})},ASconfirm:function(){this.stopHovering(),ui.notify.confirm("補助記号を消去しますか？","Do you want to erase the auxiliary marks?",function(){ui.puzzle.subclear()})}},ui.popupmgr={popup:null,popups:{},movingpop:null,offset:{px:0,py:0},reset:function(){this.setEvents(),this.translate()},setEvents:function(){ui.event.addEvent(d,"mousemove",this,this.titlebarmove),ui.event.addEvent(d,"mouseup",this,this.titlebarup)},translate:function(){for(var a in this.popups)this.popups[a].translate()},addpopup:function(a,b){var c={},d=this.popups.template||{};for(var e in d)c[e]=d[e];for(var e in b)c[e]=b[e];this.popups[a]=c},open:function(a,b,c){var d=this.popups[a]||null;return null!==d&&(!d.multipopup&&this.popup&&this.popup.close(),d.show(b,c),!0)},titlebardown:function(a){var b=a.target.parentNode,c=pzpr.util.getPagePos(a);this.movingpop=b,this.offset.px=c.px-parseInt(b.style.left,10),this.offset.py=c.py-parseInt(b.style.top,10),ui.event.enableMouse=!1,a.preventDefault(),a.stopPropagation()},titlebarup:function(a){this.movingpop&&(this.movingpop=null,ui.event.enableMouse=!0)},titlebarmove:function(a){var b=this.movingpop;if(b){var c=pzpr.util.getPagePos(a);b.style.left=c.px-this.offset.px+"px",b.style.top=c.py-this.offset.py+"px",a.preventDefault()}}},ui.popupmgr.addpopup("template",{formname:"",multipopup:!1,pid:"",init:function(){this.form=document[this.formname],this.pop=this.form.parentNode,this.titlebar=this.pop.querySelector(".titlebar")||null,this.titlebar&&(pzpr.util.unselectable(this.titlebar),pzpr.util.addEvent(this.titlebar,"mousedown",ui.popupmgr,ui.popupmgr.titlebardown)),pzpr.util.addEvent(this.form,"submit",this,function(a){a.preventDefault()}),this.walkCaption(this.pop),this.translate(),this.walkEvent(this.pop)},reset:function(){},translate:function(){if(this.captions)for(var a=0;a<this.captions.length;a++){
var b=this.captions[a],c=ui.selectStr(b.str_jp,b.str_en);b.textnode?b.textnode.data=c:b.button&&(b.button.value=c)}},walkCaption:function(a){var b=this;this.captions=[],ui.misc.walker(a,function(a){3===a.nodeType&&a.data.match(/^__(.+)__(.+)__$/)&&b.captions.push({textnode:a,str_jp:RegExp.$1,str_en:RegExp.$2})})},walkEvent:function(a){function b(a){return function(b){c[a](b),"click"!==b.type&&(b.preventDefault(),b.stopPropagation())}}var c=this;ui.misc.walker(a,function(a){if(1===a.nodeType){var d=ui.customAttr(a,"buttonExec");d&&pzpr.util.addEvent(a,pzpr.env.API.touchevent?"mousedown":"click",c,b(d)),d=ui.customAttr(a,"changeExec"),d&&pzpr.util.addEvent(a,"change",c,b(d))}})},show:function(a,b){this.pop||this.init(),this.pid!==ui.puzzle.pid&&(this.pid=ui.puzzle.pid,this.reset()),this.pop.style.left=a+"px",this.pop.style.top=b+"px",this.pop.style.display="inline",this.multipopup||(ui.popupmgr.popup=this)},close:function(){this.pop.style.display="none",this.multipopup||(ui.popupmgr.popup=null),ui.puzzle.key.enableKey=!0,ui.puzzle.mouse.enableMouse=!0}}),ui.popupmgr.addpopup("newboard",{formname:"newboard",reset:function(){if(ui.misc.displayByPid(this.pop),"tawa"===this.pid)for(var b=0;b<=3;b++){var c=a("nb_shape_"+b),d=c.children[0];d.src="data:image/gif;base64,R0lGODdhgAAgAKEBAAAAAP//AP//////ACwAAAAAgAAgAAAC/pSPqcvtD6OctNqLs968+98A4kiWJvmcquisrtm+MpAAwY0Hdn7vPN1aAGstXs+oQw6FyqZxKfDlpDhqLyXMhpw/ZfHJndbCVW9QATWkEdYk+Pntvn/j+dQc0hK39jKcLxcoxkZ29JeHpsfUZ0gHeMeoUyfo54i4h7lI2TjI0PaJp1boZumpeLCGOvoZB7kpyTbzIiTrglY7o4Yrc8l2irYamjiciar2G4VM7Lus6fpcdVZ8PLxmrTyd3AwcydprvK19HZ6aPf5YCX31TW3ezuwOcQ7vGXyIPA+e/w6ORZ5ir9S/gfu0ZRt4UFU3YfHiFSyoaxeMWxJLUKx4IiLGZIn96HX8iNBjQ5EG8Zkk+dDfyJAgS7Lkxy9lOJTYXMK0ibOlTJ0n2eEs97OnUJ40X668SfRo0ZU7SS51erOp0XxSkSaFGtTo1a0bUcSo9bVr2I0gypo9izat2rVs27p9Czfu2QIAOw==",d.style.clip="rect(0px,"+32*(b+1)+"px,32px,"+32*b+"px)"}},show:function(a,b){switch(ui.popupmgr.popups.template.show.call(this,a,b),ui.puzzle.key.enableKey=!1,ui.puzzle.pid){case"sudoku":this.setsize_sudoku();break;case"tawa":this.setsize_tawa();break;default:this.setsize()}},setsize:function(){var a=ui.puzzle.board;this.form.col.value=""+a.cols,this.form.row.value=""+a.rows},getsize:function(){var a=0|this.form.col.value,b=0|this.form.row.value;return a&&b?{col:a,row:b}:null},setsize_sudoku:function(){for(var b=0;b<4;b++)a("nb_size_sudoku_"+b).checked="";switch(ui.puzzle.board.cols){case 16:a("nb_size_sudoku_2").checked=!0;break;case 25:a("nb_size_sudoku_3").checked=!0;break;case 4:a("nb_size_sudoku_0").checked=!0;break;case 6:a("nb_size_sudoku_4").checked=!0;break;default:a("nb_size_sudoku_1").checked=!0}},getsize_sudoku:function(){var b,c;return b=c=a("nb_size_sudoku_2").checked?16:a("nb_size_sudoku_3").checked?25:a("nb_size_sudoku_0").checked?4:a("nb_size_sudoku_4").checked?6:9,{col:b,row:c}},setsize_tawa:function(){var a=ui.puzzle.board,b=a.cols,c=a.rows,d=a.shape;3===d&&b++,this.form.col.value=""+b,this.form.row.value=""+c,this.setshape(d)},getsize_tawa:function(){var a=0|this.form.col.value,b=0|this.form.row.value;if(!a||!b)return null;var c=this.getshape();return isNaN(c)||1===a&&(0===c||3===c)?null:(3===c&&a--,{col:a,row:b,shape:c})},setshape:function(a){this.setshapeidx([0,2,3,1][a])},getshape:function(){var a=this.getshapeidx();return null!==a?[0,3,1,2][a]:null},clickshape:function(a){this.setshapeidx(+a.target.parentNode.id.charAt(9))},setshapeidx:function(b){for(var c=0;c<=3;c++)a("nb_shape_"+c).style.backgroundColor=c===b?"red":""},getshapeidx:function(){for(var b=0;b<=3;b++)if("red"===a("nb_shape_"+b).style.backgroundColor)return b;return null},execute:function(){var a,b=ui.puzzle.pid;switch(b){case"sudoku":a=this.getsize_sudoku();break;case"tawa":a=this.getsize_tawa();break;default:a=this.getsize()}if(this.close(),a){var c=b+"/"+a.col+"/"+a.row;"tawa"===b&&(c+="/"+a.shape),ui.puzzle.open(c)}}}),ui.popupmgr.addpopup("urlinput",{formname:"urlinput",urlinput:function(){this.close(),ui.puzzle.open(this.form.ta.value.replace(/\n/g,""))}}),ui.popupmgr.addpopup("urloutput",{formname:"urloutput",reset:function(a,b){var c=this.form,d=ui.puzzle.pid,e=pzpr.variety(d).exists;c.ta.value="",c.kanpen.style.display=c.kanpen.nextSibling.style.display=e.kanpen?"":"none",c.heyaapp.style.display=c.heyaapp.nextSibling.style.display="heyawake"===d?"":"none"},show:function(a,b){ui.popupmgr.popups.template.show.call(this,a,b),this.reset(a,b)},urloutput:function(a){var b="",c=pzpr.parser;switch(a.target.name){case"pzprv3":b=ui.puzzle.getURL(c.URL_PZPRV3);break;case"kanpen":b=ui.puzzle.getURL(c.URL_KANPEN);break;case"pzprv3e":b=ui.puzzle.getURL(c.URL_PZPRV3).replace(/\?(\w+)/,"?$1_edit");break;case"heyaapp":b=ui.puzzle.getURL(c.URL_HEYAAPP)}this.form.ta.value=b},openurl:function(a){""!==this.form.ta.value&&window.open(this.form.ta.value,"","")}}),ui.popupmgr.addpopup("fileopen",{formname:"fileform",init:function(){ui.popupmgr.popups.template.init.call(this)},fileopen:function(a){var b=this.form.filebox;if(ui.reader||ui.enableGetText){var c=b.files[0];if(!c)return;ui.reader?ui.reader.readAsText(c):ui.puzzle.open(c.getAsText(""))}this.form.reset(),this.close()}}),ui.popupmgr.addpopup("filesave",{formname:"filesave",anchor:null,init:function(){ui.popupmgr.popups.template.init.call(this),this.anchor=!ui.enableSaveBlob&&pzpr.env.API.anchor_download?a("saveanchor"):null},reset:function(){var a=pzpr.variety(ui.puzzle.pid).exists.pencilbox;this.form.filetype.options[1].disabled=!a,this.form.filetype.options[2].disabled=!a},show:function(a,b){ui.popupmgr.popups.template.show.call(this,a,b),this.form.filename.value=ui.puzzle.pid+".txt",this.changefilename(),ui.puzzle.key.enableKey=!1},close:function(){this.filesaveurl&&URL.revokeObjectURL(this.filesaveurl),ui.popupmgr.popups.template.close.call(this)},changefilename:function(){var a=this.form.filetype.value,b=this.form.filename.value.replace(".xml","").replace(".txt",""),c="filesave4"!==a?".txt":".xml",d=pzpr.variety(b);d.pid===ui.puzzle.pid&&(b="filesave"===a||"filesave3"===a?d.urlid:d.kanpenid),this.form.filename.value=b+c},filesaveurl:null,filesave:function(){for(var a=this.form,b=a.filename.value,c=["\\","/",":","*","?",'"',"<",">","|"],d=0;d<c.length;d++)if(-1!==b.indexOf(c[d]))return void ui.notify.alert("ファイル名として使用できない文字が含まれています。");var e=pzpr.parser,f=e.FILE_PZPR,g={};switch(a.filetype.value){case"filesave2":f=e.FILE_PBOX;break;case"filesave4":f=e.FILE_PBOX_XML;break;case"filesave3":f=e.FILE_PZPR,g.history=!0}var h=null,i=null;ui.enableSaveBlob||this.anchor?h=new Blob([ui.puzzle.getFileData(f,g)],{type:"text/plain"}):i=ui.puzzle.getFileData(f,g),ui.enableSaveBlob?(navigator.saveBlob(h,b),this.close()):this.anchor?(this.filesaveurl&&URL.revokeObjectURL(this.filesaveurl),this.filesaveurl=URL.createObjectURL(h),this.anchor.href=this.filesaveurl,this.anchor.download=b,this.anchor.click()):(a.ques.value=i,a.operation.value="filesave4"!==a.filetype.value?"save":"savexml",a.submit(),this.close()),ui.puzzle.saved()}}),ui.popupmgr.addpopup("imagesave",{formname:"imagesave",anchor:null,showsize:null,init:function(){ui.popupmgr.popups.template.init.call(this),this.anchor=!ui.enableSaveBlob&&pzpr.env.API.anchor_download?a("saveanchor"):null,this.showsize=a("showsize");for(var b=this.form.filetype,c=b.options,d=0;d<c.length;d++){var e=c[d];ui.enableImageType[e.value]||(b.removeChild(e),d--)}},show:function(a,b){ui.popupmgr.popups.template.show.call(this,a,b),ui.puzzle.key.enableKey=!1,ui.puzzle.mouse.enableMouse=!1,this.form.filename.value=pzpr.variety(ui.puzzle.pid).urlid+".png",this.form.cellsize.value=ui.menuconfig.get("cellsizeval"),this.changefilename(),this.estimatesize()},close:function(){this.saveimageurl&&URL.revokeObjectURL(this.saveimageurl),ui.puzzle.setCanvasSize(),ui.popupmgr.popups.template.close.call(this)},changefilename:function(){var a=this.form.filename.value.replace(/\.\w{3,4}$/,".");this.form.filename.value=a+this.form.filetype.value},estimatesize:function(){var a=+this.form.cellsize.value,b=+a*ui.puzzle.painter.getCanvasCols()|0,c=+a*ui.puzzle.painter.getCanvasRows()|0;this.showsize.replaceChild(d.createTextNode(b+" x "+c),this.showsize.firstChild)},saveimageurl:null,saveimage:function(){for(var a=this.form,b=a.filename.value,c=["\\","/",":","*","?",'"',"<",">","|"],d=0;d<c.length;d++)if(-1!==b.indexOf(c[d]))return void ui.notify.alert("ファイル名として使用できない文字が含まれています。");var e={cellsize:+this.form.cellsize.value};this.form.transparent.checked&&(e.bgcolor="");var f=a.filetype.value;try{ui.enableSaveBlob||this.anchor?ui.puzzle.toBlob(function(a){ui.enableSaveBlob?(navigator.saveBlob(a,b),this.close()):(this.filesaveurl&&URL.revokeObjectURL(this.filesaveurl),this.filesaveurl=URL.createObjectURL(a),this.anchor.href=this.filesaveurl,this.anchor.download=b,this.anchor.click(),this.close())}.bind(this),f,1,e):(a.urlstr.value=ui.puzzle.toDataURL(f,1,e).replace(/data:.*;base64,/,""),a.submit(),this.close())}catch(a){ui.notify.alert("画像の出力に失敗しました","Fail to Output the Image")}},openimage:function(){function a(a){var b=this.form.filename.value,f=window.open("","","").document;f.open(),f.writeln('<!DOCTYPE html>\n<HTML LANG="ja">\n<HEAD>'),f.writeln('<META CHARSET="utf-8">'),f.writeln("<TITLE>ぱずぷれv3</TITLE>\n</HEAD><BODY>"),a?(f.writeln('<img src="',e,'"><br>\n'),f.writeln('<a href="',f.defaultView.URL.createObjectURL(a),'" download="',b,'">Download ',b,"</a>")):d&&"svg"===c?f.writeln(e.replace(/^<\?.+?\?>/,"")):f.writeln('<img src="',e,'">'),f.writeln("</BODY>\n</HTML>"),f.close()}var b={cellsize:+this.form.cellsize.value};this.form.transparent.checked&&(b.bgcolor="");var c=this.form.filetype.value,d=navigator.userAgent.match(/(Trident|Edge)\//),e="";try{e=d&&"svg"===c?ui.puzzle.toBuffer("svg",b):ui.puzzle.toDataURL(c,1,b)}catch(a){ui.notify.alert("画像の出力に失敗しました","Fail to Output the Image")}e&&(pzpr.env.API.anchor_download?ui.puzzle.toBlob(a.bind(this),c,1,b):a(null))}}),ui.popupmgr.addpopup("adjust",{formname:"adjust",adjust:function(a){ui.puzzle.board.operate(a.target.name)}}),ui.popupmgr.addpopup("turnflip",{formname:"turnflip",reset:function(){this.form.turnl.disabled="tawa"===ui.puzzle.pid,this.form.turnr.disabled="tawa"===ui.puzzle.pid},adjust:function(a){ui.puzzle.board.operate(a.target.name)}}),ui.popupmgr.addpopup("metadata",{formname:"metadata",show:function(b,c){ui.popupmgr.popups.template.show.call(this,b,c);var d=this.form,e=ui.puzzle,f=e.board,g=e.metadata;a("metadata_variety").innerHTML=pzpr.variety(e.pid)[pzpr.lang]+"&nbsp;"+f.cols+"×"+f.rows,d.author.value=g.author,d.source.value=g.source,d.hard.value=g.hard,d.comment.value=g.comment},save:function(){var a=this.form,b=ui.puzzle,c=b.metadata;c.author=a.author.value,c.source=a.source.value,c.hard=a.hard.value,c.comment=a.comment.value,this.close()}}),ui.popupmgr.addpopup("colors",{formname:"colors",colorElement:!0,init:function(){ui.popupmgr.popups.template.init.call(this),ui.misc.walker(this.form,function(a){var b=ui.customAttr(a.parentNode,"colorTarget")||"";"INPUT"===a.nodeName&&"color"===a.getAttribute("type")&&("color"!==a.type&&(this.colorElement=!1),a.addEventListener("change",function(a){this.setcolor(a,b)}.bind(this),!1)),"BUTTON"===a.nodeName&&a.addEventListener("mousedown",function(a){this.clearcolor(a,b)}.bind(this),!1)}.bind(this))},show:function(a,b){ui.popupmgr.popups.template.show.call(this,a,b),this.refresh()},refresh:function(a){ui.misc.walker(this.form,function(b){if("INPUT"===b.nodeName&&"color"===b.getAttribute("type")){var c=ui.customAttr(b.parentNode,"colorTarget")||"";!c||a&&a!==c||(b.value=this.getdefaultcolor(c))}}.bind(this))},getdefaultcolor:function(a){var b="";if(b="bgcolor"!==a?pzpr.Candle.parse(ui.puzzle.painter[a]):ui.menuconfig.get("color_"+a),this.colorElement)switch(b){case"black":b="#000000";break;case"white":b="#ffffff"}return b},getnamedcolor:function(a){var b=a;if(this.colorElement)switch(a.toLowerCase()){case"#000000":b="black";break;case"#ffffff":b="white"}return b},setcolor:function(a,b){ui.menuconfig.set("color_"+b,this.getnamedcolor(a.target.value))},clearcolor:function(a,b){ui.menuconfig.reset("color_"+b),this.refresh(b)}}),ui.popupmgr.addpopup("dispsize",{formname:"dispsize",show:function(a,b){ui.popupmgr.popups.template.show.call(this,a,b),this.form.cellsize.value=ui.menuconfig.get("cellsizeval"),ui.puzzle.key.enableKey=!1},changesize:function(a){var b=0|this.form.cellsize.value;b>0&&ui.menuconfig.set("cellsizeval",b),this.close()}}),ui.popupmgr.addpopup("credit",{formname:"credit",init:function(){ui.popupmgr.popups.template.init.call(this),a("pzprversion").innerHTML=pzpr.version,a("menualltest").style.display=ui.debugmode?"":"none"},debugalltest:function(){ui.debug.all_test(),this.close()}}),ui.toolarea={items:null,captions:[],reset:function(){null===this.items&&(this.items={},this.walkElement(a("usepanel")),this.walkElement(a("checkpanel")),this.walkElement(a("btnarea"))),ui.misc.displayByPid(a("checkpanel")),ui.misc.displayByPid(a("btnarea")),this.display()},walkElement:function(a){function b(a){return function(b){d[a](b),"click"!==b.type&&(b.preventDefault(),b.stopPropagation())}}function c(a,c,e){pzpr.util.addEvent(a,c,d,b(e))}var d=this;ui.misc.walker(a,function(a){if(1===a.nodeType){if("config"===a.className)d.items[ui.customAttr(a,"config")]={el:a};else if(a.className.match(/child/)){var b=a.parentNode.parentNode,e=ui.customAttr(b,"config"),f=d.items[e];f.children||(f.children=[]),f.children.push(a),c(a,"mousedown","toolclick")}else if("INPUT"===a.nodeName&&"checkbox"===a.type){var b=a.parentNode,e=ui.customAttr(b,"config");if(!e)return;d.items[e].checkbox=a,c(a,"click","toolclick")}var g=ui.customAttr(a,"buttonExec");if(g&&c(a,pzpr.env.API.touchevent?"mousedown":"click",g),g=ui.customAttr(a,"pressExec")){var h=g.split(/,/);c(a,"mousedown",h[0]),g[1]&&(c(a,"mouseup",h[1]),c(a,"mouseleave",h[1]),c(a,"touchcancel",h[1]))}}else 3===a.nodeType&&a.data.match(/^__(.+)__(.+)__$/)&&d.captions.push({textnode:a,str_jp:RegExp.$1,str_en:RegExp.$2})})},display:function(){var b=ui.menuconfig.get("toolarea")?"block":"none";a("usepanel").style.display=b,a("checkpanel").style.display=b,a("separator2").style.display=ui.puzzle.playeronly?"":"none",a("timerpanel").style.display=ui.puzzle.playeronly?"block":"none";for(var c in this.items)this.setdisplay(c);a("btnarea").style.display="",pzpr.util.unselectable(a("btnarea")),this.setdisplay("operation"),a("btnclear2").style.display=ui.puzzle.board.disable_subclear?"none":"",a("btncircle").style.display="pipelinkr"===ui.puzzle.pid?"":"none",a("btncolor").style.display="tentaisho"===ui.puzzle.pid?"":"none",a("btnirowake").style.display=ui.puzzle.painter.irowake&&!ui.menuconfig.get("toolarea")?"":"none",a("btnirowakeblk").style.display=ui.puzzle.painter.irowakeblk&&!ui.menuconfig.get("toolarea")?"":"none",this.setdisplay("trialmode");for(var d=0;d<this.captions.length;d++){var e=this.captions[d];e.textnode.data=ui.selectStr(e.str_jp,e.str_en)}},setdisplay:function(b){if("operation"===b){var c=ui.puzzle.opemgr;a("btnundo").style.color=c.enableUndo?"":"silver",a("btnredo").style.color=c.enableRedo?"":"silver"}else if("trialmode"===b){var d=ui.puzzle.board.trialstage;a("btntrial").style.color=d>0?"silver":"",a("btntrialarea").style.display=d>0?"block":"none",a("btntrialr").style.display=d<=1?"":"none",a("btntrialr2").style.display=d>1?"":"none",a("btntrialra").style.display=d>1?"":"none"}else if(null!==this.items&&this.items[b])if(ui.menuconfig.valid(b)){var e=this.items[b];if(e.el.style.display="",e.children){for(var f=e.children,g="inputmode"===b?ui.puzzle.mouse.getInputModeList():null,h=0;h<f.length;h++){var i=f[h],j=ui.customAttr(i,"value"),k=j===""+ui.menuconfig.get(b);i.className=k?"child childsel":"child",i.style.display=null===g||g.indexOf(j)>=0?"":"none"}var l=null;"inputmode"===b&&(l=1===g.length),null!==l&&(e.el.className=l?"disabled":"")}else if(e.checkbox){var m=e.checkbox;m&&(m.checked=ui.menuconfig.get(b));var l=null;"keypopup"===b&&(l=!ui.keypopup.paneltype[ui.puzzle.editmode?1:3]),"bgcolor"===b&&(l=ui.puzzle.editmode),"passallcell"===b&&(l=!ui.puzzle.editmode),null!==l&&(e.checkbox.disabled=l?"true":"")}"disptype_pipelinkr"===b&&a("btncircle")&&(a("btncircle").innerHTML=1===ui.menuconfig.get(b)?"○":"■")}else this.items[b]&&(this.items[b].el.style.display="none");else;},toolclick:function(a){var b,c=a.target,d=c.parentNode,e=ui.customAttr(d,"config")||ui.customAttr(d.parentNode,"config");b=this.items[e].checkbox?!!c.checked:ui.customAttr(c,"value"),ui.menuconfig.set(e,b)},answercheck:function(){ui.menuarea.answercheck()},undo:function(){ui.undotimer.startButtonUndo()},undostop:function(){ui.undotimer.stopButtonUndo()},redo:function(){ui.undotimer.startButtonRedo()},redostop:function(){ui.undotimer.stopButtonRedo()},ansclear:function(){ui.menuarea.ACconfirm()},subclear:function(){ui.menuarea.ASconfirm()},irowake:function(){ui.puzzle.irowake()},encolorall:function(){ui.puzzle.board.encolorall()},dropblocks:function(){ui.puzzle.board.operate("drop")},resetblocks:function(){ui.puzzle.board.operate("resetpos")},showgatenum:function(){ui.puzzle.board.operate("showgatenumber")},hidegatenum:function(){ui.puzzle.board.operate("hidegatenumber")},enterTrial:function(){0===ui.puzzle.board.trialstage&&ui.puzzle.enterTrial()},enterFurtherTrial:function(){ui.puzzle.enterTrial()},acceptTrial:function(){ui.puzzle.acceptTrial()},rejectTrial:function(){ui.puzzle.rejectTrial()},rejectCurrentTrial:function(){ui.puzzle.rejectCurrentTrial()},toggledisp:function(){var a=ui.menuconfig.get("disptype_pipelinkr");ui.menuconfig.set("disptype_pipelinkr",1===a?2:1)}},ui.notify={onconfirm:null,reset:function(){this.walkElement(a("notifies"))},walkElement:function(a){var b=this;ui.misc.walker(a,function(a){if(1===a.nodeType){var c=ui.customAttr(a,"buttonExec");c&&pzpr.util.addEvent(a,pzpr.env.API.touchevent?"mousedown":"click",b,b[c]),"titlebar"===a.className&&pzpr.util.addEvent(a,"mousedown",ui.popupmgr,ui.popupmgr.titlebardown)}})},alert:function(b,c){a("notification").innerHTML=ui.selectStr(b,c),this.setVerticalPosition(a("assertbox"))},confirm:function(b,c,d){a("confirmcaption").innerHTML=ui.selectStr(b,c),this.setVerticalPosition(a("confirmbox")),this.onconfirm=d},setVerticalPosition:function(b){var c=a("notifybg");c.style.display="block",b.style.display="inline-block";var d=pzpr.util.getRect(b),e=pzpr.util.getRect(c);b.style.top=(e.height-d.height)/2+"px",b.style.left=(e.width-d.width)/2+"px"},closealert:function(b){a("assertbox").style.display="none",a("notifybg").style.display="none",b.preventDefault(),b.stopPropagation()},confirmtrue:function(a){this.onconfirm&&this.onconfirm(),this.onconfirm=null,this.confirmfalse(a)},confirmfalse:function(b){a("confirmbox").style.display="none",a("notifybg").style.display="none",b.preventDefault(),b.stopPropagation()}},ui.keypopup={paneltype:{1:0,3:0},element:null,tdcolor:"black",imgCR:[1,1],imgs:[],basepanel:null,clearflag:!1,type:{slither:[3,0],nawabari:[4,0],fourcells:[4,0],fivecells:[4,0],fillmat:[4,0],paintarea:[4,0],lightup:[4,0],shakashaka:[4,0],gokigen:[4,0],wagiri:[4,0],shugaku:[4,0],creek:[4,0],ichimaga:[4,0],ichimagam:[4,0],ichimagax:[4,0],sukoro:[4,4],sukororoom:[4,4],lookair:[5,0],tawa:[6,0],hashikake:[8,0],tapa:[8,0],amibo:[10,0],bag:[10,0],bdblock:[10,0],country:[10,0],usotatami:[10,0],heyawake:[10,0],ayeheya:[10,0],kurodoko:[10,0],nagenawa:[10,0],ringring:[10,0],numlin:[10,0],nurikabe:[10,0],nuribou:[10,0],mochikoro:[10,0],mochinyoro:[10,0],shikaku:[10,0],aho:[10,0],shimaguni:[10,0],chocona:[10,0],yajitatami:[10,0],tasquare:[10,0],kurotto:[10,0],bonsan:[10,0],heyabon:[10,0],rectslider:[10,0],satogaeri:[10,0],yosenabe:[10,0],herugolf:[10,0],firefly:[10,0],tateyoko:[10,0],factors:[10,10],fillomino:[10,10],renban:[10,10],ripple:[10,10],cojun:[10,10],makaro:[10,10],sudoku:[10,10],nanro:[10,10],view:[10,10],kakuru:[10,10],kazunori:[10,10],building:[10,10],kropki:[10,10],tilepaint:[51,0],triplace:[51,0],kakuro:[51,10],slalom:[101,0],reflect:[102,0],pipelink:[111,0],pipelinkr:[111,0],loopsp:[111,0],tatamibari:[112,0],hakoiri:[113,113],kusabi:[114,0]},display:function(){var b=ui.puzzle.editmode?1:3;this.element&&this.paneltype[b]&&ui.menuconfig.get("keypopup")?(this.element.style.display="block",a("panelbase1").style.display=1===b?"block":"none",a("panelbase3").style.display=3===b?"block":"none"):this.element&&(this.element.style.display="none")},create:function(){this.element&&(a("panelbase1").innerHTML="",a("panelbase3").innerHTML=""),this.imgs=[];var b=this.type[ui.puzzle.pid];if(b||(b=[0,0]),this.paneltype={1:ui.puzzle.playeronly?0:b[0],3:b[1]},this.paneltype[1]||this.paneltype[3]){if(!this.element){var c=pzpr.util.getRect(a("divques"));this.element=a("keypopup"),this.element.style.left=c.left+48+"px",this.element.style.top=c.top+48+"px",pzpr.util.unselectable(this.element)}0!==this.paneltype[1]&&this.createtable(1),0!==this.paneltype[3]&&this.createtable(3),this.resizepanel();var d=a("barkeypopup");ui.event.addEvent(d,"mousedown",ui.popupmgr,ui.popupmgr.titlebardown),ui.event.addEvent(d,"dblclick",ui.menuconfig,function(){this.set("keypopup",!1)})}},createtable:function(b,c){this.basepanel=a("panelbase"+b),this.basepanel.innerHTML="",this.tdcolor=3===b?ui.puzzle.painter.fontAnscolor:"black",this.generate(b)},generate:function(a){var b=this.paneltype[a];4===b?this.gentable4(a):10===b?this.gentable10(a):51===b?this.gentable51(a):3===b?this.gentable3(a):5===b?this.gentable5(a):6===b?this.gentable6(a):8===b?this.gentable8(a):101===b?this.generate_slalom(a):102===b?this.generate_reflect(a):111===b?this.generate_pipelink(a):112===b?this.generate_tatamibari(a):113===b?this.generate_hakoiri(a):114===b&&this.generate_kusabi(a)},gentable4:function(a){var b=ui.puzzle.pid,c=["1","2","3","4"];if(3!==a||"sukoro"!==b&&"sukororoom"!==b){var d="?";if(ui.puzzle.painter.hideHatena)switch(b){case"lightup":case"shakashaka":d="■";break;case"gokigen":case"wagiri":case"shugaku":case"creek":d="○"}c.push("0",null," ",["-",d])}else{var e=ui.puzzle.painter.mbcolor;c.push(["q",{text:"○",color:e}],["w",{text:"×",color:e}]," ",null)}this.generate_main(c,4)},gentable10:function(a){var b=ui.puzzle.pid,c=[];if(3===a&&ui.puzzle.klass.Cell.prototype.numberWithMB){var d=ui.puzzle.painter.mbcolor;c.push(["q",{text:"○",color:d}],["w",{text:"×",color:d}]," ",null)}1!==a||"kakuru"!==b&&"tateyoko"!==b||c.push(["q1","■"],["w2","□"]," ",["-","?"]),c.push("0","1","2","3","4","5","6","7","8","9"),c.push(1!==a&&ui.puzzle.klass.Cell.prototype.numberWithMB?null:" ");var e=null;3===a||"kakuru"===b||"tateyoko"===b||(ui.puzzle.painter.hideHatena?"tasquare"===b?e="□":"rectslider"===b?e="■":"kurotto"!==b&&"bonsan"!==b&&"satogaeri"!==b&&"heyabon"!==b&&"yosenabe"!==b&&"herugolf"!==b&&"kazunori"!==b||(e="○"):e="?"),null!==e&&c.push(["-",e]),this.generate_main(c,4)},gentable51:function(a){this.generate_main([["q",{image:0}]," ","1","2","3","4","5","6","7","8","9","0"],4)},gentable3:function(a){this.generate_main(["1","2","3","0"," ",["-","?"]],3)},gentable5:function(a){this.generate_main(["1","2","3","4","5",null,"0"," ",["-","?"]],3)},gentable6:function(a){this.generate_main(["1","2","3","4","5","6","0"," ",["-","?"]],3)},gentable8:function(a){"tapa"!==ui.puzzle.pid?this.generate_main(["1","2","3","4","5","6","7","8"," ",["-","○"]],4):this.generate_main(["1","2","3","4","5","6","7","8","0"," ",["-","?"]],4)},generate_slalom:function(a){this.imgCR=[4,1],this.generate_main([["q",{image:0}],["s",{image:1}],["w",{image:2}],["e",{image:3}],["r"," "],"1","2","3","4","5","6","7","8","9","0","-"," "],5)},generate_reflect:function(a){this.imgCR=[4,1],this.generate_main([["q",{image:0}],["w",{image:1}],["e",{image:2}],["r",{image:3}],["t","╋"],["y"," "],"1","2","3","4","5","6","7","8","9","0","-"],6)},generate_pipelink:function(a){var b=ui.puzzle.pid,c=[];c.push(["q","╋"],["w","┃"],["e","━"],["r"," "],"loopsp"!==b?["-","?"]:null,["a","┗"],["s","┛"],["d","┓"],["f","┏"]),"pipelink"===b?c.push(null):"pipelinkr"===b?c.push(["1","○"]):"loopsp"===b&&c.push(["-","○"]),"loopsp"===b&&c.push("1","2","3","4","5","6","7","8","9","0"),this.generate_main(c,5)},generate_tatamibari:function(a){this.generate_main([["q","╋"],["w","┃"],["e","━"],["r"," "],["-","?"]],3)},generate_hakoiri:function(a){this.generate_main([["1","○"],["2","△"],["3","□"],["4",{text:1===a?"?":"・",color:3===a?"rgb(255, 96, 191)":""}]," "],3)},generate_kusabi:function(a){this.generate_main([["1","同"],["2","短"],["3","長"],["-","○"]," "],3)},generate_main:function(a,b){for(var c=0;c<a.length;c++)this.inputcol(a[c]),(c+1)%b==0&&this.insertrow();c%b!=0&&this.insertrow()},inputcol:function(a){var c,d,e="num",f=this.tdcolor;a?"string"==typeof a?c=d=a:"string"==typeof a[1]?(c=a[0],d=a[1]):a[1].text?(c=a[0],d=a[1].text,f=a[1].color):void 0!==a[1].image&&(c=a[0],d=a[1].image,e="image"):e="empty";var g=null,h=null;if("empty"!==e?(g=b("div"),g.className="kpcell kpcellvalid",g.onclick=function(a){a.preventDefault()},ui.event.addEvent(g,"mousedown",ui.puzzle,function(a){this.key.keyevent(c,0),a.preventDefault(),a.stopPropagation()}),pzpr.util.unselectable(g)):(g=b("div"),g.className="kpcell kpcellempty",pzpr.util.unselectable(g)),"num"===e)h=b("span"),h.className="kpnum",h.style.color=f,h.innerHTML=d,pzpr.util.unselectable(h);else if("image"===e){h=b("img"),h.className="kpimg";var i=ui.puzzle.pid;h.src="data:image/gif;base64,"+this.dataurl[this.dataurl[i]?i:"shitappa"],pzpr.util.unselectable(h);var j=d%this.imgCR[0],k=(d-j)/this.imgCR[1];this.imgs.push({el:h,x:j,y:k})}this.clearflag&&(g.style.clear="both",this.clearflag=!1),h&&g.appendChild(h),this.basepanel.appendChild(g)},insertrow:function(){this.clearflag=!0},resizepanel:function(){var a=Math.min(ui.puzzle.painter.cw,120);a<20&&(a=20);for(var b=.9*a|0,c=.7*a|0,d=0,e=this.imgs.length;d<e;d++){var f=this.imgs[d],g=f.el;g.style.width=b*this.imgCR[0]+"px",g.style.height=b*this.imgCR[1]+"px",g.style.clip="rect("+(b*f.y+1)+"px,"+b*(f.x+1)+"px,"+b*(f.y+1)+"px,"+(b*f.x+1)+"px)",g.style.top="-"+f.y*b+"px",g.style.left="-"+f.x*b+"px"}ui.misc.modifyCSS({"div.kpcell":{width:b+"px",height:b+"px",lineHeight:b+"px"},"span.kpnum":{fontSize:c+"px"}})},dataurl:{slalom:"R0lGODlhAAFAAMIEAAICAmBgYJ+fn///////AP//AP//AP//ACH5BAEKAAQALAAAAAAAAUAAAAP+OLrc/jDKSau9OOvNu/9gKI5kaZ5oqq5s675wLM90bd94ru+24AdAH68BKBqHNqNyyWw6n9DSD2oMCHhMZI3K7XqLI0Hgq7TmstoZec0GhMTt8jW5TKvj+OhnnFfOaWh2MH2EdR0ChUtmd0qCMYmJHXxOQFZ/P5OUjEeOL5CFHJmKfxFTmp2oIZ+EG6JVpBVwTQGptR2rfRquAIsbiLO2wRi4eRm7tB+yS7DCzQ7EeBi/yyO7zCiBziTQcRfTfiWuyCzZ2iLcbReu1yDrLeXmIOhsFt9F7CGu74bx5/NkFkSNO2EPAL4R8Prd+vclFpODbxKWkKhQA8OGFAS2EAX+UR6/ih4ueqFQsGPEMiCDieySUZGLkilrreTSEpwLjjFTzaRCweULewNz2tmpR4JPTyhTUBQ6geiTCUBjiFKxlGkEp06gUoMxVelHqxawNpmAE4Y9kxyqevw4dkFbt+XeQhBbtezPrSfUfpDLN67fr8/oNpLQ1SxeE3pDZuv7Ve4Ax4EFgyF8uMVZr4MxZ368+O9mzoCJSJ5cqjILeyAZb3bMuupo0hAucw3tTDUnBa0bu36tNemLwmCRvHbT1Lflo8GHDO9JG0XU5MJ5kzWdwm7e5tBFjyaJXAVMzbCzX5Ve3OaK5+CJizdKnrLx9GgXfl4fWbJD6iQ0rkgMfXmvBX0pfEcVdvT5x113+SF43Xz0MWBgTeYliF+DgLTH3IShMBEUhTc8eCCGxjQRH4fkWAjhe744MSKJ+5l4YoQhisjiDh4GRMmKBRmx4lq3zQiafa08YQlUu+goA3/J1agOFUH44CQQXOyoCoHrKelNkXj08giV4lkpTSJaHslldl5Kg2UXYW4SHotlapAjk1Iu2KOPVplCyZB05pmDk0Lo6eefgAYq6KCEFmrooSwkAAA7",reflect:"R0lGODlhAAFAAIABAAAAAP///yH5BAEKAAEALAAAAAAAAUAAAAL+jI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6bgD8H/A9AMSi8YhMKpdJCPMJjSKdQiCOGJFqt9Mh96vNYq22ogSMflLT7OPZTJ4ZJ+362GGv0+dxmHufh7YW+EXR1cdy+EbINcgoVdGEqCJp+BjmdRlloTSJ0smpCeUoWmlp6hmyhFHKRNoKFwqaCuLKCqvIgJt7OkvLoZaxy4c3fHcx+ruRLGz8WrrMrCxrq+GciQu8OR25HZ2N3dqByS3m/S0eLuqxVf7si76ufvnR6K7bXp9eDK2ff4+gUK1+/DSpEggwCEJ/9OYFEiEIYMSDDQsyGpHmXkb+jBUbGOQ4URmbEh3xXSTRZlpKkict2jGhh1ZMlg8dbqQ50tPLE4Tegfm0s0+eFDVd3oQ5NE5RnkE9NkWaFEhPSjOdriQ6lUdLrDmN2qOaNcejFlethuQatsxYskdN/mS7Vm3cRGcXtAU7V4Y8F3UV9EWb9wVBvgvdkiO8V/BgxIcNn2P8EXJJycG8rtILi3JgzfDsNlacecWuGp/9QqIxDO8+OY89S8M8mmls0q9dV0N9DWVu2rcd84KdGmTwG5XNosJtrArD4cQvW1YuN/nA5NCj/7G8g3qseLuvHDf9m7d2bdqrN79u/JjY8uq7sZeK3jF89ubNvZ/fHnx+7/Q96z9nrtV2bpHRn4A2SUfgfgEpyF+BiziolH8HMNgghP8hqJQTCW3IYYcefghiiCKOSGKJJp6IYooqrlhOAQA7",shitappa:"R0lGODlhQABAAIABAAAAAP//ACH5BAEKAAEALAAAAABAAEAAAAL6jI+py+0Po5y02ouz3rz7DwHiSJbmiaZnqLbuW7LwTMdPjdcyCUb8veo5fkOUsEFEjgK2YyLJ+DWdBuiCOHVaFcmscPtcIrwg8Fh8Rn/VUXbVvIG/RW13R860z+k9PJys4ad3AIghyFc0aHEI4IMnwQj5uEMpqWjZCIToeFmZmDlRyAmqtIlJWhG5OMnVyRrWeeUaW2c66nkhKmvbykuhC4u6K7xKm+ebRlyMHIwb+Kh6F12qbCg3La2InY28za3s/T3sXGYV7pF1jt41y7yOpv5hEy/PQ18f9Ek1fF8OnAPwxY6ABP8VPMgIYcF9DBs6fAgxosSJFBMUAAA7"}},ui.ProblemData=function(){this.id=null,this.pdata="",this.time=0,arguments.length>0&&this.parse(arguments[0])},ui.ProblemData.prototype={updatePuzzleData:function(a){var b=ui.puzzle,c=b.board;this.id=a,this.pdata=b.getFileData(pzpr.parser.FILE_PZPR).replace(/\r?\n/g,"/"),this.time=pzpr.util.currentTime()/1e3|0,this.pid=b.pid,this.col=c.cols,this.row=c.rows},updateMetaData:function(){var a=new pzpr.MetaData,b=document.database;a.comment=b.comtext.value,a.hard=b.hard.value,a.author=b.author.value,a.source=b.source.value;var c=pzpr.parser(this.pdata);return c.metadata.update(a),this.pdata=c.generate(),a},getFileData:function(){return this.pdata.replace(/\//g,"\n")},toString:function(){var a={id:this.id,pdata:this.pdata,time:this.time};return JSON.stringify(a)},parse:function(a){if(void 0===a)return this.id=null,this;var b=JSON.parse(a);for(var c in b)this[c]=b[c];var d=pzpr.parser(this.pdata);return this.pid=d.pid,this.col=d.cols,this.row=d.rows,this}},ui.popupmgr.addpopup("database",{formname:"database",show:function(a,b){ui.popupmgr.popups.template.show.call(this,a,b),ui.database.openDialog()},close:function(){ui.database.closeDialog(),ui.popupmgr.popups.template.close.call(this)},database_handler:function(a){ui.database.clickHandler(a.target.name)}}),ui.database={dbh:null,DBsid:-1,DBlist:[],sync:!1,update:function(){ui.database.updateDialog()},openDialog:function(){this.dbh=new ui.DataBaseHandler_LS(this),this.sync=!1,this.dbh.convert(),this.dbh.importDBlist()},closeDialog:function(){this.DBlist=[]},clickHandler:function(a){if(!1!==this.sync)switch(a){case"sorts":this.displayDataTableList();case"datalist":this.selectDataTable();break;case"tableup":this.upDataTable();break;case"tabledn":this.downDataTable();break;case"open":this.openDataTable();break;case"save":case"overwrite":this.saveDataTable();break;case"updateinfo":this.updateInfo();break;case"del":this.deleteDataTable()}},getDataID:function(){var a=document.database.datalist.value;if("new"!==a&&""!==a)for(var b=0;b<this.DBlist.length;b++)if(this.DBlist[b].id==a)return b;return-1},updateDialog:function(){this.dbh.updateManageData(),this.displayDataTableList(),this.selectDataTable(),this.sync=!0},displayDataTableList:function(){switch(document.database.sorts.value){case"idlist":this.DBlist=this.DBlist.sort(function(a,b){return a.id-b.id});break;case"newsave":this.DBlist=this.DBlist.sort(function(a,b){return b.time-a.time||a.id-b.id});break;case"oldsave":this.DBlist=this.DBlist.sort(function(a,b){return a.time-b.time||a.id-b.id});break;case"size":this.DBlist=this.DBlist.sort(function(a,b){return a.col-b.col||a.row-b.row||a.id-b.id})}document.database.datalist.innerHTML="";for(var a=0;a<this.DBlist.length;a++){var b=this.DBlist[a];b&&this.appendNewOption(b.id,this.getRowString(b))}this.appendNewOption(-1,ui.selectStr("&nbsp;&lt;新しく保存する&gt;","&nbsp;&lt;New Save&gt;"))},appendNewOption:function(a,c){var d=b("option");d.setAttribute("value",-1!=a?a:"new"),d.innerHTML=c,this.DBsid==a&&d.setAttribute("selected","selected"),document.database.datalist.appendChild(d)},getRowString:function(a){var b="";return b+=(a.id<10?"&nbsp;":"")+a.id+" :&nbsp;",b+=pzpr.variety(a.pid)[pzpr.lang]+"&nbsp;",b+=a.col+"×"+a.row+" &nbsp;",b+=pzpr.parser(a.pdata).metadata.hard+"&nbsp;",b+="("+this.dateString(1e3*a.time)+")"},dateString:function(a){function b(a){return(a<10?"0":"")+a}var c=new Date;return c.setTime(a),b(c.getFullYear()%100)+"/"+b(c.getMonth()+1)+"/"+b(c.getDate())+" "+b(c.getHours())+":"+b(c.getMinutes())},selectDataTable:function(){var b,c,d=this.getDataID(),e=document.database;d>=0?(b=this.DBlist[d],c=pzpr.parser(b.pdata).metadata,a("database_cand").innerHTML=""):(b=new ui.ProblemData,
b.updatePuzzleData(-1),c=ui.puzzle.metadata,a("database_cand").innerHTML=ui.selectStr("(新規保存)","(Candidate)")),e.comtext.value=""+c.comment,e.hard.value=""+c.hard,e.author.value=""+c.author,e.source.value=""+c.source,a("database_info").innerHTML=pzpr.variety(b.pid)[pzpr.lang]+"&nbsp;"+b.col+"×"+b.row+"&nbsp;&nbsp;&nbsp;("+this.dateString(1e3*b.time)+")";var f=this.DBsid=+b.id,g="idlist"===e.sorts.value;e.tableup.disabled=!g||-1===f||1===f,e.tabledn.disabled=!g||-1===f||f===this.DBlist.length,e.updateinfo.disabled=-1===f,e.open.style.color=-1===f?"silver":"",e.del.style.color=-1===f?"silver":"",e.save.style.display=-1===f?"":"none",e.overwrite.style.display=-1===f?"none":""},upDataTable:function(){var a=this.getDataID();-1!==a&&0!==a&&this.convertDataTable(a,a-1)},downDataTable:function(){var a=this.getDataID();-1!==a&&a!==this.DBlist.length-1&&this.convertDataTable(a,a+1)},convertDataTable:function(a,b){this.DBsid=this.DBlist[b].id;var c=this.DBlist[a].id;this.DBlist[a].id=this.DBlist[b].id,this.DBlist[b].id=c;var d=this.DBlist[a];this.DBlist[a]=this.DBlist[b],this.DBlist[b]=d,this.sync=!1,this.dbh.saveItem(a,b)},openDataTable:function(){var a=this.getDataID();if(-1!==a){var b=this.DBlist[a].getFileData();ui.notify.confirm("このデータを読み込みますか？ (現在の盤面は破棄されます)","Recover selected data? (Current board is erased)",function(){ui.puzzle.open(b)})}},saveDataTable:function(){function a(){var a=c.DBlist,d=a[b];-1===b&&(b=a.length,d=a[b]=new ui.ProblemData),d.updatePuzzleData(b+1);var e=d.updateMetaData();ui.puzzle.metadata.update(e),c.DBsid=d.id,c.sync=!1,c.dbh.saveItem(b)}var b=this.getDataID(),c=this;-1===b?a():ui.notify.confirm("このデータに上書きしますか？","Overwrite selected data?",a)},updateInfo:function(){var a=this.getDataID();-1!==a&&(this.DBlist[a].updateMetaData(),this.sync=!1,this.dbh.saveItem(a))},deleteDataTable:function(){var a=this.getDataID(),b=this;-1!==a&&ui.notify.confirm("このデータを完全に削除しますか？","Delete selected data?",function(){for(var c=b.DBlist,d=c[a].id,e=c.length,f=d-1;f<e-1;f++)c[f]=c[f+1],c[f].id--;c.pop(),b.sync=!1,b.dbh.deleteItem(d,e)})}},ui.DataBaseHandler_LS=function(a){this.pheader="pzprv3_storage:data:",this.parent=a,this.currentVersion=localStorage["pzprv3_storage:version"]||"0",this.createManageDataTable(),this.createDataBase()},ui.DataBaseHandler_LS.prototype={importDBlist:function(){this.parent.DBlist=[];for(var a=1;!0;a++){var b=new ui.ProblemData(localStorage[this.pheader+a]);if(null===b.id)break;this.parent.DBlist.push(b)}this.parent.update()},createManageDataTable:function(){localStorage["pzprv3_storage:version"]="3.0"},updateManageData:function(){localStorage["pzprv3_storage:count"]=this.parent.DBlist.length,localStorage["pzprv3_storage:time"]=pzpr.util.currentTime()/1e3|0},createDataBase:function(){},saveItem:function(){for(var a=arguments,b=0;b<a.length;b++){var c=this.parent.DBlist[a[b]];localStorage[this.pheader+c.id]=c.toString()}this.parent.update()},deleteItem:function(a,b){for(var c=+a;c<b;c++){var d=new ui.ProblemData(localStorage[this.pheader+(c+1)]);d.id--,localStorage[this.pheader+c]=d.toString()}localStorage.removeItem(this.pheader+b),this.parent.update()},convert:function(){localStorage.pzprv3_manage?this.convertfrom1():"2.0"===this.currentVersion&&this.convertfrom2(),this.currentVersion="3.0"},hardstr:[{ja:"−",en:"-"},{ja:"らくらく",en:"Easy"},{ja:"おてごろ",en:"Normal"},{ja:"たいへん",en:"Hard"},{ja:"アゼン",en:"Expert"}],convertfrom2:function(){for(var a=1;!0;a++){var b=new ui.ProblemData(localStorage[this.pheader+a]);if(null===b.id)break;var c=pzpr.parser(b.pdata);"0"!=b.hard&&(c.metadata.hard=this.hardstr[b.hard][pzpr.lang]),b.comment&&(c.metadata.comment=b.comment),b.pdata=c.generate(),localStorage[this.pheader+a]=b.toString()}},convertfrom1:function(){var a=["id","col","row","hard","pdata","time","comment"],b=0;delete localStorage.pzprv3_manage,delete localStorage["pzprv3_manage:manage"];var c=[];for(var d in pzpr.variety.info)if(localStorage["pzprv3_"+d]){var e="pzprv3_manage:manage!"+d+"!",f=localStorage[e+"count"],g=localStorage[e+"time"];delete localStorage[e+"count"],delete localStorage[e+"time"],g>0&&(g=0),b+=f,delete localStorage["pzprv3_"+d],delete localStorage["pzprv3_"+d+":puzdata"];for(var h=0;h<f;h++){for(var i="pzprv3_"+d+":puzdata!"+(h+1)+"!",j=new ui.ProblemData,k=0;k<7;k++)j[a[k]]=localStorage[i+a[k]],delete localStorage[i+a[k]];var l=pzpr.parser(j.pdata);l.metadata.hard=this.hardstr[j.hard][pzpr.lang],l.metadata.comment=j.comment,j.pdata=l.generate(),delete j.hard,delete j.comment,delete j.col,delete j.row,c.push(j)}}c.sort(function(a,b){return a.time-b.time||a.id-b.id}),localStorage["pzprv3_storage:version"]="3.0",localStorage["pzprv3_storage:count"]=c.length,localStorage["pzprv3_storage:time"]=pzpr.util.currentTime()/1e3|0;for(var h=0;h<c.length;h++)c[h].id=h+1,localStorage["pzprv3_storage:data:"+(h+1)]=c[h].toString()}},function(){ui.timer={TID:null,current:0,bseconds:0,timerEL:null,worstACtime:0,nextACtime:0,reset:function(){this.worstACtime=0,this.timerEL=document.getElementById("timerpanel"),this.timerEL.innerHTML=this.label()+"00:00",clearInterval(this.TID),this.start()},start:function(){var a=this;this.TID=setInterval(function(){a.update()},100)},stop:function(){clearInterval(this.TID)},update:function(){this.current=pzpr.util.currentTime(),ui.puzzle.playeronly&&this.updatetime(),ui.menuconfig.get("autocheck_once")&&!ui.debug.alltimer&&this.ACcheck()},updatetime:function(){var a=ui.puzzle.getTime()/1e3|0;if(this.bseconds!==a){var b=a/3600|0,c=(a/60|0)-60*b;a=a-60*c-3600*b,c<10&&(c="0"+c),a<10&&(a="0"+a),this.timerEL.innerHTML=[this.label(),b?b+":":"",c,":",a].join(""),this.bseconds=a}},label:function(){return ui.selectStr("経過時間：","Time: ")},ACcheck:function(){var a=ui.puzzle;if(this.current>this.nextACtime&&a.playmode&&!a.checker.inCheck&&0===a.board.trialstage){var b=a.check(!1);if(b.complete)return ui.timer.stop(),a.mouse.mousereset(),ui.menuconfig.set("autocheck_once",!1),ui.callbackComplete&&ui.callbackComplete(a,b),void ui.notify.alert("正解です！","Complete!");this.worstACtime=Math.max(this.worstACtime,pzpr.util.currentTime()-this.current),this.nextACtime=this.current+(this.worstACtime<250?4*this.worstACtime+120:2*this.worstACtime+620)}}};ui.undotimer={TID:null,inUNDO:0,inREDO:0,reset:function(){this.stop()},startKeyUndo:function(){this.startUndo(1)},startKeyRedo:function(){this.startRedo(1)},startButtonUndo:function(){this.startUndo(2)},startButtonRedo:function(){this.startRedo(2)},startAnswerUndo:function(){this.startUndo(4)},startAnswerRedo:function(){this.startRedo(4)},stopKeyUndo:function(){this.stopUndo(1)},stopKeyRedo:function(){this.stopRedo(1)},stopButtonUndo:function(){this.stopUndo(2)},stopButtonRedo:function(){this.stopRedo(2)},startUndo:function(a){this.inUNDO&a||(this.inUNDO|=a,this.proc())},startRedo:function(a){this.inREDO&a||(this.inREDO|=a,this.proc())},stopUndo:function(a){this.inUNDO&a&&(this.inUNDO&=~a,this.proc())},stopRedo:function(a){this.inREDO&a&&(this.inREDO&=~a,this.proc())},start:function(){function a(){c.proc()}function b(){clearInterval(c.TID),c.TID=setInterval(a,25)}var c=this;this.TID=setInterval(b,300),this.exec()},stop:function(){this.inUNDO=0,this.inREDO=0,clearInterval(this.TID),this.TID=null},proc:function(){this.inUNDO|this.inREDO&&!this.TID?this.start():this.inUNDO|this.inREDO||!this.TID?this.TID&&this.exec():this.stop()},exec:function(){this.checknextprop()?this.inUNDO?ui.puzzle.undo():this.inREDO&&ui.puzzle.redo():this.stop()},checknextprop:function(){var a=ui.puzzle.opemgr,b=this.inUNDO&&a.enableUndo||this.inREDO&&a.enableRedo;if(b&&"goishi"===ui.puzzle.pid)if(4===this.inUNDO){var c=a.ope[a.position-1];b="anum"===c[c.length-1].property}else if(4===this.inREDO){var c=a.ope[a.position];b="anum"===c[0].property}return b}}}(),ui.popupmgr.addpopup("debug",{formname:"debug",multipopup:!0,init:function(){if(ui.popupmgr.popups.template.init.call(this),!ui.debugmode){var a=this.form;a.starttest.style.display="none",a.all_test.style.display="none",a.loadperf.style.display="none",a.inputcheck_popup.style.display="none"}},handler:function(a){ui.debug[a.target.name]()},show:function(a,b){ui.popupmgr.popups.template.show.call(this,40,80)}}),ui.debug={extend:function(a){for(var b in a)this[b]=a[b]},keydown:function(a){if("alt+p"!==a)return!1;this.disppoptest(),ui.puzzle.key.cancelEvent=!0},disppoptest:function(){ui.popupmgr.popups.debug.show()},filesave:function(){this.setTA(ui.puzzle.getFileData(pzpr.parser.FILE_PZPR,{history:!0}))},filesave_pencilbox:function(){pzpr.variety(ui.puzzle.pid).exists.pencilbox?this.setTA(ui.puzzle.getFileData(pzpr.parser.FILE_PBOX)):this.setTA("")},filesave_pencilbox_xml:function(){pzpr.variety(ui.puzzle.pid).exists.pencilbox?this.setTA(ui.puzzle.getFileData(pzpr.parser.FILE_PBOX_XML).replace(/\>/g,">\n")):this.setTA("")},fileopen:function(){ui.puzzle.open(this.getTA())},erasetext:function(){this.setTA("")},perfeval:function(){var a=ui.puzzle.checker;this.timeeval("正答判定",function(){a.resetCache(),a.checkAns()})},painteval:function(){this.timeeval("描画時間",function(){ui.puzzle.redraw()})},resizeeval:function(){this.timeeval("resize描画",function(){ui.puzzle.redraw(!0)})},searcheval:function(){var a=ui.puzzle.board.linegraph;a.rebuild();for(var b=[],c=0;c<a.components.length;c++)b=b.concat(a.components[c].nodes);this.timeeval("search linemgr",function(){a.components=[],a.modifyNodes=b,a.searchGraph()})},rebuildeval:function(){var a=ui.puzzle.board.linegraph;this.timeeval("reset linemgr",function(){a.rebuild()})},timeeval:function(a,b){for(var c=0,d=pzpr.util.currentTime();pzpr.util.currentTime()-d<3e3;)c++,b();var e=pzpr.util.currentTime()-d;this.addTA(a+" ave. "+e/c+"ms")},dispdatabase:function(){for(var a="",b=0;b<localStorage.length;b++){var c=localStorage.key(b);c.match(/^pzprv3/)&&(a+=c+" "+localStorage[c]+"\n")}this.setTA(a)},getTA:function(){return document.getElementById("testarea").value},setTA:function(a){document.getElementById("testarea").value=a},addTA:function(a){window.console&&console.log(a),document.getElementById("testarea").value+=a+"\n"},includeDebugScript:function(a){if(!this.includedScript[a]){var b=document.createElement("script");b.type="text/javascript",b.src=pzpr.util.getpath()+"../../tests/script/"+a,document.getElementsByTagName("head")[0].appendChild(b),this.includedScript[a]=!0}},includedScript:{}}}();
//# sourceMappingURL=pzprv3-ui.js.map